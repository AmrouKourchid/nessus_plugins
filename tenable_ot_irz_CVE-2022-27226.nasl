#%NASL_MIN_LEVEL 80900
##
# (C) Tenable, Inc.
##

include('compat.inc');

if (description)
{
  script_id(502257);
  script_version("1.2");
  script_set_attribute(attribute:"plugin_modification_date", value:"2024/05/28");

  script_cve_id("CVE-2022-27226");

  script_name(english:"IRZ Mobile Routers Cross-Site Request Forgery (CVE-2022-27226)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"A CSRF issue in /api/crontab on iRZ Mobile Routers through 20.6.1
allows a threat actor to create a crontab entry in the router
administration panel. The cronjob will consequently execute the entry
on the threat actor's defined interval, leading to remote code
execution, allowing the threat actor to gain filesystem access. In
addition, if the router's default credentials aren't rotated or a
threat actor discovers valid credentials, remote code execution can be
achieved without user interaction.

This plugin only works with Tenable.ot.
Please visit https://www.tenable.com/products/tenable-ot for more information.");
  script_set_attribute(attribute:"see_also", value:"https://en.irz.ru");
  script_set_attribute(attribute:"see_also", value:"https://johnjhacking.com/blog/cve-2022-27226/");
  script_set_attribute(attribute:"see_also", value:"https://github.com/SakuraSamuraii/ez-iRZ");
  # http://packetstormsecurity.com/files/166396/iRZ-Mobile-Router-Cross-Site-Request-Forgery-Remote-Code-Execution.html
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?f1fecf38");
  script_set_attribute(attribute:"solution", value:
"Refer to the vendor advisory.");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:M/Au:N/C:C/I:C/A:C");
  script_set_cvss_temporal_vector("CVSS2#E:POC/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:P/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2022-27226");

  script_set_attribute(attribute:"exploitability_ease", value:"Exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"true");
  script_cwe_id(352);

  script_set_attribute(attribute:"vuln_publication_date", value:"2022/03/19");
  script_set_attribute(attribute:"patch_publication_date", value:"2022/03/19");
  script_set_attribute(attribute:"plugin_publication_date", value:"2024/05/27");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:irz:rl01_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:irz:rl21_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:irz:ru21_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:irz:ru21w_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:irz:ru41_firmware");
  script_set_attribute(attribute:"generated_plugin", value:"former");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2024 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/IRZ");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/IRZ');

var asset = tenable_ot::assets::get(vendor:'IRZ');

var vuln_cpes = {
    "cpe:/o:irz:ru21_firmware" :
        {"versionEndIncluding" : "20.6.1", "family" : "IRZRouters"},
    "cpe:/o:irz:ru21w_firmware" :
        {"versionEndIncluding" : "20.6.1", "family" : "IRZRouters"},
    "cpe:/o:irz:rl21_firmware" :
        {"versionEndIncluding" : "20.6.1", "family" : "IRZRouters"},
    "cpe:/o:irz:ru41_firmware" :
        {"versionEndIncluding" : "20.6.1", "family" : "IRZRouters"},
    "cpe:/o:irz:rl01_firmware" :
        {"versionEndIncluding" : "20.6.1", "family" : "IRZRouters"}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_HOLE);
