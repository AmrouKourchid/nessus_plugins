#%NASL_MIN_LEVEL 80900
##
# (C) Tenable, Inc.
##

include('compat.inc');

if (description)
{
  script_id(502060);
  script_version("1.1");
  script_set_attribute(attribute:"plugin_modification_date", value:"2024/02/27");

  script_cve_id("CVE-2018-7445");
  script_xref(name:"EDB-ID", value:"44290");
  script_xref(name:"CISA-KNOWN-EXPLOITED", value:"2022/09/29");

  script_name(english:"MikroTik RouterOS Improper Restriction of Operations within the Bounds of a Memory Buffer (CVE-2018-7445)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"A buffer overflow was found in the MikroTik RouterOS SMB service when
processing NetBIOS session request messages. Remote attackers with
access to the service can exploit this vulnerability and gain code
execution on the system. The overflow occurs before authentication
takes place, so it is possible for an unauthenticated remote attacker
to exploit it. All architectures and all devices running RouterOS
before versions 6.41.3/6.42rc27 are vulnerable.

This plugin only works with Tenable.ot.
Please visit https://www.tenable.com/products/tenable-ot for more information.");
  script_set_attribute(attribute:"see_also", value:"http://seclists.org/fulldisclosure/2018/Mar/38");
  script_set_attribute(attribute:"see_also", value:"http://www.securityfocus.com/bid/103427");
  # https://www.coresecurity.com/advisories/mikrotik-routeros-smb-buffer-overflow
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?5e50beb7");
  script_set_attribute(attribute:"see_also", value:"https://www.exploit-db.com/exploits/44290/");
  script_set_attribute(attribute:"solution", value:
"Refer to the vendor advisory.");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:L/Au:N/C:C/I:C/A:C");
  script_set_cvss_temporal_vector("CVSS2#E:F/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:F/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2018-7445");

  script_set_attribute(attribute:"exploitability_ease", value:"Exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"true");
  script_cwe_id(119);

  script_set_attribute(attribute:"vuln_publication_date", value:"2018/03/19");
  script_set_attribute(attribute:"patch_publication_date", value:"2018/03/19");
  script_set_attribute(attribute:"plugin_publication_date", value:"2024/02/27");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:mikrotik:routeros:6.4.2:rc11");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:mikrotik:routeros:6.4.2:rc12");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:mikrotik:routeros:6.4.2:rc14");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:mikrotik:routeros:6.4.2:rc15");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:mikrotik:routeros:6.4.2:rc18");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:mikrotik:routeros:6.4.2:rc2");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:mikrotik:routeros:6.4.2:rc20");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:mikrotik:routeros:6.4.2:rc23");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:mikrotik:routeros:6.4.2:rc24");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:mikrotik:routeros:6.4.2:rc27");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:mikrotik:routeros:6.4.2:rc5");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:mikrotik:routeros:6.4.2:rc6");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:mikrotik:routeros:6.4.2:rc9");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:mikrotik:routeros:6.41.3");
  script_set_attribute(attribute:"generated_plugin", value:"former");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2024 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/MikroTik");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/MikroTik');

var asset = tenable_ot::assets::get(vendor:'MikroTik');

var vuln_cpes = {
    "cpe:/o:mikrotik:routeros:6.4.2:rc11" :
        {"versionEndIncluding" : "6.4.2rc11", "versionStartIncluding" : "6.4.2rc11", "family" : "RouterOS"},
    "cpe:/o:mikrotik:routeros:6.4.2:rc12" :
        {"versionEndIncluding" : "6.4.2rc12", "versionStartIncluding" : "6.4.2rc12", "family" : "RouterOS"},
    "cpe:/o:mikrotik:routeros:6.4.2:rc14" :
        {"versionEndIncluding" : "6.4.2rc14", "versionStartIncluding" : "6.4.2rc14", "family" : "RouterOS"},
    "cpe:/o:mikrotik:routeros:6.4.2:rc15" :
        {"versionEndIncluding" : "6.4.2rc15", "versionStartIncluding" : "6.4.2rc15", "family" : "RouterOS"},
    "cpe:/o:mikrotik:routeros:6.4.2:rc18" :
        {"versionEndIncluding" : "6.4.2rc18", "versionStartIncluding" : "6.4.2rc18", "family" : "RouterOS"},
    "cpe:/o:mikrotik:routeros:6.4.2:rc2" :
        {"versionEndIncluding" : "6.4.2rc2", "versionStartIncluding" : "6.4.2rc2", "family" : "RouterOS"},
    "cpe:/o:mikrotik:routeros:6.4.2:rc20" :
        {"versionEndIncluding" : "6.4.2rc20", "versionStartIncluding" : "6.4.2rc20", "family" : "RouterOS"},
    "cpe:/o:mikrotik:routeros:6.4.2:rc23" :
        {"versionEndIncluding" : "6.4.2rc23", "versionStartIncluding" : "6.4.2rc23", "family" : "RouterOS"},
    "cpe:/o:mikrotik:routeros:6.4.2:rc24" :
        {"versionEndIncluding" : "6.4.2rc24", "versionStartIncluding" : "6.4.2rc24", "family" : "RouterOS"},
    "cpe:/o:mikrotik:routeros:6.4.2:rc27" :
        {"versionEndIncluding" : "6.4.2rc27", "versionStartIncluding" : "6.4.2rc27", "family" : "RouterOS"},
    "cpe:/o:mikrotik:routeros:6.4.2:rc5" :
        {"versionEndIncluding" : "6.4.2rc5", "versionStartIncluding" : "6.4.2rc5", "family" : "RouterOS"},
    "cpe:/o:mikrotik:routeros:6.4.2:rc6" :
        {"versionEndIncluding" : "6.4.2rc6", "versionStartIncluding" : "6.4.2rc6", "family" : "RouterOS"},
    "cpe:/o:mikrotik:routeros:6.4.2:rc9" :
        {"versionEndIncluding" : "6.4.2rc9", "versionStartIncluding" : "6.4.2rc9", "family" : "RouterOS"},
    "cpe:/o:mikrotik:routeros:6.41.3" :
        {"versionEndExcluding" : "6.41.3", "family" : "RouterOS"}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_HOLE);
