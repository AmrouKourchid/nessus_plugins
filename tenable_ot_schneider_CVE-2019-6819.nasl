#%NASL_MIN_LEVEL 70300
##
# (C) Tenable Network Security, Inc.
##

include('deprecated_nasl_level.inc');
include('compat.inc');

if (description)
{
  script_id(500072);
  script_version("1.12");
  script_set_attribute(attribute:"plugin_modification_date", value:"2024/09/04");

  script_cve_id("CVE-2019-6819");
  script_xref(name:"ICSA", value:"19-183-01");

  script_name(english:"Schneider Electric Modicon Controllers Improper Check For Unusual or Exceptional Conditions (CVE-2019-6819)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"A CWE-754: Improper Check for Unusual or Exceptional Conditions
vulnerability exists which could cause a possible Denial of Service
when specific Modbus frames are sent to the controller in the
products: Modicon M340 - firmware versions prior to V3.01, Modicon
M580 - firmware versions prior to V2.80, All firmware versions of
Modicon Quantum and Modicon Premium.

This plugin only works with Tenable.ot.
Please visit https://www.tenable.com/products/tenable-ot for more information.");
  # https://www.schneider-electric.com/en/download/document/SEVD-2019-134-05/
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?774dc1a5");
  script_set_attribute(attribute:"see_also", value:"https://www.cisa.gov/news-events/ics-advisories/icsa-19-183-01");
  script_set_attribute(attribute:"solution", value:
"The following text was originally created by the Cybersecurity and Infrastructure Security Agency (CISA). The original
can be found at CISA.gov.

Schneider Electric has recommended the following to mitigate this vulnerability.

Modicon M340 – The vulnerability is fixed in v3.01 and is available for download below:

- BMXP3420302 and CL and H: https://www.schneider-electric.com/en/download/document/BMXP3420302_Firmwares/
- BMXP342020 and H: https://www.schneider-electric.com/en/download/document/BMXP342020_Firmwares/
- BMXP342000: https://www.schneider-electric.com/en/download/document/BMXP342000_Firmwares/
- BMXP341000 and H: https://www.schneider-electric.com/en/download/document/BMXP341000_Firmwares/
- BMXP3420102 and CL: https://www.schneider-electric.com/en/download/document/BMXP3420102_Firmwares/
- BMXP3420302 and H: https://www.schneider-electric.com/en/download/document/BMXP3420302_Firmwares/

Modicon M580 – The vulnerability is fixed in v2.80 and is available for download below:

- BMEP584040, BMEP584040S, BMEH584040 and C: https://www.schneider-
electric.com/en/download/document/M580_BMEP584040_SV2.80/
- BMEP586040 and C: https://www.schneider-electric.com/en/download/document/M580_BMEP586040_SV2.80/
- BMEH586040 and C: https://www.schneiderelectric.com/en/download/document/M580_BMEH586040_SV2.80/
- BMEP581020 and H: https://www.schneiderelectric.com/en/download/document/M580_BMEP581020_SV2.80/
- BMEP582020 and H: https://www.schneiderelectric.com/en/download/document/M580_BMEP582020_SV2.80/
- BMEP582040 and H: https://www.schneiderelectric.com/en/download/document/M580_BMEP582040_SV2.80/
- BMEP583020: https://www.schneiderelectric.com/en/download/document/M580_BMEP583020_SV2.80/
- BMEP583040: https://www.schneiderelectric.com/en/download/document/M580_BMEP583040_SV2.80/
- BMEP584020: https://www.schneiderelectric.com/en/download/document/M580_BMEP584020_SV2.80/
- BMEP585040 and C: https://www.schneiderelectric.com/en/download/document/M580_BMEP585040_SV2.80/
- BMEP582040S: https://www.schneiderelectric.com/en/download/document/M580_BMEP582040S_SV2.80/
- BMEH582040 and C: https://www.schneiderelectric.com/en/download/document/M580_BMEP582040_SV2.80

Schneider Electric’s Modicon Quantum controllers have reached the end of their life and are no longer commercially
available. They have been replaced by the Modicon M580 ePAC controller, Schneider Electric’s most current product.
Schneider Electric recommends users migrate to the Modicon M580 ePAC.

To mitigate risks associated with this Modbus vulnerability, users should immediately set up network segmentation and
implement a firewall to block all unauthorized access to Port 502/TCP.

Schneider Electric general security recommendations:

- Locate control and safety system networks and remote devices behind firewalls, and isolate them from the business
network.
- Physical controls should be in place so no unauthorized persons have access to the ICS and safety controllers,
peripheral equipment, or the ICS and safety networks.
- All controllers should reside in locked cabinets and never be left in the “Program” mode.
- All programming software should be kept in locked cabinets and should never be connected to any network other than the
network for the intended devices.
- All methods of mobile data exchange with the isolated network (e.g., CDs, USB drives, etc.) should be scanned before
use in the terminals or any node connected to these networks.
- Laptops that have connected to any other network besides the intended network should never be allowed to connect to
the safety or control networks without proper sanitation.
- Minimize network exposure for all control system devices and/or systems, and ensure they are not accessible from the
Internet.
- When remote access is required, use secure methods, such as virtual private networks (VPNs), recognizing that VPNs may
have vulnerabilities and should be updated to the most current version available. Also recognize VPN is only as secure
as the connected devices.

For more information, please see Schneider Electric advisory: SEVD-2019-134-05");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:L/Au:N/C:N/I:N/A:P");
  script_set_cvss_temporal_vector("CVSS2#E:U/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:U/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2019-6819");

  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"false");
  script_cwe_id(754);

  script_set_attribute(attribute:"vuln_publication_date", value:"2019/05/22");
  script_set_attribute(attribute:"patch_publication_date", value:"2019/05/22");
  script_set_attribute(attribute:"plugin_publication_date", value:"2022/02/07");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_m340_firmware");
  script_set_attribute(attribute:"generated_plugin", value:"current");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2022-2024 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/Schneider");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/Schneider');

var asset = tenable_ot::assets::get(vendor:'Schneider');

var vuln_cpes = {
    "cpe:/o:schneider-electric:modicon_m340_firmware" :
        {"versionEndExcluding" : "3.01", "family" : "ModiconM340"}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_WARNING);
