#%NASL_MIN_LEVEL 80900

##
# Tenable, Inc.
##

include('compat.inc');

if (description)
{
  script_id(207347);
  script_version("1.5");
  script_set_attribute(attribute:"plugin_modification_date", value:"2025/02/04");

  script_cve_id("CVE-2024-4263");

  script_name(english:"MLFlow < 2.12.1 File Deletion");

  script_set_attribute(attribute:"synopsis", value:
"The remote host is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"A broken access control vulnerability exists in mlflow/mlflow versions before 2.12.1, where low privilege
users with only EDIT permissions on an experiment can delete any artifacts. This issue arises due to the lack
of proper validation for DELETE requests by users with EDIT permissions, allowing them to perform unauthorized
deletions of artifacts. The vulnerability specifically affects the handling of artifact deletions within the
application, as demonstrated by the ability of a low privilege user to delete a directory inside an artifact
using a DELETE request, despite the official documentation stating that users with EDIT permission can only
read and update artifacts, not delete them.

Note that Nessus has not tested for this issue but has instead relied only on the application's self-reported version number.");
  script_set_attribute(attribute:"see_also", value:"https://huntr.com/bounties/bfa116d3-2af8-4c4a-ac34-ccde7491ae11");
  # https://github.com/mlflow/mlflow/commit/b43e0e3de5b500554e13dc032ba2083b2d6c94b8
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?051f9300");
  # https://github.com/mlflow/mlflow/blob/v2.12.1/mlflow/server/auth/__init__.py
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?fd5dae75");
  script_set_attribute(attribute:"solution", value:
"Upgrade to MLFlow version 2.12.1 or later.");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:L/Au:S/C:N/I:P/A:P");
  script_set_cvss_temporal_vector("CVSS2#E:POC/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:L");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:P/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2024-4263");

  script_set_attribute(attribute:"exploitability_ease", value:"Exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"true");
  script_cwe_id(284);

  script_set_attribute(attribute:"vuln_publication_date", value:"2024/05/16");
  script_set_attribute(attribute:"patch_publication_date", value:"2024/05/16");
  script_set_attribute(attribute:"plugin_publication_date", value:"2024/09/17");

  script_set_attribute(attribute:"plugin_type", value:"combined");
  script_set_attribute(attribute:"cpe", value:"cpe:/a:lfprojects:mlflow");
  script_set_attribute(attribute:"thorough_tests", value:"true");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Artificial Intelligence");

  script_copyright(english:"This script is Copyright (C) 2024-2025 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("mlflow_detect.nbin", "python_mlflow_detect.nbin");
  script_require_keys("installed_sw/MLflow");

  exit(0);
}

include('vcf.inc');

var app_info = vcf::combined_get_app_info(app:'MLflow');
var constraints = [
    { 'fixed_version':'2.12.1' },
];

vcf::check_version_and_report(app_info:app_info, constraints:constraints, severity:SECURITY_WARNING);
        
