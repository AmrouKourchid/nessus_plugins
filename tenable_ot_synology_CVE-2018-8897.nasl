#%NASL_MIN_LEVEL 80900
##
# (C) Tenable, Inc.
##

include('compat.inc');

if (description)
{
  script_id(502397);
  script_version("1.2");
  script_set_attribute(attribute:"plugin_modification_date", value:"2024/10/02");

  script_cve_id("CVE-2018-8897");

  script_name(english:"Synology DiskStation Manager Debian Linux Race Condition (CVE-2018-8897)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"A statement in the System Programming Guide of the Intel 64 and IA-32
Architectures Software Developer's Manual (SDM) was mishandled in the
development of some or all operating-system kernels, resulting in
unexpected behavior for #DB exceptions that are deferred by MOV SS or
POP SS, as demonstrated by (for example) privilege escalation in
Windows, macOS, some Xen configurations, or FreeBSD, or a Linux kernel
crash. The MOV to SS and POP SS instructions inhibit interrupts
(including NMIs), data breakpoints, and single step trap exceptions
until the instruction boundary following the next instruction (SDM
Vol. 3A; section 6.8.3). (The inhibited data breakpoints are those on
memory accessed by the MOV to SS or POP to SS instruction itself.)
Note that debug exceptions are not inhibited by the interrupt enable
(EFLAGS.IF) system flag (SDM Vol. 3A; section 2.3). If the instruction
following the MOV to SS or POP to SS instruction is an instruction
like SYSCALL, SYSENTER, INT 3, etc. that transfers control to the
operating system at CPL < 3, the debug exception is delivered after
the transfer to CPL < 3 is complete. OS kernels may not expect this
order of events and may therefore experience unexpected behavior when
it occurs.

This plugin only works with Tenable.ot.
Please visit https://www.tenable.com/products/tenable-ot for more information.");
  # http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=d8ba61ba58c88d5207c1ba2f7d9a2280e7d03be9
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?45707cda");
  script_set_attribute(attribute:"see_also", value:"http://openwall.com/lists/oss-security/2018/05/08/1");
  script_set_attribute(attribute:"see_also", value:"http://openwall.com/lists/oss-security/2018/05/08/4");
  # http://www.huawei.com/en/psirt/security-advisories/huawei-sa-20190921-01-debug-en
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?2fb42aa9");
  script_set_attribute(attribute:"see_also", value:"http://www.securityfocus.com/bid/104071");
  script_set_attribute(attribute:"see_also", value:"http://www.securitytracker.com/id/1040744");
  script_set_attribute(attribute:"see_also", value:"http://www.securitytracker.com/id/1040849");
  script_set_attribute(attribute:"see_also", value:"http://www.securitytracker.com/id/1040861");
  script_set_attribute(attribute:"see_also", value:"http://www.securitytracker.com/id/1040866");
  script_set_attribute(attribute:"see_also", value:"http://www.securitytracker.com/id/1040882");
  script_set_attribute(attribute:"see_also", value:"https://access.redhat.com/errata/RHSA-2018:1318");
  script_set_attribute(attribute:"see_also", value:"https://access.redhat.com/errata/RHSA-2018:1319");
  script_set_attribute(attribute:"see_also", value:"https://access.redhat.com/errata/RHSA-2018:1345");
  script_set_attribute(attribute:"see_also", value:"https://access.redhat.com/errata/RHSA-2018:1346");
  script_set_attribute(attribute:"see_also", value:"https://access.redhat.com/errata/RHSA-2018:1347");
  script_set_attribute(attribute:"see_also", value:"https://access.redhat.com/errata/RHSA-2018:1348");
  script_set_attribute(attribute:"see_also", value:"https://access.redhat.com/errata/RHSA-2018:1349");
  script_set_attribute(attribute:"see_also", value:"https://access.redhat.com/errata/RHSA-2018:1350");
  script_set_attribute(attribute:"see_also", value:"https://access.redhat.com/errata/RHSA-2018:1351");
  script_set_attribute(attribute:"see_also", value:"https://access.redhat.com/errata/RHSA-2018:1352");
  script_set_attribute(attribute:"see_also", value:"https://access.redhat.com/errata/RHSA-2018:1353");
  script_set_attribute(attribute:"see_also", value:"https://access.redhat.com/errata/RHSA-2018:1354");
  script_set_attribute(attribute:"see_also", value:"https://access.redhat.com/errata/RHSA-2018:1355");
  script_set_attribute(attribute:"see_also", value:"https://access.redhat.com/errata/RHSA-2018:1524");
  script_set_attribute(attribute:"see_also", value:"https://bugzilla.redhat.com/show_bug.cgi?id=1567074");
  script_set_attribute(attribute:"see_also", value:"https://github.com/can1357/CVE-2018-8897/");
  # https://github.com/torvalds/linux/commit/d8ba61ba58c88d5207c1ba2f7d9a2280e7d03be9
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?21d38445");
  # https://help.ecostruxureit.com/display/public/UADCE725/Security+fixes+in+StruxureWare+Data+Center+Expert+v7.6.0
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?148b2157");
  script_set_attribute(attribute:"see_also", value:"https://lists.debian.org/debian-lts-announce/2018/05/msg00015.html");
  script_set_attribute(attribute:"see_also", value:"https://lists.debian.org/debian-lts-announce/2018/06/msg00000.html");
  script_set_attribute(attribute:"see_also", value:"https://lists.debian.org/debian-lts-announce/2018/11/msg00013.html");
  script_set_attribute(attribute:"see_also", value:"https://patchwork.kernel.org/patch/10386677/");
  # https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2018-8897
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?659953a0");
  script_set_attribute(attribute:"see_also", value:"https://security.netapp.com/advisory/ntap-20180927-0002/");
  script_set_attribute(attribute:"see_also", value:"https://support.apple.com/HT208742");
  script_set_attribute(attribute:"see_also", value:"https://support.citrix.com/article/CTX234679");
  script_set_attribute(attribute:"see_also", value:"https://svnweb.freebsd.org/base?view=revision&revision=333368");
  script_set_attribute(attribute:"see_also", value:"https://usn.ubuntu.com/3641-1/");
  script_set_attribute(attribute:"see_also", value:"https://usn.ubuntu.com/3641-2/");
  script_set_attribute(attribute:"see_also", value:"https://www.debian.org/security/2018/dsa-4196");
  script_set_attribute(attribute:"see_also", value:"https://www.debian.org/security/2018/dsa-4201");
  script_set_attribute(attribute:"see_also", value:"https://www.exploit-db.com/exploits/44697/");
  script_set_attribute(attribute:"see_also", value:"https://www.exploit-db.com/exploits/45024/");
  # https://www.freebsd.org/security/advisories/FreeBSD-SA-18:06.debugreg.asc
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?2846adde");
  script_set_attribute(attribute:"see_also", value:"https://www.kb.cert.org/vuls/id/631579");
  script_set_attribute(attribute:"see_also", value:"https://www.synology.com/support/security/Synology_SA_18_21");
  # https://www.triplefault.io/2018/05/spurious-db-exceptions-with-pop-ss.html
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?5fe0ae35");
  script_set_attribute(attribute:"see_also", value:"https://xenbits.xen.org/xsa/advisory-260.html");
  script_set_attribute(attribute:"solution", value:
"Refer to the vendor advisory.");
  script_set_cvss_base_vector("CVSS2#AV:L/AC:L/Au:N/C:C/I:C/A:C");
  script_set_cvss_temporal_vector("CVSS2#E:H/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:H/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2018-8897");

  script_set_attribute(attribute:"exploitability_ease", value:"Exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"true");
  script_set_attribute(attribute:"exploited_by_malware", value:"true");
  script_set_attribute(attribute:"metasploit_name", value:'Microsoft Windows POP/MOV SS Local Privilege Elevation Vulnerability');
  script_set_attribute(attribute:"exploit_framework_metasploit", value:"true");
  script_cwe_id(362);

  script_set_attribute(attribute:"vuln_publication_date", value:"2018/05/08");
  script_set_attribute(attribute:"patch_publication_date", value:"2018/05/08");
  script_set_attribute(attribute:"plugin_publication_date", value:"2024/10/01");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:synology:diskstation_manager:5.2");
  script_set_attribute(attribute:"generated_plugin", value:"former");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2024 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/Synology");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/Synology');

var asset = tenable_ot::assets::get(vendor:'Synology');

var vuln_cpes = {
    "cpe:/o:synology:diskstation_manager:5.2" :
        {"versionEndExcluding" : "6.2.1-23824", "versionStartIncluding" : "5.2", "family" : "DiskStation"}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_HOLE);
