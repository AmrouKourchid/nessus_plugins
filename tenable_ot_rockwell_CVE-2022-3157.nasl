#%NASL_MIN_LEVEL 80900
##
# (C) Tenable, Inc.
##

include('compat.inc');

if (description)
{
  script_id(500717);
  script_version("1.10");
  script_set_attribute(attribute:"plugin_modification_date", value:"2024/09/04");

  script_cve_id("CVE-2022-3157");
  script_xref(name:"ICSA", value:"22-354-02");

  script_name(english:"Rockwell Automation GuardLogix and ControlLogix controllers Improper Input Validation (CVE-2022-3157)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"A vulnerability exists in the Rockwell Automation controllers that allows a malformed CIP request to cause a major non-
recoverable fault (MNRF) and a denial-of-service condition (DOS).

  - A vulnerability exists in the Rockwell Automation controllers that allows a malformed CIP request to cause
    a major non-recoverable fault (MNRF) and a denial-of-service condition (DOS). (CVE-2022-3157)

This plugin only works with Tenable.ot. Please visit https://www.tenable.com/products/tenable-ot for more information.");
  # https://rockwellautomation.custhelp.com/app/answers/answer_view/a_id/1137757
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?c2e3a3c5");
  script_set_attribute(attribute:"see_also", value:"https://www.cisa.gov/news-events/ics-advisories/icsa-22-354-02");
  # https://www.rockwellautomation.com/en-us/support/advisory.PN1613.html
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?ce802123");
  script_set_attribute(attribute:"solution", value:
"The following text was originally created by the Cybersecurity and Infrastructure Security Agency (CISA). The original
can be found at CISA.gov.

Rockwell Automation has released product updates addressing this vulnerability:

- For CompactLogix 5370, Compact GuardLogix 5370, ControlLogix 5570, GuardLogix 5570: Users should upgrade to versions
33.013, 34.011, or later.
- For ControlLogix 5570 redundancy: Users should upgrade to versions 33.052, 34.051, or later.

Rockwell Automation encourages users to apply mitigations on their security best practices web page to reduce risk.

Users should see the Rockwell Automation security advisory for more information.");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:L/Au:N/C:N/I:N/A:C");
  script_set_cvss_temporal_vector("CVSS2#E:U/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:U/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2022-3157");

  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"false");

  script_set_attribute(attribute:"vuln_publication_date", value:"2022/12/16");
  script_set_attribute(attribute:"patch_publication_date", value:"2022/12/16");
  script_set_attribute(attribute:"plugin_publication_date", value:"2022/12/23");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:compact_guardlogix_5370_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:compact_guardlogix_5380_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:compactlogix_5370_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:controllogix_5570_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:controllogix_5570_redundancy_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:guardlogix_5570_firmware");
  script_set_attribute(attribute:"generated_plugin", value:"current");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2022-2024 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/Rockwell");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/Rockwell');

var asset = tenable_ot::assets::get(vendor:'Rockwell');

var vuln_cpes = {
    "cpe:/o:rockwellautomation:compactlogix_5370_firmware" :
        {"versionEndIncluding" : "33", "versionStartIncluding" : "20", "family" : "CompactLogix5370"},
    "cpe:/o:rockwellautomation:compact_guardlogix_5370_firmware" :
        {"versionEndIncluding" : "33", "versionStartIncluding" : "28", "family" : "GuardLogix5370"},
    "cpe:/o:rockwellautomation:compact_guardlogix_5380_firmware" :
        {"versionEndIncluding" : "33", "versionStartIncluding" : "28", "family" : "GuardLogix5380"},
    "cpe:/o:rockwellautomation:controllogix_5570_firmware" :
        {"versionEndIncluding" : "33", "versionStartIncluding" : "20", "family" : "ControlLogix5570"},
    "cpe:/o:rockwellautomation:controllogix_5570_redundancy_firmware" :
        {"versionEndIncluding" : "33", "versionStartIncluding" : "20", "family" : "ControlLogix5570"},
    "cpe:/o:rockwellautomation:guardlogix_5570_firmware" :
        {"versionEndIncluding" : "33", "versionStartIncluding" : "20", "family" : "GuardLogix5570"}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_HOLE);
