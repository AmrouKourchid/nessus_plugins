#%NASL_MIN_LEVEL 80900
##
# (C) Tenable, Inc.
##

include('compat.inc');

if (description)
{
  script_id(500721);
  script_version("1.7");
  script_set_attribute(attribute:"plugin_modification_date", value:"2025/03/10");

  script_cve_id("CVE-2021-40365");
  script_xref(name:"ICSA", value:"22-349-03");

  script_name(english:"Siemens Multiple Denial of Service in Industrial Products (CVE-2021-40365)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"A vulnerability has been identified in SIMATIC Drive Controller
family, SIMATIC ET 200SP Open Controller CPU 1515SP PC2 (incl. SIPLUS
variants), SIMATIC S7-1200 CPU family (incl. SIPLUS variants), SIMATIC
S7-1500 CPU 1510SP F-1 PN, SIMATIC S7-1500 CPU 1510SP-1 PN, SIMATIC
S7-1500 CPU 1511-1 PN, SIMATIC S7-1500 CPU 1511-1 PN, SIMATIC S7-1500
CPU 1511C-1 PN, SIMATIC S7-1500 CPU 1511C-1 PN, SIMATIC S7-1500 CPU
1511F-1 PN, SIMATIC S7-1500 CPU 1511F-1 PN, SIMATIC S7-1500 CPU
1511T-1 PN, SIMATIC S7-1500 CPU 1511TF-1 PN, SIMATIC S7-1500 CPU
1512C-1 PN, SIMATIC S7-1500 CPU 1512C-1 PN, SIMATIC S7-1500 CPU 1512SP
F-1 PN, SIMATIC S7-1500 CPU 1512SP-1 PN, SIMATIC S7-1500 CPU 1513-1
PN, SIMATIC S7-1500 CPU 1513-1 PN, SIMATIC S7-1500 CPU 1513F-1 PN,
SIMATIC S7-1500 CPU 1513F-1 PN, SIMATIC S7-1500 CPU 1513R-1 PN,
SIMATIC S7-1500 CPU 1515-2 PN, SIMATIC S7-1500 CPU 1515-2 PN, SIMATIC
S7-1500 CPU 1515F-2 PN, SIMATIC S7-1500 CPU 1515F-2 PN, SIMATIC
S7-1500 CPU 1515R-2 PN, SIMATIC S7-1500 CPU 1515T-2 PN, SIMATIC
S7-1500 CPU 1515TF-2 PN, SIMATIC S7-1500 CPU 1516-3 PN/DP, SIMATIC
S7-1500 CPU 1516-3 PN/DP, SIMATIC S7-1500 CPU 1516F-3 PN/DP, SIMATIC
S7-1500 CPU 1516F-3 PN/DP, SIMATIC S7-1500 CPU 1516T-3 PN/DP, SIMATIC
S7-1500 CPU 1516TF-3 PN/DP, SIMATIC S7-1500 CPU 1517-3 PN/DP, SIMATIC
S7-1500 CPU 1517F-3 PN/DP, SIMATIC S7-1500 CPU 1517H-3 PN, SIMATIC
S7-1500 CPU 1517T-3 PN/DP, SIMATIC S7-1500 CPU 1517TF-3 PN/DP, SIMATIC
S7-1500 CPU 1518-4 PN/DP, SIMATIC S7-1500 CPU 1518-4 PN/DP MFP,
SIMATIC S7-1500 CPU 1518-4F PN/DP, SIMATIC S7-1500 CPU 1518F-4 PN/DP
MFP, SIMATIC S7-1500 CPU 1518HF-4 PN, SIMATIC S7-1500 CPU 1518T-4
PN/DP, SIMATIC S7-1500 CPU 1518TF-4 PN/DP, SIMATIC S7-1500 CPU
S7-1518-4 PN/DP ODK, SIMATIC S7-1500 CPU S7-1518F-4 PN/DP ODK, SIMATIC
S7-1500 ET 200pro: CPU 1513PRO F-2 PN, SIMATIC S7-1500 ET 200pro: CPU
1513PRO-2 PN, SIMATIC S7-1500 ET 200pro: CPU 1516PRO F-2 PN, SIMATIC
S7-1500 ET 200pro: CPU 1516PRO-2 PN, SIMATIC S7-1500 Software
Controller, SIMATIC S7-PLCSIM Advanced, SIPLUS ET 200SP CPU 1510SP F-1
PN, SIPLUS ET 200SP CPU 1510SP F-1 PN RAIL, SIPLUS ET 200SP CPU
1510SP-1 PN, SIPLUS ET 200SP CPU 1510SP-1 PN, SIPLUS ET 200SP CPU
1510SP-1 PN RAIL, SIPLUS ET 200SP CPU 1510SP-1 PN RAIL, SIPLUS ET
200SP CPU 1512SP F-1 PN, SIPLUS ET 200SP CPU 1512SP F-1 PN, SIPLUS ET
200SP CPU 1512SP F-1 PN RAIL, SIPLUS ET 200SP CPU 1512SP F-1 PN RAIL,
SIPLUS ET 200SP CPU 1512SP-1 PN, SIPLUS ET 200SP CPU 1512SP-1 PN,
SIPLUS ET 200SP CPU 1512SP-1 PN RAIL, SIPLUS ET 200SP CPU 1512SP-1 PN
RAIL, SIPLUS S7-1500 CPU 1511-1 PN, SIPLUS S7-1500 CPU 1511-1 PN,
SIPLUS S7-1500 CPU 1511-1 PN, SIPLUS S7-1500 CPU 1511-1 PN, SIPLUS
S7-1500 CPU 1511-1 PN T1 RAIL, SIPLUS S7-1500 CPU 1511-1 PN T1 RAIL,
SIPLUS S7-1500 CPU 1511-1 PN TX RAIL, SIPLUS S7-1500 CPU 1511-1 PN TX
RAIL, SIPLUS S7-1500 CPU 1511F-1 PN, SIPLUS S7-1500 CPU 1511F-1 PN,
SIPLUS S7-1500 CPU 1513-1 PN, SIPLUS S7-1500 CPU 1513-1 PN, SIPLUS
S7-1500 CPU 1513-1 PN, SIPLUS S7-1500 CPU 1513-1 PN, SIPLUS S7-1500
CPU 1513F-1 PN, SIPLUS S7-1500 CPU 1513F-1 PN, SIPLUS S7-1500 CPU
1515F-2 PN, SIPLUS S7-1500 CPU 1515F-2 PN, SIPLUS S7-1500 CPU 1515F-2
PN RAIL, SIPLUS S7-1500 CPU 1515F-2 PN T2 RAIL, SIPLUS S7-1500 CPU
1515R-2 PN, SIPLUS S7-1500 CPU 1515R-2 PN TX RAIL, SIPLUS S7-1500 CPU
1516-3 PN/DP, SIPLUS S7-1500 CPU 1516-3 PN/DP, SIPLUS S7-1500 CPU
1516-3 PN/DP, SIPLUS S7-1500 CPU 1516-3 PN/DP, SIPLUS S7-1500 CPU
1516-3 PN/DP RAIL, SIPLUS S7-1500 CPU 1516-3 PN/DP TX RAIL, SIPLUS
S7-1500 CPU 1516F-3 PN/DP, SIPLUS S7-1500 CPU 1516F-3 PN/DP, SIPLUS
S7-1500 CPU 1516F-3 PN/DP RAIL, SIPLUS S7-1500 CPU 1516F-3 PN/DP RAIL,
SIPLUS S7-1500 CPU 1517H-3 PN, SIPLUS S7-1500 CPU 1518-4 PN/DP, SIPLUS
S7-1500 CPU 1518-4 PN/DP MFP, SIPLUS S7-1500 CPU 1518F-4 PN/DP, SIPLUS
S7-1500 CPU 1518HF-4 PN, SIPLUS TIM 1531 IRC, TIM 1531 IRC. Affected
devices don't process correctly certain special crafted packets sent
to port 102/tcp, which could allow an attacker to cause a denial-of-
service in the device.

This plugin only works with Tenable.ot.
Please visit https://www.tenable.com/products/tenable-ot for more information.");
  script_set_attribute(attribute:"see_also", value:"https://cert-portal.siemens.com/productcert/pdf/ssa-382653.pdf");
  script_set_attribute(attribute:"see_also", value:"https://www.cisa.gov/news-events/ics-advisories/icsa-22-349-03");
  script_set_attribute(attribute:"solution", value:
"The following text was originally created by the Cybersecurity and Infrastructure Security Agency (CISA). The original
can be found at CISA.gov.

Siemens released updates for several affected products and recommends updating to the latest versions. Siemens is
preparing further updates and recommends countermeasures for products where updates are not, or not yet, available.

- SIMATIC Drive Controller family: Update to V3.0.1 or later version
- SIMATIC S7-PLCSIM Advanced: Update to V5.0 or later version
- SIMATIC S7-1500 CPU family (incl. related ET200 CPUs and SIPLUS variants): Update to V3.0.1 or later version
- SIMATIC S7-1200 CPU family (incl. SIPLUS variants): Update to V4.6.0 or later version

Siemens has identified the following specific workarounds and mitigations users can apply to reduce risk:

- Restrict access to port 102/TCP to trusted systems with an external firewall

As a general security measure, Siemens strongly recommends protecting network access to devices with appropriate
mechanisms. To operate the devices in a protected IT environment, Siemens recommends configuring the environment
according to Siemens' operational guidelines for industrial security, and to follow the recommendations in the product
manuals. Additional information on Industrial Security by Siemens can be found here.

For further inquiries on security vulnerabilities in Siemens products, users should contact Siemens ProductCERT.

For more information, see the associated Siemens security advisory SSA-382653 in HTML and CSAF.");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:L/Au:N/C:N/I:N/A:C");
  script_set_cvss_temporal_vector("CVSS2#E:U/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:U/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2021-40365");

  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"false");
  script_cwe_id(20);

  script_set_attribute(attribute:"vuln_publication_date", value:"2022/12/13");
  script_set_attribute(attribute:"patch_publication_date", value:"2022/12/13");
  script_set_attribute(attribute:"plugin_publication_date", value:"2023/01/05");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_et_200_sp_open_controller_cpu_1515sp_pc_firmware:-");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-1200_cpu_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-1500_cpu_firmware:2.9.7");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-1500_cpu_firmware:3.0.1");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_et200pro_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_et200sp_firmware");
  script_set_attribute(attribute:"generated_plugin", value:"former");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2022-2025 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/Siemens");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/Siemens');

var asset = tenable_ot::assets::get(vendor:'Siemens');

var vuln_cpes = {
    "cpe:/o:siemens:simatic_et_200_sp_open_controller_cpu_1515sp_pc_firmware:-" :
        {"versionEndExcluding" : "21.9.7", "family" : "ET200SP"},
    "cpe:/o:siemens:simatic_s7-1200_cpu_firmware" :
        {"versionEndExcluding" : "4.6.0", "family" : "S71200"},
    "cpe:/o:siemens:simatic_s7-1500_cpu_firmware:2.9.7" :
        {"versionEndExcluding" : "2.9.7", "family" : "S71500", "orderNumbers" : ["6AG1511-1AK01-2AB0", "6AG1511-1AK01-7AB0", "6AG1511-1AK02-2AB0", "6AG1511-1AK02-7AB0", "6AG1511-1FK01-2AB0", "6AG1511-1FK02-2AB0", "6AG1513-1AL01-2AB0", "6AG1513-1AL01-7AB0", "6AG1513-1AL02-2AB0", "6AG1513-1AL02-7AB0", "6AG1513-1FL01-2AB0", "6AG1513-1FL02-2AB0", "6AG1515-2FM01-2AB0", "6AG1515-2FM02-2AB0", "6AG1515-2RM00-7AB0", "6AG1516-3AN01-2AB0", "6AG1516-3AN01-7AB0", "6AG1516-3AN02-2AB0", "6AG1516-3AN02-7AB0", "6AG1516-3FN01-2AB0", "6AG1516-3FN02-2AB0", "6AG2511-1AK01-1AB0", "6AG2511-1AK01-4AB0", "6AG2511-1AK02-1AB0", "6AG2511-1AK02-4AB0", "6AG2515-2FM01-2AB0", "6AG2515-2FM02-4AB0", "6AG2515-2RM00-4AB0", "6AG2516-3AN01-4AB0", "6AG2516-3AN02-4AB0", "6AG2516-3FN02-2AB0", "6AG2516-3FN02-4AB0", "6ES7510-1DJ01-0AB0", "6ES7510-1SJ01-0AB0", "6ES7511-1AK01-0AB0", "6ES7511-1AK02-0AB0", "6ES7511-1CK00-0AB0", "6ES7511-1CK01-0AB0", "6ES7511-1FK01-0AB0", "6ES7511-1FK02-0AB0", "6ES7511-1TK01-0AB0", "6ES7511-1UK01-0AB0", "6ES7512-1CK00-0AB0", "6ES7512-1CK01-0AB0", "6ES7512-1DK01-0AB0", "6ES7512-1SK01-0AB0", "6ES7513-1AL01-0AB0", "6ES7513-1AL02-0AB0", "6ES7513-1FL01-0AB0", "6ES7513-1FL02-0AB0", "6ES7513-1RL00-0AB0", "6ES7515-2AM01-0AB0", "6ES7515-2AM02-0AB0", "6ES7515-2FM01-0AB0", "6ES7515-2FM02-0AB0", "6ES7515-2RM00-0AB0", "6ES7515-2TM01-0AB0", "6ES7515-2UM01-0AB0", "6ES7516-3AN01-0AB0", "6ES7516-3AN02-0AB0", "6ES7516-3FN01-0AB0", "6ES7516-3FN02-0AB0", "6ES7518-4AP00-3AB0", "6ES7518-4FP00-3AB0", "6ES7615-4DF10-0AB0", "6ES7615-7DF10-0AB0"]},
    "cpe:/o:siemens:simatic_s7-1500_cpu_firmware:3.0.1" :
        {"versionEndExcluding" : "3.0.1", "family" : "S71500", "orderNumbers" : ["6ES7516-3TN00-0AB0", "6ES7516-3UN00-0AB0", "6ES7517-3AP00-0AB0", "6ES7517-3FP00-0AB0", "6ES7517-3HP00-0AB0", "6ES7517-3TP00-0AB0", "6ES7517-3UP00-0AB0", "6ES7518-4AP00-0AB0", "6ES7518-4AX00-1AB0", "6ES7518-4FP00-0AB0", "6ES7518-4FX00-1AB0", "6ES7518-4JP00-0AB0", "6ES7518-4TP00-0AB0", "6ES7518-4UP00-0AB0", "6AG1517-3HP00-4AB0", "6AG1518-4AP00-4AB0", "6AG1518-4AX00-4AC0", "6AG1518-4FP00-4AB0", "6AG1518-4JP00-4AB0"]},
    "cpe:/o:siemens:simatic_et200pro_firmware" :
        {"versionEndExcluding" : "2.9.7", "family" : "ET200", "orderNumbers" : ["6ES7513-2GL00-0AB0", "6ES7513-2PL00-0AB0", "6ES7516-2GN00-0AB0", "6ES7516-2PN00-0AB0"]},
    "cpe:/o:siemens:simatic_et200sp_firmware" :
        {"versionEndExcluding" : "2.9.7", "family" : "ET200SP", "orderNumbers" : ["6AG1510-1SJ01-2AB0", "6AG2510-1SJ01-1AB0", "6AG1510-1DJ01-2AB0", "6AG1510-1DJ01-7AB0", "6AG2510-1DJ01-4AB0", "6AG2510-1DJ01-1AB0", "6AG1512-1SK01-2AB0", "6AG1512-1SK01-7AB0", "6AG2512-1SK01-1AB0", "6AG2512-1SK01-4AB0", "6AG1512-1DK01-2AB0", "6AG1512-1DK01-7AB0", "6AG2512-1DK01-4AB0", "6AG2512-1DK01-1AB0"]}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_WARNING);
