#%NASL_MIN_LEVEL 80900
##
# (C) Tenable, Inc.
##

include('compat.inc');

if (description)
{
  script_id(500764);
  script_version("1.9");
  script_set_attribute(attribute:"plugin_modification_date", value:"2024/11/25");

  script_cve_id("CVE-2021-25668");
  script_xref(name:"ICSA", value:"21-103-07");

  script_name(english:"Siemens Web Server of SCALANCE X200 Heap-Based Buffer Overflow (CVE-2021-25668)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"A vulnerability has been identified in SCALANCE X200-4P IRT (All
versions < 5.5.1), SCALANCE X201-3P IRT (All versions < 5.5.1),
SCALANCE X201-3P IRT PRO (All versions < 5.5.1), SCALANCE X202-2 IRT
(All versions < 5.5.1), SCALANCE X202-2P IRT (incl. SIPLUS NET
variant) (All versions < 5.5.1), SCALANCE X202-2P IRT PRO (All
versions < 5.5.1), SCALANCE X204 IRT (All versions < 5.5.1), SCALANCE
X204 IRT PRO (All versions < 5.5.1), SCALANCE X204-2 (incl. SIPLUS NET
variant) (All versions < V5.2.5), SCALANCE X204-2FM (All versions <
V5.2.5), SCALANCE X204-2LD (incl. SIPLUS NET variant) (All versions <
V5.2.5), SCALANCE X204-2LD TS (All versions < V5.2.5), SCALANCE
X204-2TS (All versions < V5.2.5), SCALANCE X206-1 (All versions <
V5.2.5), SCALANCE X206-1LD (All versions < V5.2.5), SCALANCE X208
(incl. SIPLUS NET variant) (All versions < V5.2.5), SCALANCE X208PRO
(All versions < V5.2.5), SCALANCE X212-2 (incl. SIPLUS NET variant)
(All versions < V5.2.5), SCALANCE X212-2LD (All versions < V5.2.5),
SCALANCE X216 (All versions < V5.2.5), SCALANCE X224 (All versions <
V5.2.5), SCALANCE XF201-3P IRT (All versions < 5.5.1), SCALANCE
XF202-2P IRT (All versions < 5.5.1), SCALANCE XF204 (All versions <
V5.2.5), SCALANCE XF204 IRT (All versions < 5.5.1), SCALANCE XF204-2
(incl. SIPLUS NET variant) (All versions < V5.2.5), SCALANCE XF204-2BA
IRT (All versions < 5.5.1), SCALANCE XF206-1 (All versions < V5.2.5),
SCALANCE XF208 (All versions < V5.2.5). Incorrect processing of POST
requests in the webserver may result in write out of bounds in heap.
An attacker might leverage this to cause denial-of-service on the
device and potentially remotely execute code.

This plugin only works with Tenable.ot.
Please visit https://www.tenable.com/products/tenable-ot for more information.");
  script_set_attribute(attribute:"see_also", value:"https://cert-portal.siemens.com/productcert/pdf/ssa-187092.pdf");
  script_set_attribute(attribute:"see_also", value:"https://www.cisa.gov/news-events/ics-advisories/icsa-21-103-07");
  script_set_attribute(attribute:"solution", value:
"The following text was originally created by the Cybersecurity and Infrastructure Security Agency (CISA). The original
can be found at CISA.gov.

Siemens recommends upgrading the following products to v5.5.1:

- SCALANCE X200-4P IRT
- SCALANCE X201-3P IRT
- SCALANCE X201-3P IRT PRO
- SCALANCE X202-2 IRT
- SCALANCE X202-2P IRT (incl. SIPLUS NET variant)
- SCALANCE X202-2P IRT PRO
- SCALANCE X204 IRT
- SCALANCE X204 IRT PRO
- SCALANCE XF201-3P IRT
- SCALANCE XF202-2P IRT
- SCALANCE XF204 IRT
- SCALANCE XF204-2BA IRT

Siemens recommends upgrading the following products to v5.2.5 or later:

- SCALANCE X204-2 (incl. SIPLUS NET variant)
- SCALANCE X204-2FM
- SCALANCE X204-2LD (incl. SIPLUS NET variant) SCALANCE X204-2LD TS
- SCALANCE X204-2TS
- SCALANCE X206-1
- SCALANCE X206-1LD
- SCALANCE X208 (incl. SIPLUS NET variant)
- SCALANCE X208PRO
- SCALANCE X212-2 (incl. SIPLUS NET variant)
- SCALANCE X212-2LD
- SCALANCE X216
- SCALANCE X224
- SCALANCE XF204
- SCALANCE XF204-2 (incl. SIPLUS NET variant)
- SCALANCE XF206-1
- SCALANCE XF208

Siemens has identified the following specific workarounds and mitigations users can apply to reduce the risk:

- Limit network traffic of web servers of Scalance X switches to trusted connections by firewall rules (Ports 443/TCP
and 80/TCP).

As a general security measure, Siemens strongly recommends protecting network access to devices with appropriate
mechanisms. In order to operate the devices in a protected IT environment, Siemens recommends configuring the
environment according to Siemens operational guidelines for Industrial Security and following the recommendations in the
product manuals.

For additional information, please refer to Siemens Security Advisory SSA-187092");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:L/Au:N/C:P/I:P/A:P");
  script_set_cvss_temporal_vector("CVSS2#E:U/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:U/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2021-25668");

  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"false");
  script_cwe_id(122, 787);

  script_set_attribute(attribute:"vuln_publication_date", value:"2021/04/22");
  script_set_attribute(attribute:"patch_publication_date", value:"2021/04/22");
  script_set_attribute(attribute:"plugin_publication_date", value:"2023/01/25");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_x200-4p_irt_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_x201-3p_irt_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_x201-3p_irt_pro_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_x202-2_irt_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_x202-2p_irt_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_x202-2p_irt_pro_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_x204-2_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_x204-2fm_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_x204-2ld_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_x204-2ld_ts_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_x204-2ts_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_x204_irt_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_x204_irt_pro_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_x206-1_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_x206-1ld_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_x208_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_x208pro_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_x212-2_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_x212-2ld_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_x216_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_x224_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_xf201-3p_irt_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_xf202-2p_irt_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_xf204-2_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_xf204-2ba_irt_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_xf204_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_xf204_irt_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_xf206-1_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_xf208_firmware");
  script_set_attribute(attribute:"generated_plugin", value:"current");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2023-2024 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/Siemens");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/Siemens');

var asset = tenable_ot::assets::get(vendor:'Siemens');

var vuln_cpes = {
    "cpe:/o:siemens:scalance_x200-4p_irt_firmware" :
        {"versionEndExcluding" : "5.5.1", "family" : "SCALANCEX200IRT"},
    "cpe:/o:siemens:scalance_x201-3p_irt_firmware" :
        {"versionEndExcluding" : "5.5.1", "family" : "SCALANCEX200IRT"},
    "cpe:/o:siemens:scalance_x201-3p_irt_pro_firmware" :
        {"versionEndExcluding" : "5.5.1", "family" : "SCALANCEX200IRT"},
    "cpe:/o:siemens:scalance_x202-2_irt_firmware" :
        {"versionEndExcluding" : "5.5.1", "family" : "SCALANCEX200IRT"},
    "cpe:/o:siemens:scalance_x202-2p_irt_pro_firmware" :
        {"versionEndExcluding" : "5.5.1", "family" : "SCALANCEX200IRT"},
    "cpe:/o:siemens:scalance_x204_irt_firmware" :
        {"versionEndExcluding" : "5.5.1", "family" : "SCALANCEX200IRT"},
    "cpe:/o:siemens:scalance_x204_irt_pro_firmware" :
        {"versionEndExcluding" : "5.5.1", "family" : "SCALANCEX200IRT"},
    "cpe:/o:siemens:scalance_x204-2_firmware" :
        {"versionEndExcluding" : "5.2.5", "family" : "SCALANCEX200"},
    "cpe:/o:siemens:scalance_x204-2fm_firmware" :
        {"versionEndExcluding" : "5.2.5", "family" : "SCALANCEX200"},
    "cpe:/o:siemens:scalance_x204-2ld_firmware" :
        {"versionEndExcluding" : "5.2.5", "family" : "SCALANCEX200"},
    "cpe:/o:siemens:scalance_x204-2ld_ts_firmware" :
        {"versionEndExcluding" : "5.2.5", "family" : "SCALANCEX200"},
    "cpe:/o:siemens:scalance_x204-2ts_firmware" :
        {"versionEndExcluding" : "5.2.5", "family" : "SCALANCEX200"},
    "cpe:/o:siemens:scalance_x206-1_firmware" :
        {"versionEndExcluding" : "5.2.5", "family" : "SCALANCEX200"},
    "cpe:/o:siemens:scalance_x206-1ld_firmware" :
        {"versionEndExcluding" : "5.2.5", "family" : "SCALANCEX200"},
    "cpe:/o:siemens:scalance_x208_firmware" :
        {"versionEndExcluding" : "5.2.5", "family" : "SCALANCEX200"},
    "cpe:/o:siemens:scalance_x208pro_firmware" :
        {"versionEndExcluding" : "5.2.5", "family" : "SCALANCEX200"},
    "cpe:/o:siemens:scalance_x212-2_firmware" :
        {"versionEndExcluding" : "5.2.5", "family" : "SCALANCEX200"},
    "cpe:/o:siemens:scalance_x212-2ld_firmware" :
        {"versionEndExcluding" : "5.2.5", "family" : "SCALANCEX200"},
    "cpe:/o:siemens:scalance_x216_firmware" :
        {"versionEndExcluding" : "5.2.5", "family" : "SCALANCEX200"},
    "cpe:/o:siemens:scalance_x224_firmware" :
        {"versionEndExcluding" : "5.2.5", "family" : "SCALANCEX200"},
    "cpe:/o:siemens:scalance_xf201-3p_irt_firmware" :
        {"versionEndExcluding" : "5.5.1", "family" : "SCALANCEX200IRT"},
    "cpe:/o:siemens:scalance_xf202-2p_irt_firmware" :
        {"versionEndExcluding" : "5.5.1", "family" : "SCALANCEX200IRT"},
    "cpe:/o:siemens:scalance_xf204_firmware" :
        {"versionEndExcluding" : "5.2.5", "family" : "SCALANCEX200"},
    "cpe:/o:siemens:scalance_xf204_irt_firmware" :
        {"versionEndExcluding" : "5.5.1", "family" : "SCALANCEX200IRT"},
    "cpe:/o:siemens:scalance_xf204-2_firmware" :
        {"versionEndExcluding" : "5.2.5", "family" : "SCALANCEX200"},
    "cpe:/o:siemens:scalance_xf204-2ba_irt_firmware" :
        {"versionEndExcluding" : "5.5.1", "family" : "SCALANCEX200IRT"},
    "cpe:/o:siemens:scalance_xf206-1_firmware" :
        {"versionEndExcluding" : "5.2.5", "family" : "SCALANCEX200"},
    "cpe:/o:siemens:scalance_xf208_firmware" :
        {"versionEndExcluding" : "5.2.5", "family" : "SCALANCEX200"},
    "cpe:/o:siemens:scalance_x202-2p_irt_firmware" :
        {"versionEndExcluding" : "5.5.1", "family" : "SCALANCEX200IRT"}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_HOLE);
