#%NASL_MIN_LEVEL 80900
##
# (C) Tenable, Inc.
##

include('compat.inc');

if (description)
{
  script_id(501861);
  script_version("1.1");
  script_set_attribute(attribute:"plugin_modification_date", value:"2024/01/05");

  script_cve_id("CVE-2022-30310");

  script_name(english:"Festo CECC-X-M1 OS Command Injection (CVE-2022-30310)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"In Festo Controller CECC-X-M1 product family in multiple versions, the
http-endpoint cecc-x-acknerr-request POST request doesn't check for
port syntax. This can result in unauthorized execution of system
commands with root privileges due to improper access control command
injection.

This plugin only works with Tenable.ot.
Please visit https://www.tenable.com/products/tenable-ot for more information.");
  script_set_attribute(attribute:"see_also", value:"https://cert.vde.com/en/advisories/VDE-2022-020/");
  script_set_attribute(attribute:"solution", value:
"Refer to the vendor advisory.");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:L/Au:N/C:C/I:C/A:C");
  script_set_cvss_temporal_vector("CVSS2#E:U/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:U/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2022-30310");

  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"false");
  script_cwe_id(78, 863);

  script_set_attribute(attribute:"vuln_publication_date", value:"2022/06/13");
  script_set_attribute(attribute:"patch_publication_date", value:"2022/06/13");
  script_set_attribute(attribute:"plugin_publication_date", value:"2024/01/04");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:festo:controller_cecc-x-m1-mv-s1_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:festo:controller_cecc-x-m1-mv-s1_firmware:4.0.14");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:festo:controller_cecc-x-m1-mv_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:festo:controller_cecc-x-m1-mv_firmware:4.0.14");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:festo:controller_cecc-x-m1-y-yjkp_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:festo:controller_cecc-x-m1-ys-l1_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:festo:controller_cecc-x-m1-ys-l2_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:festo:controller_cecc-x-m1_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:festo:controller_cecc-x-m1_firmware:4.0.14");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2024 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/Festo");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/Festo');

var asset = tenable_ot::assets::get(vendor:'Festo');

var vuln_cpes = {
    "cpe:/o:festo:controller_cecc-x-m1_firmware" :
        {"versionEndIncluding" : "3.8.14", "family" : "CECC"},
    "cpe:/o:festo:controller_cecc-x-m1_firmware:4.0.14" :
        {"versionEndIncluding" : "4.0.14", "versionStartIncluding" : "4.0.14", "family" : "CECC"},
    "cpe:/o:festo:controller_cecc-x-m1-mv_firmware" :
        {"versionEndIncluding" : "3.8.14", "family" : "CECC"},
    "cpe:/o:festo:controller_cecc-x-m1-mv_firmware:4.0.14" :
        {"versionEndIncluding" : "4.0.14", "versionStartIncluding" : "4.0.14", "family" : "CECC"},
    "cpe:/o:festo:controller_cecc-x-m1-mv-s1_firmware" :
        {"versionEndIncluding" : "3.8.14", "family" : "CECC"},
    "cpe:/o:festo:controller_cecc-x-m1-mv-s1_firmware:4.0.14" :
        {"versionEndIncluding" : "4.0.14", "versionStartIncluding" : "4.0.14", "family" : "CECC"},
    "cpe:/o:festo:controller_cecc-x-m1-ys-l1_firmware" :
        {"versionEndIncluding" : "3.8.14", "family" : "CECC"},
    "cpe:/o:festo:controller_cecc-x-m1-ys-l2_firmware" :
        {"versionEndIncluding" : "3.8.14", "family" : "CECC"},
    "cpe:/o:festo:controller_cecc-x-m1-y-yjkp_firmware" :
        {"versionEndIncluding" : "3.8.14", "family" : "CECC"}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_HOLE);
