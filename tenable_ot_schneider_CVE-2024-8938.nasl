#%NASL_MIN_LEVEL 80900
##
# (C) Tenable, Inc.
##

include('compat.inc');

if (description)
{
  script_id(502687);
  script_version("1.4");
  script_set_attribute(attribute:"plugin_modification_date", value:"2025/04/18");

  script_cve_id("CVE-2024-8938");
  script_xref(name:"ICSA", value:"24-326-04");

  script_name(english:"Schneider Electric Modicon M340, MC80, and Momentum Unity M1E Improper Restriction of Operations Within the Bounds of a Memory Buffer (CVE-2024-8938)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"Arbitrary code execution can potentially be achieved after a successful 
Man-In-The Middle attack followed by sending a crafted Modbus function 
call to tamper with memory area involved in memory size computation.

This plugin only works with Tenable.ot.
Please visit https://www.tenable.com/products/tenable-ot for more information.");
  # https://download.schneider-electric.com/files?p_Doc_Ref=SEVD-2024-317-03&p_enDocType=Security+and+Safety+Notice&p_File_Name=SEVD-2024-317-03.pdf
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?05e64114");
  script_set_attribute(attribute:"see_also", value:"https://www.cisa.gov/news-events/ics-advisories/icsa-24-326-04");
  script_set_attribute(attribute:"solution", value:
'The following text was originally created by the Cybersecurity and Infrastructure Security Agency (CISA). The original
can be found at CISA.gov.

Schneider Electric has identified the following specific workarounds and mitigations users can apply to reduce risk:

Schneider Electric Modicon M340 CPU (part numbers BMXP34*) Versions prior to SV3.65:

- Version SV3.65 of Modicon M340 firmware includes a fix for these vulnerabilities and is available for download here:
https://www.se.com/ww/en/product-range/1468- modicon-m340

If customers choose not to apply the remediation provided above, they should immediately apply the following mitigations
to reduce the risk of exploit:

- Set up network segmentation and implement a firewall to block all unauthorized access to port 502/TCP
- Configure the Access Control List following the recommendations of the user manuals: "Modicon M340 for Ethernet
Communications Modules and Processors User Manual" chapter "Messaging Configuration Parameters":
https://www.se.com/ww/en/download/document/31007131K01000/
- Consider use of external firewall devices such as EAGLE40-07 from Belden to establish VPN connections. For more
details refer to "Modicon Controller Systems Cybersecurity, User Guide":
https://www.se.com/ww/en/download/document/EIO0000001999/
- Ensure the M340 CPU is running with the memory protection activated by configuring the input bit to a physical input,
for more details refer to the following guideline "Modicon Controller Systems Cybersecurity, User Guide" chapter
"Controler Memory Protection": https://www.se.com/ww/en/download/document/EIO0000001999/
- Setup network segmentation and implement a firewall to block all unauthorized access to port 502/TCP
- Consider use of external firewall devices such as EAGLE40-07 from Belden to establish VPN connections. For more
details refer to "Modicon Controller Systems Cybersecurity, User Guide":
https://www.se.com/ww/en/download/document/EIO0000001999/
- Ensure the M340 CPU is running with the memory protection activated by configuring the input bit to a physical input,
for more details refer to the following guideline "Modicon Controller Systems Cybersecurity, User Guide" chapter
"Controler Memory Protection": https://www.se.com/ww/en/download/document/EIO0000001999/

Schneider Electric Modicon MC80 (part numbers BMKC80) All versions:

Schneider Electric is establishing a remediation plan for all future versions of Modicon MC80 that will include fixes
for CVE-2024-8937 and CVE-2024- 8938. Schneider Electric will update this document when the remediations are available.
Until then, customers should immediately apply the following mitigations to reduce the risk of exploit:

- Setup network segmentation and implement a firewall to block all unauthorized access to port 502/TCP
- Configure the Access Control List following the recommendations of the user manuals: "MC80 Programmable Logic
Controller (PLC), User Manual" in the section "Access Control List (ACL)":
https://www.se.com/ww/en/download/document/EIO0000002071/
- Consider use of external firewall devices such as EAGLE40-07 from Belden to establish VPN connections. For more
details refer to "Modicon Controller Systems Cybersecurity, User Guide":
https://www.se.com/ww/en/download/document/EIO0000001999/

Schneider Electric Modicon Momentum Unity M1E Processor (171CBU*) Versions prior to SV2.80:

- Version SV2.80 of Modicon Momentum firmware includes a fix for these vulnerabilities and is available for download
here: https://www.se.com/ww/en/product-range/535-modicon-momentumIf customers choose not to apply the remediation
provided above, they should immediately apply the following mitigations to reduce the risk of exploit:
- Setup network segmentation and implement a firewall to block all unauthorized access to port 502/TCP
- Configure the Access Control List following the recommendations of the user manuals: "Momentum for EcoStruxure Control
Expert -171CBU78090, 171CBU98090, 171CBU98091 Processors, User Guide" in the section "Controlling Access":
https://www.se.com/ww/en/download/document/HRB44124/
- Consider use of external firewall devices such as EAGLE40-07 from Belden to establish VPN connections. For more
details refer to "Modicon Controller Systems Cybersecurity, User Guide":
https://www.se.com/ww/en/download/document/EIO0000001999/

For more information see the associated Schneider Electric CPCERT security advisory SEVD-2024-317-03 Modicon Controllers
M340 / Momentum / MC80 - SEVD-2024-317-03 PDF Version, Modicon Controllers M340 / Momentum / MC80 - SEVD-2024-317-03
CSAF Version.');
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:H");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:U/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2024-8938");

  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"false");
  script_cwe_id(119);

  script_set_attribute(attribute:"vuln_publication_date", value:"2024/11/12");
  script_set_attribute(attribute:"patch_publication_date", value:"2024/11/12");
  script_set_attribute(attribute:"plugin_publication_date", value:"2024/11/28");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_m340");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_mc80");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_momentum_171cbu78090_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_momentum_171cbu98090_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_momentum_171cbu98091_firmware");
  script_set_attribute(attribute:"generated_plugin", value:"former");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2024-2025 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/Schneider");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/Schneider');

var asset = tenable_ot::assets::get(vendor:'Schneider');

var vuln_cpes = {
    "cpe:/o:schneider-electric:modicon_m340" :
        {"versionEndExcluding" : "SV3.65", "family" : "ModiconM340"},
    "cpe:/o:schneider-electric:modicon_mc80" :
        {"family" : "ModiconMC80"},
    "cpe:/o:schneider-electric:modicon_momentum_171cbu78090_firmware:-" :
        {"family" : "MomentumUnity"},
    "cpe:/o:schneider-electric:modicon_momentum_171cbu98090_firmware:-" :
        {"family" : "MomentumUnity"},
    "cpe:/o:schneider-electric:modicon_momentum_171cbu98091_firmware:-" :
        {"family" : "MomentumUnity"}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_HOLE);
