#%NASL_MIN_LEVEL 80900
##
# (C) Tenable, Inc.
##

include('compat.inc');

if (description)
{
  script_id(193255);
  script_version("1.11");
  script_set_attribute(attribute:"plugin_modification_date", value:"2024/07/12");

  script_cve_id("CVE-2024-3400");
  script_xref(name:"CISA-KNOWN-EXPLOITED", value:"2024/04/19");
  script_xref(name:"IAVA", value:"2024-A-0230-S");

  script_name(english:"Palo Alto Networks PAN-OS CVE-2024-3400");

  script_set_attribute(attribute:"synopsis", value:
"The remote PAN-OS host is affected by a vulnerability");
  script_set_attribute(attribute:"description", value:
"The version of Palo Alto Networks PAN-OS running on the remote host is affected by a command injection
vulnerability as a result of arbitrary file creation vulnerability in the GlobalProtect feature of
Palo Alto Networks PAN-OS software for specific PAN-OS versions and distinct feature configurations may
enable an unauthenticated attacker to execute arbitrary code with root privileges on the firewall.

Note that Nessus has not tested for this issue but has instead relied only on the application's self-reported version
number.");
  # https://www.volexity.com/blog/2024/04/12/zero-day-exploitation-of-unauthenticated-remote-code-execution-vulnerability-in-globalprotect-cve-2024-3400/
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?9a9a8f24");
  script_set_attribute(attribute:"see_also", value:"https://security.paloaltonetworks.com/CVE-2024-3400");
  script_set_attribute(attribute:"see_also", value:"https://unit42.paloaltonetworks.com/cve-2024-3400/");
  script_set_attribute(attribute:"see_also", value:"https://www.paloaltonetworks.com/blog/2024/04/more-on-the-pan-os-cve/");
  script_set_attribute(attribute:"solution", value:
"Apply update from vendor advisory.");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:L/Au:N/C:C/I:C/A:C");
  script_set_cvss_temporal_vector("CVSS2#E:H/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:H/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2024-3400");

  script_set_attribute(attribute:"exploitability_ease", value:"Exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"true");
  script_set_attribute(attribute:"exploit_framework_core", value:"true");
  script_set_attribute(attribute:"exploited_by_malware", value:"true");
  script_set_attribute(attribute:"metasploit_name", value:'Palo Alto Networks PAN-OS Unauthenticated Remote Code Execution');
  script_set_attribute(attribute:"exploit_framework_metasploit", value:"true");
  script_cwe_id(20, 77);

  script_set_attribute(attribute:"vuln_publication_date", value:"2024/04/12");
  script_set_attribute(attribute:"patch_publication_date", value:"2024/04/12");
  script_set_attribute(attribute:"plugin_publication_date", value:"2024/04/12");

  script_set_attribute(attribute:"potential_vulnerability", value:"true");
  script_set_attribute(attribute:"plugin_type", value:"combined");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:paloaltonetworks:pan-os");
  script_set_attribute(attribute:"generated_plugin", value:"former");
  script_set_attribute(attribute:"stig_severity", value:"I");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Palo Alto Local Security Checks");

  script_copyright(english:"This script is Copyright (C) 2024 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("palo_alto_version.nbin");
  script_require_keys("Host/Palo_Alto/Firewall/Version", "Host/Palo_Alto/Firewall/Full_Version", "Host/Palo_Alto/Firewall/Source", "Settings/ParanoidReport");

  exit(0);
}

include('vcf.inc');
include('vcf_extras.inc');

vcf::palo_alto::initialize();

var app_name = 'Palo Alto Networks PAN-OS';

var app_info = vcf::get_app_info(app:app_name, kb_ver:'Host/Palo_Alto/Firewall/Full_Version', kb_source:'Host/Palo_Alto/Firewall/Source');

if (report_paranoia < 2) audit(AUDIT_PARANOID);

var constraints = [
  { 'min_version' : '10.2.0', 'fixed_version' : '10.2.0-h3' },
  { 'min_version' : '10.2.1', 'fixed_version' : '10.2.1-h2' },
  { 'min_version' : '10.2.2', 'fixed_version' : '10.2.2-h5' },
  { 'min_version' : '10.2.3', 'fixed_version' : '10.2.3-h13' },
  { 'min_version' : '10.2.4', 'fixed_version' : '10.2.4-h16' },
  { 'min_version' : '10.2.5', 'fixed_version' : '10.2.5-h6' },
  { 'min_version' : '10.2.6', 'fixed_version' : '10.2.6-h3' },
  { 'min_version' : '10.2.7', 'fixed_version' : '10.2.7-h8' },
  { 'min_version' : '10.2.8', 'fixed_version' : '10.2.8-h3' },
  { 'min_version' : '10.2.9', 'fixed_version' : '10.2.9-h1' },
  { 'min_version' : '11.0.0', 'fixed_version' : '11.0.0-h3' },
  { 'min_version' : '11.0.1', 'fixed_version' : '11.0.1-h4' },
  { 'min_version' : '11.0.2', 'fixed_version' : '11.0.2-h4' },
  { 'min_version' : '11.0.3', 'fixed_version' : '11.0.3-h10' },
  { 'min_version' : '11.0.4', 'fixed_version' : '11.0.4-h1' },
  { 'min_version' : '11.1.0', 'fixed_version' : '11.1.0-h3' },
  { 'min_version' : '11.1.1', 'fixed_version' : '11.1.1-h1' },
  { 'min_version' : '11.1.2', 'fixed_version' : '11.1.2-h3' }
];

vcf::check_version_and_report(
    app_info:app_info,
    constraints:constraints,
    severity:SECURITY_HOLE
);
