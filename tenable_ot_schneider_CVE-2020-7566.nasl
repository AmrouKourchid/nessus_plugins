#%NASL_MIN_LEVEL 80900
##
# (C) Tenable, Inc.
##

include('compat.inc');

if (description)
{
  script_id(500864);
  script_version("1.8");
  script_set_attribute(attribute:"plugin_modification_date", value:"2024/09/04");

  script_cve_id("CVE-2020-7566");
  script_xref(name:"ICSA", value:"20-343-04");

  script_name(english:"Schneider Electric Modicon M221 Programmable Logic Controller Small Space of Random Values (CVE-2020-7566)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"A CWE-334: Small Space of Random Values vulnerability exists in
Modicon M221 (all references, all versions) that could allow the
attacker to break the encryption keys when the attacker has captured
the traffic between EcoStruxure Machine - Basic software and Modicon
M221 controller.

This plugin only works with Tenable.ot.
Please visit https://www.tenable.com/products/tenable-ot for more information.");
  script_set_attribute(attribute:"see_also", value:"https://www.se.com/ww/en/download/document/SEVD-2020-315-05/");
  script_set_attribute(attribute:"see_also", value:"https://us-cert.cisa.gov/ics/advisories/icsa-20-343-04");
  script_set_attribute(attribute:"solution", value:
"The following text was originally created by the Cybersecurity and Infrastructure Security Agency (CISA). The original
can be found at CISA.gov.

Schneider Electric recommends users to apply the following mitigations to help reduce the risk of exploit:

- Set up network segmentation and implement a firewall to block all unauthorized access to Port 502/TCP.
- Within the Modicon M221 application, the user must: 
    - Disable all unused protocols, especially programming protocol, as described in section “Configuring Ethernet
Network” of EcoStruxure Machine Expert - Basic online help for the M221 PLC. This action will prevent unintended remote
programming access.
    - Set a password to protect the project.
    - Set a password for read access on the controller.
    - Set a different password for write access on the controller.

Schneider Electric strongly recommends following industry cybersecurity best practices:

- Locate control and safety system networks and remote devices behind firewalls and isolate them from the business
network.
- Install physical controls so no unauthorized personnel can access industrial control and safety systems, components,
peripheral equipment, and networks.
- Place all controllers in locked cabinets and never leave them in the “Program” mode.
- Never connect programming software to any network other than the network for which the devices were intended.
- Scan all methods of mobile data exchange with the isolated network (e.g., CDs, USB drives, etc.) before use in the
terminals or any node connected to these networks.
- Never allow mobile devices that have connected to any other network, besides the intended network, to connect to the
safety or control networks without proper sanitation.
- Minimize network exposure for all control system devices and systems and ensure that they are not accessible from the
Internet.
- When remote access is required, use secure methods such as virtual private networks (VPNs). Recognize that VPNs may
have vulnerabilities and should be updated to the most current version available. Also, understand that VPNs are only as
secure as the connected devices.

For more information refer to the Schneider Electric Recommended Cybersecurity Best Practices document.

Refer to Schneider Electric’s security bulletin SEVD-2020-315-05 for specific mitigation details.");
  script_set_cvss_base_vector("CVSS2#AV:A/AC:M/Au:N/C:P/I:P/A:N");
  script_set_cvss_temporal_vector("CVSS2#E:U/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:A/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:N");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:U/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2020-7566");

  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"false");
  script_cwe_id(334);

  script_set_attribute(attribute:"vuln_publication_date", value:"2020/11/19");
  script_set_attribute(attribute:"patch_publication_date", value:"2020/11/19");
  script_set_attribute(attribute:"plugin_publication_date", value:"2023/03/01");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_m100_series_firmware:-");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_m200_series_firmware:-");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_m221_series_firmware:-");
  script_set_attribute(attribute:"generated_plugin", value:"former");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2023-2024 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/Schneider");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/Schneider');

var asset = tenable_ot::assets::get(vendor:'Schneider');

var vuln_cpes = {
    "cpe:/o:schneider-electric:modicon_m221_series_firmware:-" :
        {"family" : "ModiconM221"},
    "cpe:/o:schneider-electric:modicon_m100_series_firmware:-" :
        {"family" : "ModiconEasyM100"},
    "cpe:/o:schneider-electric:modicon_m200_series_firmware:-" :
        {"family" : "ModiconEasyM200"}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_WARNING);
