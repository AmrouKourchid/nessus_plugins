#%NASL_MIN_LEVEL 80900
##
# (C) Tenable, Inc.
##

include('xcompat.inc');

if (description)
{
  script_id(232730);
  script_version("1.1");
  xscript_set_attribute(attribute:"plugin_modification_date", value:"2025/03/14");

  script_cve_id("CVE-2025-0337");
  script_xref(name:"IAVA", value:"2025-A-0180");

  script_name(english:"ServiceNow Platform Authorization Bypass (CVE-2025-0337)");

  xscript_set_attribute(attribute:"synopsis", value:
"ServiceNow Platform is affected by a Authorization Bypass vulnerability.");
  xscript_set_attribute(attribute:"description", value:
"ServiceNow has addressed an authorization bypass vulnerability that was identified in the Washington release 
 of the Now Platform. This vulnerability, if exploited, potentially could enable an authenticated user to access data
 stored within the Now Platform that the user otherwise would not be entitled to access. CVE-2025-0337");
  # https://support.servicenow.com/kb?id=kb_article_view&sysparm_article=KB1948695
  xscript_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?1b7109be");
  xscript_set_attribute(attribute:"solution", value:
"Upgrade to the version referenced in the vendor advisory.");
  xscript_set_cvss_base_vector("CVSS2#AV:N/AC:L/Au:S/C:C/I:N/A:N");
  xscript_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N");
  xscript_set_attribute(attribute:"cvss_score_source", value:"CVE-2025-0337");

  xscript_set_attribute(attribute:"vuln_publication_date", value:"2025/03/06");
  xscript_set_attribute(attribute:"patch_publication_date", value:"2025/03/06");
  xscript_set_attribute(attribute:"plugin_publication_date", value:"2025/03/14");

  xscript_set_attribute(attribute:"plugin_type", value:"remote");
  xscript_set_attribute(attribute:"cpe", value:"cpe:/a:servicenow:servicenow");
  xscript_set_attribute(attribute:"stig_severity", value:"I");
  xscript_end_attributes();

  script_category(ACT_ATTACK);
  script_family(english:"CGI abuses");

  script_copyright(english:"This script is Copyright (C) 2025 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("servicenow_platform_web_detect.nbin");
  script_require_keys("installed_sw/ServiceNow Platform");
  script_require_ports("Services/www", 443);

  exit(0);
}

include('webapp_func.inc');
include('vcf.inc');

function is_vuln(release, patch)
{
    if (release >< 'Washington DC')
    {
        if (patch < 9) return 'Washington DC Patch 9';
    } 
    else if (release >< 'Xanadu')
    {
        if (patch < 4) return 'Xanadu Patch 4';
    } 
    else if (release >< 'Yokohama')
    {
        if (patch < 1) return 'Yokohama General Availability Patch 1';
    }
}

var app = 'ServiceNow Platform';

# Exit if app is not detected on host
get_install_count(app_name:app, exit_if_zero:TRUE);

# Exit if app is not detected on this http port
var port = get_http_port(default:443);
var install = get_single_install(
  app_name : app,
  port     : port
);

var release = install['Release'];
var patch = install['Patch'];

var fix_version = is_vuln(release: release, patch: patch);
if (!empty_or_null(fix_version))
{
    vcf::report_results(app_info: install, fix: fix_version, severity: SECURITY_HOLE);
}
else {
    audit(AUDIT_INST_VER_NOT_VULN, app);
}