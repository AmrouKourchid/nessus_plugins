#%NASL_MIN_LEVEL 80900
##
# (C) Tenable, Inc.
##

include('deprecated_nasl_level.inc');
include('compat.inc');

if (description)
{
  script_id(502219);
  script_version("1.7");
  script_set_attribute(attribute:"plugin_modification_date", value:"2025/03/17");

  script_cve_id("CVE-2023-5678");
  script_xref(name:"ICSA", value:"24-102-01");
  script_xref(name:"ICSA", value:"25-044-09");

  script_name(english:"Siemens SIMATIC S7-1500 Improper Check for Unusual or Exceptional Conditions (CVE-2023-5678)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"Issue summary: Generating excessively long X9.42 DH keys or checking
excessively long X9.42 DH keys or parameters may be very slow. Impact
summary: Applications that use the functions DH_generate_key() to
generate an X9.42 DH key may experience long delays. Likewise,
applications that use DH_check_pub_key(), DH_check_pub_key_ex() or
EVP_PKEY_public_check() to check an X9.42 DH key or X9.42 DH
parameters may experience long delays. Where the key or parameters
that are being checked have been obtained from an untrusted source
this may lead to a Denial of Service. While DH_check() performs all
the necessary checks (as of CVE-2023-3817), DH_check_pub_key() doesn't
make any of these checks, and is therefore vulnerable for excessively
large P and Q parameters. Likewise, while DH_generate_key() performs a
check for an excessively large P, it doesn't check for an excessively
large Q. An application that calls DH_generate_key() or
DH_check_pub_key() and supplies a key or parameters obtained from an
untrusted source could be vulnerable to a Denial of Service attack.
DH_generate_key() and DH_check_pub_key() are also called by a number
of other OpenSSL functions. An application calling any of those other
functions may similarly be affected. The other functions affected by
this are DH_check_pub_key_ex(), EVP_PKEY_public_check(), and
EVP_PKEY_generate(). Also vulnerable are the OpenSSL pkey command line
application when using the -pubcheck option, as well as the OpenSSL
genpkey command line application. The OpenSSL SSL/TLS implementation
is not affected by this issue. The OpenSSL 3.0 and 3.1 FIPS providers
are not affected by this issue.

This plugin only works with Tenable.ot.
Please visit https://www.tenable.com/products/tenable-ot for more information.");
  script_set_attribute(attribute:"see_also", value:"https://cert-portal.siemens.com/productcert/pdf/ssa-794697.pdf");
  script_set_attribute(attribute:"see_also", value:"https://cert-portal.siemens.com/productcert/html/ssa-398330.html");
  script_set_attribute(attribute:"see_also", value:"https://cert-portal.siemens.com/productcert/html/ssa-265688.html");
  script_set_attribute(attribute:"see_also", value:"https://cert-portal.siemens.com/productcert/pdf/ssa-556635.pdf");
  script_set_attribute(attribute:"see_also", value:"https://cert-portal.siemens.com/productcert/pdf/ssa-128433.pdf");
  script_set_attribute(attribute:"see_also", value:"https://cert-portal.siemens.com/productcert/pdf/ssa-093430.pdf");
  script_set_attribute(attribute:"see_also", value:"https://cert-portal.siemens.com/productcert/pdf/ssa-341067.pdf");
  script_set_attribute(attribute:"see_also", value:"https://cert-portal.siemens.com/productcert/html/ssa-915275.html");
  script_set_attribute(attribute:"see_also", value:"https://cert-portal.siemens.com/productcert/html/ssa-331112.html");
  script_set_attribute(attribute:"see_also", value:"https://cert-portal.siemens.com/productcert/html/ssa-769027.html");
  script_set_attribute(attribute:"see_also", value:"https://support.industry.siemens.com/cs/ww/en/view/109955177/");
  script_set_attribute(attribute:"see_also", value:"https://support.industry.siemens.com/cs/ww/en/view/109827684/");
  script_set_attribute(attribute:"see_also", value:"https://support.industry.siemens.com/cs/ww/en/view/109955597/");
  script_set_attribute(attribute:"see_also", value:"https://support.industry.siemens.com/cs/ww/en/view/109977720/");
  script_set_attribute(attribute:"see_also", value:"https://support.industry.siemens.com/cs/ww/en/view/109954920/");
  script_set_attribute(attribute:"see_also", value:"https://support.industry.siemens.com/cs/ww/en/view/109975745/");
  script_set_attribute(attribute:"see_also", value:"https://support.industry.siemens.com/cs/ww/en/view/109974917/");
  script_set_attribute(attribute:"see_also", value:"https://www.cisa.gov/news-events/ics-advisories/icsa-24-102-01");
  script_set_attribute(attribute:"see_also", value:"https://www.cisa.gov/news-events/ics-advisories/icsa-25-044-09");
  script_set_attribute(attribute:"solution", value:
"Siemens has identified the following specific workarounds and mitigations that customers can apply to reduce the risk: 

- Only build and run applications from trusted sources 

Product-specific remediations or mitigations can be found in the section 'Affected Products and Solution' of 
the vendor advisory. 

For more information, see the associated Siemens security advisory in HTML and CSAF.");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:L/Au:N/C:N/I:N/A:P");
  script_set_cvss_temporal_vector("CVSS2#E:U/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:L");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:P/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2023-5678");

  script_set_attribute(attribute:"exploitability_ease", value:"Exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"true");
  script_cwe_id(754);

  script_set_attribute(attribute:"vuln_publication_date", value:"2024/04/09");
  script_set_attribute(attribute:"patch_publication_date", value:"2024/04/09");
  script_set_attribute(attribute:"plugin_publication_date", value:"2024/04/22");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_wab762-1_firmware:3.0.0");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_wam763-1_%28me%29_firmware:3.0.0");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_wam763-1_%28us%29_firmware:3.0.0");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_wam763-1_firmware:3.0.0");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_wam766-1_%28me%29_firmware:3.0.0");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_wam766-1_%28us%29_firmware:3.0.0");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_wam766-1_eec_%28me%29_firmware:3.0.0");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_wam766-1_eec_%28us%29_firmware:3.0.0");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_wam766-1_eec_firmware:3.0.0");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_wam766-1_firmware:3.0.0");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_wub762-1_firmware:3.0.0");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_wub762-1_ifeatures_firmware:3.0.0");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_wum763-1_%28us%29_firmware:3.0.0");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_wum763-1_firmware:3.0.0");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_wum766-1_%28me%29_firmware:3.0.0");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_wum766-1_%28usa%29_firmware:3.0.0");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_wum766-1_firmware:3.0.0");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-1500_cpu_firmware:3.1.0");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-1500_tm_mfp");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siplus_s7-1500_cpu_firmware:3.1.0");
  script_set_attribute(attribute:"generated_plugin", value:"former");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2024-2025 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/Siemens");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/Siemens');

var asset = tenable_ot::assets::get(vendor:'Siemens');

var vuln_cpes = {
    "cpe:/o:siemens:simatic_s7-1500_tm_mfp" :
        {"versionEndExcluding" : "1.1", "family" : "S71500", "orderNumbers": ["6ES7558-1AA00-0AB0"]},
    "cpe:/o:siemens:simatic_s7-1500_cpu_firmware:3.1.0" :
        {"versionStartIncluding" : "3.1.0", "family" : "S71500", "orderNumbers" : ['6ES7518-4AX00-1AB0', '6ES7518-4FX00-1AC0', '6ES7518-4FX00-1AB0', '6ES7518-4AX00-1AC0']},
    "cpe:/o:siemens:siplus_s7-1500_cpu_firmware:3.1.0" :
        {"versionStartIncluding" : "3.1.0", "family" : "S71500", "orderNumbers" : ['6AG1518-4AX00-4AC0']},
    "cpe:/o:siemens:scalance_wab762-1_firmware:3.0.0" :
        {"versionEndExcluding" : "3.0.0", "family" : "SCALANCEW", "orderNumbers" : ['6GK5762-1AJ00-6AA0']},
    "cpe:/o:siemens:scalance_wam763-1_firmware:3.0.0" :
        {"versionEndExcluding" : "3.0.0", "family" : "SCALANCEW", "orderNumbers" : ['6GK5763-1AL00-7DA0']},
    "cpe:/o:siemens:scalance_wam763-1_%28me%29_firmware:3.0.0" :
        {"versionEndExcluding" : "3.0.0", "family" : "SCALANCEW", "orderNumbers" : ['6GK5763-1AL00-7DC0']},
    "cpe:/o:siemens:scalance_wam763-1_%28us%29_firmware:3.0.0" :
        {"versionEndExcluding" : "3.0.0", "family" : "SCALANCEW", "orderNumbers" : ['6GK5763-1AL00-7DB0']},
    "cpe:/o:siemens:scalance_wam766-1_firmware:3.0.0" :
        {"versionEndExcluding" : "3.0.0", "family" : "SCALANCEW", "orderNumbers" : ['6GK5766-1GE00-7DA0']},
    "cpe:/o:siemens:scalance_wam766-1_%28me%29_firmware:3.0.0" :
        {"versionEndExcluding" : "3.0.0", "family" : "SCALANCEW", "orderNumbers" : ['6GK5766-1GE00-7DC0']},
    "cpe:/o:siemens:scalance_wam766-1_%28us%29_firmware:3.0.0" :
        {"versionEndExcluding" : "3.0.0", "family" : "SCALANCEW", "orderNumbers" : ['6GK5766-1GE00-7DB0']},
    "cpe:/o:siemens:scalance_wam766-1_eec_firmware:3.0.0" :
        {"versionEndExcluding" : "3.0.0", "family" : "SCALANCEW", "orderNumbers" : ['6GK5766-1GE00-7TA0']},
    "cpe:/o:siemens:scalance_wam766-1_eec_%28me%29_firmware:3.0.0" :
        {"versionEndExcluding" : "3.0.0", "family" : "SCALANCEW", "orderNumbers" : ['6GK5766-1GE00-7TC0']},
    "cpe:/o:siemens:scalance_wam766-1_eec_%28us%29_firmware:3.0.0" :
        {"versionEndExcluding" : "3.0.0", "family" : "SCALANCEW", "orderNumbers" : ['6GK5766-1GE00-7TB0']},
    "cpe:/o:siemens:scalance_wub762-1_firmware:3.0.0" :
        {"versionEndExcluding" : "3.0.0", "family" : "SCALANCEW", "orderNumbers" : ['6GK5762-1AJ00-1AA0']},
    "cpe:/o:siemens:scalance_wub762-1_ifeatures_firmware:3.0.0" :
        {"versionEndExcluding" : "3.0.0", "family" : "SCALANCEW", "orderNumbers" : ['6GK5762-1AJ00-2AA0']},
    "cpe:/o:siemens:scalance_wum763-1_firmware:3.0.0" :
        {"versionEndExcluding" : "3.0.0", "family" : "SCALANCEW", "orderNumbers" : ['6GK5763-1AL00-3AA0', '6GK5763-1AL00-3DA0']},
    "cpe:/o:siemens:scalance_wum763-1_%28us%29_firmware:3.0.0" :
        {"versionEndExcluding" : "3.0.0", "family" : "SCALANCEW", "orderNumbers" : ['6GK5763-1AL00-3DB0', '6GK5763-1AL00-3AB0']},
    "cpe:/o:siemens:scalance_wum766-1_firmware:3.0.0" :
        {"versionEndExcluding" : "3.0.0", "family" : "SCALANCEW", "orderNumbers" : ['6GK5766-1GE00-3DA0']},
    "cpe:/o:siemens:scalance_wum766-1_%28me%29_firmware:3.0.0" :
        {"versionEndExcluding" : "3.0.0", "family" : "SCALANCEW", "orderNumbers" : ['6GK5766-1GE00-3DC0']},
    "cpe:/o:siemens:scalance_wum766-1_%28usa%29_firmware:3.0.0" :
        {"versionEndExcluding" : "3.0.0", "family" : "SCALANCEW", "orderNumbers" : ['6GK5766-1GE00-3DB0']}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_WARNING);
