#%NASL_MIN_LEVEL 70300
##
# (C) Tenable, Inc.
##

include('deprecated_nasl_level.inc');
include('compat.inc');

if (description)
{
  script_id(500121);
  script_version("1.9");
  script_set_attribute(attribute:"plugin_modification_date", value:"2024/10/01");

  script_cve_id("CVE-2016-8672");
  script_xref(name:"ICSA", value:"16-327-02");

  script_name(english:"Siemens SIMATIC CP 343-1/CP 443-1 Modules and SIMATIC S7-300/S7-400 CPUs (CVE-2016-8672)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"A vulnerability has been identified in SIMATIC CP 343-1 Advanced
(incl. SIPLUS NET variant) (All versions < V3.0.53), SIMATIC CP 443-1
Advanced (incl. SIPLUS NET variant) (All versions < V3.2.17), SIMATIC
S7-300 PN/DP CPU family (incl. SIPLUS variants) (All versions),
SIMATIC S7-400 PN/DP CPU family (incl. SIPLUS variants) (All
versions). The integrated web server delivers cookies without the
secure flag. Modern browsers interpreting the flag would mitigate
potential data leakage in case of clear text transmission.

This plugin only works with Tenable.ot.
Please visit https://www.tenable.com/products/tenable-ot for more information.");
  script_set_attribute(attribute:"see_also", value:"https://cert-portal.siemens.com/productcert/pdf/ssa-603476.pdf");
  script_set_attribute(attribute:"see_also", value:"https://www.cisa.gov/news-events/ics-advisories/icsa-16-327-02");
  script_set_attribute(attribute:"solution", value:
"The following text was originally created by the Cybersecurity and Infrastructure Security Agency (CISA). The original
can be found at CISA.gov.

Siemens provides firmware versions that fix the vulnerabilities and recommends that users update to the fixed versions:

- SIMATIC CP 343-1 Advanced: Update to v3.0.53.
- SIMATIC CP 443-1 Advanced: Update to v3.2.17.

For SIMATIC S7-300/S7-400 CPUs, Siemens recommends the following mitigations:

- Apply cell protection concept,
- Use VPN for protecting network communication between cells, and
- Apply defense-in-depth.

Siemens strongly recommends users protect network access to SIMATIC S7-300/S7-400 CPUs and to the web interface of
SIMATIC CP 343-1 Advanced and CP 443-1 Advanced devices with appropriate mechanisms. Siemens also advises that users
configure the protected operational environment according to Siemensâ€™ Operational Guidelines for Industrial Security.

For more information on this vulnerability and more detailed mitigation instructions, please see Siemens Security
Advisory SSA-603476 at the following location: http://www.siemens.com/cert/advisories");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:L/Au:N/C:P/I:N/A:N");
  script_set_cvss_temporal_vector("CVSS2#E:U/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:U/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2016-8672");

  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"false");
  script_cwe_id(200);

  script_set_attribute(attribute:"vuln_publication_date", value:"2016/11/23");
  script_set_attribute(attribute:"patch_publication_date", value:"2016/11/23");
  script_set_attribute(attribute:"plugin_publication_date", value:"2022/02/07");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_cp_343-1_advanced_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_cp_443-1_advanced_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7_300_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_et_200_cpu_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7_400_pn%2fdp_firmware");
  script_set_attribute(attribute:"generated_plugin", value:"former");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2022-2024 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/Siemens");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/Siemens');

var asset = tenable_ot::assets::get(vendor:'Siemens');

var vuln_cpes = {
    "cpe:/o:siemens:simatic_cp_343-1_advanced_firmware" :
        {"family" : "S7300", "versionEndExcluding" : "3.0.53", "orderNumbers" : ["6GK7343-1GX20-0XE0","6GK7343-1GX21-0XE0","6GK7343-1GX30-0XE0","6GK7343-1GX31-0XE0","6AG1343-1GX20-4XE0","6AG1343-1GX21-4XE0","6AG1343-1GX30-4XE0","6AG1343-1GX31-4XE0"]},
    "cpe:/o:siemens:simatic_s7_400_pn%2fdp_firmware" :
        {"family" : "S7400", "orderNumbers" : ["6ES7414-3EM07-0AB0","6ES7414-3FM07-0AB0","6ES7416-3ES07-0AB0","6ES7416-3FS07-0AB0","6AG1414-3EM07-7AB0","6AG1416-3ES07-7AB0","6ES7412-5HK06-0AB0","6ES7414-5HM06-0AB0","6ES7416-5HS06-0AB0","6ES7417-5HT06-0AB0"]},
    "cpe:/o:siemens:simatic_s7_300_firmware" :
        {"family" : "S7300", "versionEndExcluding" : "3.x.18", "orderNumbers" : ["6ES7315-2FJ14-0AB0","6ES7317-2EK14-0AB0","6ES7317-2FK14-0AB0","6ES7318-3EL01-0AB0","6ES7318-3FL01-0AB0","6AG1315-2FJ14-2AB0","6AG1317-2FK14-2AB0","6AG1315-2EH14-7AB0","6AG1317-2EK14-7AB0","6ES7314-6EH04-0AB0","6AG1314-6EH04-7AB0","6ES7315-7TJ10-0AB0"]},
    "cpe:/o:siemens:simatic_et_200_cpu_firmware" :
        {"family" : "S7300", "versionEndExcluding" : "3.x.18", "orderNumbers" : ["6ES7154-8AB01-0AB0","6ES7154-8FX00-0AB0","6ES7151-8AB01-0AB0","6AG1151-8AB01-7AB0"]},
    "cpe:/o:siemens:simatic_cp_443-1_advanced_firmware" :
        {"family" : "S7400", "versionEndExcluding" : "3.2.17", "orderNumbers" : ["6GK7443-1GX20-0XE0","6GK7443-1GX21-0XE0","6GK7443-1GX30-0XE0","6GK7443-1GX31-0XE0","6AG1443-1GX20-4XE0","6AG1443-1GX21-4XE0","6AG1443-1GX30-4XE0","6AG1443-1GX31-4XE0"]}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_WARNING);
