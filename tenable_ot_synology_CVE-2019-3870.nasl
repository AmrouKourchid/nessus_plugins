#%NASL_MIN_LEVEL 80900
##
# (C) Tenable, Inc.
##

include('compat.inc');

if (description)
{
  script_id(502476);
  script_version("1.2");
  script_set_attribute(attribute:"plugin_modification_date", value:"2024/10/02");

  script_cve_id("CVE-2019-3870");

  script_name(english:"Synology DiskStation Manager Samba Incorrect Default Permissions (CVE-2019-3870)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"A vulnerability was found in Samba from version (including) 4.9 to
versions before 4.9.6 and 4.10.2. During the creation of a new Samba
AD DC, files are created in a private subdirectory of the install
location. This directory is typically mode 0700, that is owner (root)
only access. However in some upgraded installations it will have other
permissions, such as 0755, because this was the default before Samba
4.8. Within this directory, files are created with mode 0666, which is
world-writable, including a sample krb5.conf, and the list of DNS
names and servicePrincipalName values to update.

This plugin only works with Tenable.ot.
Please visit https://www.tenable.com/products/tenable-ot for more information.");
  script_set_attribute(attribute:"see_also", value:"https://bugzilla.redhat.com/show_bug.cgi?id=CVE-2019-3870");
  script_set_attribute(attribute:"see_also", value:"https://bugzilla.samba.org/show_bug.cgi?id=13834");
  # https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/6354GALK73CZWQKFUG7AWB6EIEGFMF62/
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?3244b94f");
  # https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/JTJVFA3RZ6G2IZDTVKLHRMX6QBYA4GPA/
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?976baaea");
  script_set_attribute(attribute:"see_also", value:"https://support.f5.com/csp/article/K20804356");
  script_set_attribute(attribute:"see_also", value:"https://www.samba.org/samba/security/CVE-2019-3870.html");
  script_set_attribute(attribute:"see_also", value:"https://www.synology.com/security/advisory/Synology_SA_19_15");
  script_set_attribute(attribute:"solution", value:
"Refer to the vendor advisory.");
  script_set_cvss_base_vector("CVSS2#AV:L/AC:L/Au:N/C:N/I:P/A:P");
  script_set_cvss_temporal_vector("CVSS2#E:POC/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:H");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:P/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2019-3870");

  script_set_attribute(attribute:"exploitability_ease", value:"Exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"true");
  script_cwe_id(276);

  script_set_attribute(attribute:"vuln_publication_date", value:"2019/04/09");
  script_set_attribute(attribute:"patch_publication_date", value:"2019/04/09");
  script_set_attribute(attribute:"plugin_publication_date", value:"2024/10/01");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/a:synology:diskstation_manager");
  script_set_attribute(attribute:"generated_plugin", value:"former");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2024 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/Synology");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/Synology');

var asset = tenable_ot::assets::get(vendor:'Synology');

var vuln_cpes = {
    "cpe:/a:synology:diskstation_manager" :
        {"versionEndExcluding" : "6.2.3-25423", "versionStartIncluding" : "5.2", "family" : "DiskStation"}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_NOTE);
