#%NASL_MIN_LEVEL 70300
##
# (C) Tenable, Inc.
##

include('deprecated_nasl_level.inc');
include('compat.inc');

if (description)
{
  script_id(500232);
  script_version("1.11");
  script_set_attribute(attribute:"plugin_modification_date", value:"2024/10/08");

  script_cve_id("CVE-2018-4843");
  script_xref(name:"ICSA", value:"18-079-02");

  script_name(english:"Siemens SIMATIC, SINUMERIK, and PROFINET IO Improper Input Validation (CVE-2018-4843)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"A vulnerability has been identified in SIMATIC CP 343-1 (incl. SIPLUS
variants) (All versions), SIMATIC CP 343-1 Advanced (incl. SIPLUS
variants) (All versions), SIMATIC CP 443-1 (All versions < V3.3),
SIMATIC CP 443-1 (All versions < V3.3), SIMATIC CP 443-1 Advanced (All
versions < V3.3), SIMATIC ET 200pro IM154-8 PN/DP CPU (All versions <
V3.2.16), SIMATIC ET 200pro IM154-8F PN/DP CPU (All versions <
V3.2.16), SIMATIC ET 200pro IM154-8FX PN/DP CPU (All versions <
V3.2.16), SIMATIC ET 200S IM151-8 PN/DP CPU (All versions < V3.2.16),
SIMATIC ET 200S IM151-8F PN/DP CPU (All versions < V3.2.16), SIMATIC
S7-1500 CPU family (incl. related ET200 CPUs and SIPLUS variants) (All
versions < V1.7.0), SIMATIC S7-1500 Software Controller (All versions
< V1.7.0), SIMATIC S7-300 CPU 314C-2 PN/DP (All versions < V3.3.16),
SIMATIC S7-300 CPU 315-2 PN/DP (All versions < V3.2.16), SIMATIC
S7-300 CPU 315F-2 PN/DP (All versions < V3.2.16), SIMATIC S7-300 CPU
315T-3 PN/DP (All versions < V3.2.16), SIMATIC S7-300 CPU 317-2 PN/DP
(All versions < V3.2.16), SIMATIC S7-300 CPU 317F-2 PN/DP (All
versions < V3.2.16), SIMATIC S7-300 CPU 317T-3 PN/DP (All versions <
V3.2.16), SIMATIC S7-300 CPU 317TF-3 PN/DP (All versions < V3.2.16),
SIMATIC S7-300 CPU 319-3 PN/DP (All versions < V3.2.16), SIMATIC
S7-300 CPU 319F-3 PN/DP (All versions < V3.2.16), SIMATIC S7-400 H V6
CPU family (incl. SIPLUS variants) (All versions < V6.0.9), SIMATIC
S7-400 PN/DP V6 CPU family (incl. SIPLUS variants) (All versions <
V6.0.7), SIMATIC S7-400 PN/DP V7 CPU family (incl. SIPLUS variants)
(All versions), SIMATIC S7-410 CPU family (incl. SIPLUS variants) (All
versions < V8.1), SIMATIC WinAC RTX 2010 (All versions < V2010 SP3),
SIMATIC WinAC RTX F 2010 (All versions < V2010 SP3), SINUMERIK 828D
(All versions < V4.7 SP6 HF1), SIPLUS ET 200S IM151-8 PN/DP CPU (All
versions < V3.2.16), SIPLUS ET 200S IM151-8F PN/DP CPU (All versions <
V3.2.16), SIPLUS NET CP 443-1 (All versions < V3.3), SIPLUS NET CP
443-1 Advanced (All versions < V3.3), SIPLUS S7-300 CPU 314C-2 PN/DP
(All versions < V3.3.16), SIPLUS S7-300 CPU 315-2 PN/DP (All versions
< V3.2.16), SIPLUS S7-300 CPU 315F-2 PN/DP (All versions < V3.2.16),
SIPLUS S7-300 CPU 317-2 PN/DP (All versions < V3.2.16), SIPLUS S7-300
CPU 317F-2 PN/DP (All versions < V3.2.16), Softnet PROFINET IO for PC-
based Windows systems (All versions). Responding to a PROFINET DCP
request with a specially crafted PROFINET DCP packet could cause a
Denial-of-Service condition of the requesting system. The security
vulnerability could be exploited by an attacker located on the same
Ethernet segment (OSI Layer 2) as the targeted device. Successful
exploitation requires no user interaction or privileges and impacts
the availability of core functionality of the affected device. A
manual restart is required to recover the system. At the time of
advisory publication no public exploitation of this security
vulnerability is known. Siemens provides mitigations to resolve the
security issue. PROFIBUS interfaces are not affected.

This plugin only works with Tenable.ot.
Please visit https://www.tenable.com/products/tenable-ot for more information.");
  script_set_attribute(attribute:"see_also", value:"https://cert-portal.siemens.com/productcert/pdf/ssa-592007.pdf");
  script_set_attribute(attribute:"see_also", value:"https://www.cisa.gov/news-events/ics-advisories/icsa-18-079-02");
  script_set_attribute(attribute:"solution", value:
"The following text was originally created by the Cybersecurity and Infrastructure Security Agency (CISA). The original
can be found at CISA.gov.

Siemens has provided the following updates for mitigations:

- SIMATIC S7-1500 Software Controller incl. F: Update to v1.8.5 or newer, which can be found here:

https://support.industry.siemens.com/cs/ww/en/view/109478528

- SIMATIC S7-1500 incl. F: Update to v1.8.5 or newer, which can be found here:

https://support.industry.siemens.com/cs/ww/en/view/109478459

- SIMATIC S7-400 PN/DP v6 incl. F: Update to v6.0.7, which can be found here:

https://support.industry.siemens.com/cs/ww/en/view/109474874

- SIMATIC S7-410: Update to v8.1, which can be found here:

https://support.industry.siemens.com/cs/ww/en/view/109476571

- SINUMERIK 828D: Update to v4.7 SP6 HF1 SINUMERIK software can be obtained from the local Siemens account manager.
- SIMATIC S7-300 incl. F and T: Update to v3.X.16, which can be found here:

https://support.industry.siemens.com/cs/ww/en/ps/13752/dl

- SIMATIC S7-400 H V6: Update to v6.0.9, which can be found here:

https://support.industry.siemens.com/cs/ww/en/view/109474550

- SIMATIC WinAC RTX (F) 2010: Update to SP3 and apply BIOS and Microsoft Windows updates. SP3 software can be found
here:

https://support.industry.siemens.com/cs/ww/en/view/109765109

For all other affected products, Siemens has identified the following specific workarounds and mitigations that users
can apply to reduce the risk:

- Apply cell protection concept.
- Use VPN for protecting network communication between cells.
- Apply defense-in-depth.

As a general security measure, Siemens strongly recommends protecting network access to devices with appropriate
mechanisms. To run the devices in a protected IT environment, Siemens particularly recommends configuring the
environment according to Siemensâ€™ operational guidelines for industrial security, and following the recommendations in
the product manuals. Additional information on industrial security by Siemens can be found at:

https://www.siemens.com/industrialsecurity

For more information on this vulnerability and associated software updates, please see Siemens security notification
SSA-592007 on their website:

https://www.siemens.com/cert/advisories");
  script_set_cvss_base_vector("CVSS2#AV:A/AC:L/Au:N/C:N/I:N/A:C");
  script_set_cvss_temporal_vector("CVSS2#E:U/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:A/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:U/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2018-4843");

  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"false");
  script_cwe_id(20);

  script_set_attribute(attribute:"vuln_publication_date", value:"2018/03/20");
  script_set_attribute(attribute:"patch_publication_date", value:"2018/03/20");
  script_set_attribute(attribute:"plugin_publication_date", value:"2022/02/07");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:_simatic_s7-400_cpu_414-3_pn%2fdp_v7");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:_simatic_s7-400_cpu_414f-3_pn%2fdp_v7");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:_simatic_s7-400_cpu_416-3_pn%2fdp_v7");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:_simatic_s7-400_cpu_416f-3_pn%2fdp_v7");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_cp_343-1");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_cp_343-1_advanced");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_cp_443-1");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_cp_443-1_advanced");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_et_200pro_im154-8_pn%2fdp_cpu");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_et_200pro_im154-8f_pn%2fdp_cpu");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_et_200pro_im154-8fx_pn%2fdp_cpu");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_et_200s_im151-8_pn%2fdp_cpu");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_et_200s_im151-8f_pn%2fdp_cpu");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-1500_cpu_series");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-300_cpu_314c-2_pn%2fdp");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-300_cpu_315-2_pn%2fdp");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-300_cpu_315f-2_pn%2fdp");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-300_cpu_315t-3_pn%2fdp");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-300_cpu_317-2_pn%2fdp");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-300_cpu_317f-2_pn%2fdp");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-300_cpu_317t-3_pn%2fdp");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-300_cpu_317tf-3_pn%2fdp");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-300_cpu_319-3_pn%2fdp");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-300_cpu_319f-3_pn%2fdp");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-400_cpu_412-2_pn_v7");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-400_h_v6_cpu_series");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-400_pn%2fdp_v6_cpu_series");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siplus_et_200s_im151-8_pn%2fdp_cpu");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siplus_et_200s_im151-8f_pn%2fdp_cpu");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siplus_net_cp_443-1");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siplus_net_cp_443-1_advanced");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siplus_s7-300_cpu_314c-2_pn%2fdp");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siplus_s7-300_cpu_315-2_pn%2fdp");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siplus_s7-300_cpu_315f-2_pn%2fdp");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siplus_s7-300_cpu_317-2_pn%2fdp");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siplus_s7-300_cpu_317f-2_pn%2fdp");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siplus_s7-400_cpu_414-3_pn%2fdp_v7");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siplus_s7-400_cpu_416-3_pn%2fdp_v7");
  script_set_attribute(attribute:"generated_plugin", value:"former");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2022-2024 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/Siemens");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/Siemens');

var asset = tenable_ot::assets::get(vendor:'Siemens');

var vuln_cpes = {
    "cpe:/o:siemens:simatic_cp_343-1" :
        {"family" : "S7300"},
    "cpe:/o:siemens:simatic_cp_343-1_advanced" :
        {"family" : "S7300"},
    "cpe:/o:siemens:simatic_cp_443-1" :
        {"versionEndExcluding" : "3.3", "family" : "S7400", "orderNumbers" : ['6GK7443-1EX30-0XE1', '6GK7443-1EX30-0XE0']},
    "cpe:/o:siemens:simatic_cp_443-1_advanced" :
        {"versionEndExcluding" : "3.3", "family" : "S7400", "orderNumbers" : ['6GK7443-1GX30-0XE0']},
    "cpe:/o:siemens:siplus_net_cp_443-1" :
        {"versionEndExcluding" : "3.3", "family" : "S7400", "orderNumbers" : ['6AG1443-1EX30-4XE0']},
    "cpe:/o:siemens:siplus_net_cp_443-1_advanced" :
        {"versionEndExcluding" : "3.3", "family" : "S7400", "orderNumbers" : ['6AG1443-1GX30-4XE0']},
    "cpe:/o:siemens:_simatic_s7-400_cpu_414-3_pn%2fdp_v7" :
        {"versionEndExcluding" : "7.0.3", "family" : "S7400", "orderNumbers" : ['6ES7414-3EM07-0AB0']},
    "cpe:/o:siemens:_simatic_s7-400_cpu_414f-3_pn%2fdp_v7" :
        {"versionEndExcluding" : "7.0.3", "family" : "S7400", "orderNumbers" : ['6ES7414-3FM07-0AB0']},
    "cpe:/o:siemens:_simatic_s7-400_cpu_416-3_pn%2fdp_v7" :
        {"versionEndExcluding" : "7.0.3", "family" : "S7400", "orderNumbers" : ['6ES7416-3ES07-0AB0']},
    "cpe:/o:siemens:_simatic_s7-400_cpu_416f-3_pn%2fdp_v7" :
        {"versionEndExcluding" : "7.0.3", "family" : "S7400", "orderNumbers" : ['6ES7416-3FS07-0AB0']},
    "cpe:/o:siemens:simatic_s7-400_cpu_412-2_pn_v7" :
        {"versionEndExcluding" : "7.0.3", "family" : "S7400", "orderNumbers" : ['6ES7412-2EK07-0AB0']},
    "cpe:/o:siemens:siplus_s7-400_cpu_414-3_pn%2fdp_v7" :
        {"versionEndExcluding" : "7.0.3", "family" : "S7400", "orderNumbers" : ['6AG1414-3EM07-7AB0']},
    "cpe:/o:siemens:siplus_s7-400_cpu_416-3_pn%2fdp_v7" :
        {"versionEndExcluding" : "7.0.3", "family" : "S7400", "orderNumbers" : ['6AG1416-3ES07-7AB0']},
    "cpe:/o:siemens:simatic_s7-400_pn%2fdp_v6_cpu_series" :
        {"versionEndExcluding" : "6.0.7", "family" : "S7400"},
    "cpe:/o:siemens:simatic_s7-400_h_v6_cpu_series" :
        {"versionEndExcluding" : "6.0.9", "family" : "S7400"},
    "cpe:/o:siemens:simatic_s7-1500_cpu_series" :
        {"versionEndExcluding" : "1.7.0", "family" : "S71500"},
    "cpe:/o:siemens:simatic_et_200pro_im154-8_pn%2fdp_cpu" :
        {"versionEndExcluding" : "3.2.16", "family" : "ET200", "orderNumbers" : ['6ES7154-8AB01-0AB0']},
    "cpe:/o:siemens:simatic_et_200pro_im154-8f_pn%2fdp_cpu" :
        {"versionEndExcluding" : "3.2.16", "family" : "ET200", "orderNumbers" : ['6ES7154-8FB01-0AB0']},
    "cpe:/o:siemens:simatic_et_200pro_im154-8fx_pn%2fdp_cpu" :
        {"versionEndExcluding" : "3.2.16", "family" : "ET200", "orderNumbers" : ['6ES7154-8FX00-0AB0']},
    "cpe:/o:siemens:simatic_et_200s_im151-8_pn%2fdp_cpu" :
        {"versionEndExcluding" : "3.2.16", "family" : "ET200", "orderNumbers" : ['6ES7151-8AB01-0AB0']},
    "cpe:/o:siemens:siplus_et_200s_im151-8_pn%2fdp_cpu" :
        {"versionEndExcluding" : "3.2.16", "family" : "ET200", "orderNumbers" : ['6AG1151-8AB01-7AB0']},
    "cpe:/o:siemens:simatic_et_200s_im151-8f_pn%2fdp_cpu" :
        {"versionEndExcluding" : "3.2.16", "family" : "ET200", "orderNumbers" : ['6ES7151-8FB01-0AB0']},
    "cpe:/o:siemens:siplus_et_200s_im151-8f_pn%2fdp_cpu" :
        {"versionEndExcluding" : "3.2.16", "family" : "ET200", "orderNumbers" : ['6AG1151-8FB01-2AB0']},
    "cpe:/o:siemens:simatic_s7-300_cpu_314c-2_pn%2fdp" :
        {"versionEndExcluding" : "3.3.16", "family" : "S7300", "orderNumbers" : ['6ES7314-6EH04-0AB0']},
    "cpe:/o:siemens:siplus_s7-300_cpu_314c-2_pn%2fdp" :
        {"versionEndExcluding" : "3.3.16", "family" : "S7300", "orderNumbers" : ['6AG1314-6EH04-7AB0']},
    "cpe:/o:siemens:simatic_s7-300_cpu_315-2_pn%2fdp" :
        {"versionEndExcluding" : "3.2.16", "family" : "S7300", "orderNumbers" : ['6ES7315-2EH14-0AB0']},
    "cpe:/o:siemens:siplus_s7-300_cpu_315-2_pn%2fdp" :
        {"versionEndExcluding" : "3.2.16", "family" : "S7300", "orderNumbers" : ['6AG1315-2EH14-7AB0']},
    "cpe:/o:siemens:simatic_s7-300_cpu_315f-2_pn%2fdp" :
        {"versionEndExcluding" : "3.2.16", "family" : "S7300", "orderNumbers" : ['6ES7315-2FJ14-0AB0']},
    "cpe:/o:siemens:siplus_s7-300_cpu_315f-2_pn%2fdp" :
        {"versionEndExcluding" : "3.2.16", "family" : "S7300", "orderNumbers" : ['6AG1315-2FJ14-2AB0']},
    "cpe:/o:siemens:simatic_s7-300_cpu_315t-3_pn%2fdp" :
        {"versionEndExcluding" : "3.2.16", "family" : "S7300", "orderNumbers" : ['6ES7315-7TJ10-0AB0']},
    "cpe:/o:siemens:simatic_s7-300_cpu_317-2_pn%2fdp" :
        {"versionEndExcluding" : "3.2.16", "family" : "S7300", "orderNumbers" : ['6ES7317-2EK14-0AB0']},
    "cpe:/o:siemens:siplus_s7-300_cpu_317-2_pn%2fdp" :
        {"versionEndExcluding" : "3.2.16", "family" : "S7300", "orderNumbers" : ['6AG1317-2EK14-7AB0']},
    "cpe:/o:siemens:simatic_s7-300_cpu_317f-2_pn%2fdp" :
        {"versionEndExcluding" : "3.2.16", "family" : "S7300", "orderNumbers" : ['6ES7317-2FK14-0AB0']},
    "cpe:/o:siemens:siplus_s7-300_cpu_317f-2_pn%2fdp" :
        {"versionEndExcluding" : "3.2.16", "family" : "S7300", "orderNumbers" : ['6AG1317-2FK14-2AB0']},
    "cpe:/o:siemens:simatic_s7-300_cpu_317t-3_pn%2fdp" :
        {"versionEndExcluding" : "3.2.16", "family" : "S7300", "orderNumbers" : ['6ES7317-7TK10-0AB0']},
    "cpe:/o:siemens:simatic_s7-300_cpu_317tf-3_pn%2fdp" :
        {"versionEndExcluding" : "3.2.16", "family" : "S7300", "orderNumbers" : ['6ES7317-7UL10-0AB0']},
    "cpe:/o:siemens:simatic_s7-300_cpu_319-3_pn%2fdp" :
        {"versionEndExcluding" : "3.2.16", "family" : "S7300", "orderNumbers" : ['6ES7318-3EL01-0AB0']},
    "cpe:/o:siemens:simatic_s7-300_cpu_319f-3_pn%2fdp" :
        {"versionEndExcluding" : "3.2.16", "family" : "S7300", "orderNumbers" : ['6ES7318-3FL01-0AB0']}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_WARNING);
