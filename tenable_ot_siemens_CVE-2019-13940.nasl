#%NASL_MIN_LEVEL 70300
##
# (C) Tenable, Inc.
##

include('deprecated_nasl_level.inc');
include('compat.inc');

if (description)
{
  script_id(500351);
  script_version("1.9");
  script_set_attribute(attribute:"plugin_modification_date", value:"2024/09/27");

  script_cve_id("CVE-2019-13940");
  script_xref(name:"ICSA", value:"20-042-05");

  script_name(english:"Siemens SIMATIC S7 Uncontrolled Resource Consumption (CVE-2019-13940)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"A vulnerability has been identified in SIMATIC ET 200pro IM154-8 PN/DP
CPU (All versions < V3.X.17), SIMATIC ET 200pro IM154-8F PN/DP CPU
(All versions < V3.X.17), SIMATIC ET 200pro IM154-8FX PN/DP CPU (All
versions < V3.X.17), SIMATIC ET 200S IM151-8 PN/DP CPU (All versions <
V3.X.17), SIMATIC ET 200S IM151-8F PN/DP CPU (All versions < V3.X.17),
SIMATIC S7-1200 CPU family (incl. SIPLUS variants) (All versions <
V4.1), SIMATIC S7-300 CPU 314C-2 PN/DP (All versions < V3.X.17),
SIMATIC S7-300 CPU 315-2 PN/DP (All versions < V3.X.17), SIMATIC
S7-300 CPU 315F-2 PN/DP (All versions < V3.X.17), SIMATIC S7-300 CPU
315T-3 PN/DP (All versions < V3.X.17), SIMATIC S7-300 CPU 317-2 PN/DP
(All versions < V3.X.17), SIMATIC S7-300 CPU 317F-2 PN/DP (All
versions < V3.X.17), SIMATIC S7-300 CPU 317T-3 PN/DP (All versions <
V3.X.17), SIMATIC S7-300 CPU 317TF-3 PN/DP (All versions < V3.X.17),
SIMATIC S7-300 CPU 319-3 PN/DP (All versions < V3.X.17), SIMATIC
S7-300 CPU 319F-3 PN/DP (All versions < V3.X.17), SIMATIC S7-400 PN/DP
V6 and below CPU family (incl. SIPLUS variants) (All versions),
SIMATIC S7-400 PN/DP V7 CPU family (incl. SIPLUS variants) (All
versions), SIMATIC WinAC RTX 2010 (All versions), SIMATIC WinAC RTX F
2010 (All versions), SIPLUS ET 200S IM151-8 PN/DP CPU (All versions <
V3.X.17), SIPLUS ET 200S IM151-8F PN/DP CPU (All versions < V3.X.17),
SIPLUS S7-300 CPU 314C-2 PN/DP (All versions < V3.X.17), SIPLUS S7-300
CPU 315-2 PN/DP (All versions < V3.X.17), SIPLUS S7-300 CPU 315F-2
PN/DP (All versions < V3.X.17), SIPLUS S7-300 CPU 317-2 PN/DP (All
versions < V3.X.17), SIPLUS S7-300 CPU 317F-2 PN/DP (All versions <
V3.X.17). Affected devices contain a vulnerability that could cause a
denial of service condition of the web server by sending specially
crafted HTTP requests to ports 80/tcp and 443/tcp. Beyond the web
service, no other functions or interfaces are affected by the denial
of service condition.

This plugin only works with Tenable.ot.
Please visit https://www.tenable.com/products/tenable-ot for more information.");
  script_set_attribute(attribute:"see_also", value:"https://cert-portal.siemens.com/productcert/pdf/ssa-431678.pdf");
  script_set_attribute(attribute:"see_also", value:"https://www.cisa.gov/news-events/ics-advisories/icsa-20-042-05");
  script_set_attribute(attribute:"solution", value:
"The following text was originally created by the Cybersecurity and Infrastructure Security Agency (CISA). The original
can be found at CISA.gov.

Siemens has identified the following specific workarounds and mitigations users can apply to reduce the risk:

- Restrict access to the device to the internal or VPN network. Further, if possible, restrict access to the web server
(80/TCP, 443/TCP) to trusted IP addresses.
- If possible, disable the integrated web server. The web server is disabled in the default settings and its use is
optional.
- For SIMATIC S7-1200 CPU family (including SIPLUS variants) Siemens recommends affected users update to v4.1 or any
later version.
- For SIMATIC S7-300 PN/DP CPU family (including related ET200 CPUs and SIPLUS variants), Siemens recommends affected
users update to v3.X.17 or later version.

For more information on this vulnerability and associated software updates, please see Siemens security advisory
SSA-431678");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:L/Au:N/C:N/I:N/A:P");
  script_set_cvss_temporal_vector("CVSS2#E:U/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:U/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2019-13940");

  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"false");
  script_cwe_id(400);

  script_set_attribute(attribute:"vuln_publication_date", value:"2020/02/11");
  script_set_attribute(attribute:"patch_publication_date", value:"2020/02/11");
  script_set_attribute(attribute:"plugin_publication_date", value:"2022/02/07");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_et200pro_im154-8_pn%2fdp_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_et200pro_im154-8f_pn%2fdp_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_et200pro_im154-8fx_pn%2fdp_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_et200s_im151-8_pn%2fdp_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siplus_et200s_im151-8_pn%2fdp_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_et200s_im151-8f_pn%2fdp_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siplus_et200s_im151-8f_pn%2fdp_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:s7-1200_cpu_1211c_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:s7-1200_cpu_1212c_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:s7-1200_cpu_1212fc_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:s7-1200_cpu_1214c_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:s7-1200_cpu_1214fc_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:s7-1200_cpu_1215c_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:s7-1200_cpu_1215fc_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:s7-1200_cpu_1217c_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-300_cpu_314c-2_pn%2fdp_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siplus_s7-300_cpu_314c-2_pn%2fdp_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-300_cpu_315-2_pn%2fdp_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siplus_s7-300_cpu_315-2_pn%2fdp_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-300_cpu_315f-2_pn%2fdp_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siplus_s7-300_cpu_315f-2_pn%2fdp_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-300_cpu_315t-3_pn%2fdp_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-300_cpu_317-2_pn%2fdp_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siplus_s7-300_cpu_317-2_pn%2fdp_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-300_cpu_317f-2_pn%2fdp_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siplus_s7-300_cpu_317f-2_pn%2fdp_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-300_cpu_317t-3_pn%2fdp_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-300_cpu_317tf-3_pn%2fdp_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-300_cpu_319-3_pn%2fdp_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-300_cpu_319f-3_pn%2fdp_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-400_pn%2fdp_cpu_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siplus_cpu_1211c_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siplus_cpu_1212c_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siplus_cpu_1214c_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siplus_cpu_1215c_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siplus_s7-1200_firmware");
  script_set_attribute(attribute:"generated_plugin", value:"former");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2022-2024 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/Siemens");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/Siemens');

var asset = tenable_ot::assets::get(vendor:'Siemens');

var vuln_cpes = {
    "cpe:/o:siemens:s7-1200_cpu_1211c_firmware" :
        {"versionEndExcluding" : "4.1", "family" : "S71200"},
    "cpe:/o:siemens:s7-1200_cpu_1212c_firmware" :
        {"versionEndExcluding" : "4.1", "family" : "S71200"},
    "cpe:/o:siemens:s7-1200_cpu_1214c_firmware" :
        {"versionEndExcluding" : "4.1", "family" : "S71200"},
    "cpe:/o:siemens:s7-1200_cpu_1215c_firmware" :
        {"versionEndExcluding" : "4.1", "family" : "S71200"},
    "cpe:/o:siemens:s7-1200_cpu_1217c_firmware" :
        {"versionEndExcluding" : "4.1", "family" : "S71200"},
    "cpe:/o:siemens:s7-1200_cpu_1212fc_firmware" :
        {"versionEndExcluding" : "4.1", "family" : "S71200"},
    "cpe:/o:siemens:s7-1200_cpu_1214fc_firmware" :
        {"versionEndExcluding" : "4.1", "family" : "S71200"},
    "cpe:/o:siemens:s7-1200_cpu_1215fc_firmware" :
        {"versionEndExcluding" : "4.1", "family" : "S71200"},
    "cpe:/o:siemens:siplus_s7-1200_firmware" :
        {"versionEndExcluding" : "4.1", "family" : "S71200"},
    "cpe:/o:siemens:siplus_cpu_1211c_firmware" :
        {"versionEndExcluding" : "4.1", "family" : "S71200"},
    "cpe:/o:siemens:siplus_cpu_1212c_firmware" :
        {"versionEndExcluding" : "4.1", "family" : "S71200"},
    "cpe:/o:siemens:siplus_cpu_1214c_firmware" :
        {"versionEndIncluding" : "4.1", "family" : "S71200"},
    "cpe:/o:siemens:siplus_cpu_1215c_firmware" :
        {"versionEndExcluding" : "4.1", "family" : "S71200"},
    "cpe:/o:siemens:simatic_et200pro_im154-8_pn%2fdp_firmware" :
        {"versionEndExcluding": "3.x.17", "family": "ET200", "orderNumbers": ["6ES7154-8AB01-0AB0"]},
    "cpe:/o:siemens:simatic_et200pro_im154-8f_pn%2fdp_firmware" :
        {"versionEndExcluding": "3.x.17", "family": "ET200", "orderNumbers": ["6ES7154-8FB01-0AB0)"]},
    "cpe:/o:siemens:simatic_et200pro_im154-8fx_pn%2fdp_firmware" :
        {"versionEndExcluding": "3.x.17", "family": "ET200", "orderNumbers": ["6ES7154-8FX00-0AB0"]},
    "cpe:/o:siemens:simatic_et200s_im151-8_pn%2fdp_firmware" :
        {"versionEndExcluding": "3.x.17", "family": "ET200", "orderNumbers": ["6ES7151-8AB01-0AB0"]},
    "cpe:/o:siemens:siplus_et200s_im151-8_pn%2fdp_firmware" :
        {"versionEndExcluding": "3.x.17", "family": "ET200", "orderNumbers": ["6AG1151-8AB01-7AB0"]},
    "cpe:/o:siemens:simatic_et200s_im151-8f_pn%2fdp_firmware" :
        {"versionEndExcluding": "3.x.17", "family": "ET200", "orderNumbers": ["6ES7151-8FB01-0AB0"]},
    "cpe:/o:siemens:siplus_et200s_im151-8f_pn%2fdp_firmware" :
        {"versionEndExcluding": "3.x.17", "family": "ET200", "orderNumbers": ["6AG1151-8FB01-2AB0"]},
    "cpe:/o:siemens:simatic_s7-300_cpu_314c-2_pn%2fdp_firmware" :
        {"versionEndExcluding": "3.x.17", "family": "S7300", "orderNumbers": ["6ES7314-6EH04-0AB0"]},
    "cpe:/o:siemens:siplus_s7-300_cpu_314c-2_pn%2fdp_firmware" :
        {"versionEndExcluding": "3.x.17", "family": "S7300", "orderNumbers": ["6AG1314-6EH04-7AB0)"]},
    "cpe:/o:siemens:simatic_s7-300_cpu_315-2_pn%2fdp_firmware" :
        {"versionEndExcluding": "3.x.17", "family": "S7300", "orderNumbers": ["6ES7315-2EH14-0AB0"]},
    "cpe:/o:siemens:siplus_s7-300_cpu_315-2_pn%2fdp_firmware" :
        {"versionEndExcluding": "3.x.17", "family": "S7300", "orderNumbers": ["6AG1315-2EH14-7AB0"]},
    "cpe:/o:siemens:simatic_s7-300_cpu_315f-2_pn%2fdp_firmware" :
        {"versionEndExcluding": "3.x.17", "family": "S7300", "orderNumbers": ["6ES7315-2FJ14-0AB0"]},
    "cpe:/o:siemens:siplus_s7-300_cpu_315f-2_pn%2fdp_firmware" :
        {"versionEndExcluding": "3.x.17", "family": "S7300", "orderNumbers": ["6AG1315-2FJ14-2AB0"]},
    "cpe:/o:siemens:simatic_s7-300_cpu_315t-3_pn%2fdp_firmware" :
        {"versionEndExcluding": "3.x.17", "family": "S7300", "orderNumbers": ["6ES7315-7TJ10-0AB0"]},
    "cpe:/o:siemens:simatic_s7-300_cpu_317-2_pn%2fdp_firmware" :
        {"versionEndExcluding": "3.x.17", "family": "S7300", "orderNumbers": ["6ES7317-2EK14-0AB0"]},
    "cpe:/o:siemens:siplus_s7-300_cpu_317-2_pn%2fdp_firmware" :
        {"versionEndExcluding": "3.x.17", "family": "S7300", "orderNumbers": ["6AG1317-2EK14-7AB0"]},
    "cpe:/o:siemens:simatic_s7-300_cpu_317f-2_pn%2fdp_firmware" :
        {"versionEndExcluding": "3.x.17", "family": "S7300", "orderNumbers": ["6ES7317-2FK14-0AB0"]},
    "cpe:/o:siemens:siplus_s7-300_cpu_317f-2_pn%2fdp_firmware" :
        {"versionEndExcluding": "3.x.17", "family": "S7300", "orderNumbers": ["6AG1317-2FK14-2AB0"]},
    "cpe:/o:siemens:simatic_s7-300_cpu_317t-3_pn%2fdp_firmware" :
        {"versionEndExcluding": "3.x.17", "family": "S7300", "orderNumbers": ["6ES7317-7TK10-0AB0"]},
    "cpe:/o:siemens:simatic_s7-300_cpu_317tf-3_pn%2fdp_firmware" :
        {"versionEndExcluding": "3.x.17", "family": "S7300", "orderNumbers": ["6ES7317-7UL10-0AB0"]},
    "cpe:/o:siemens:simatic_s7-300_cpu_319-3_pn%2fdp_firmware" :
        {"versionEndExcluding": "3.x.17", "family": "S7300", "orderNumbers": ["6ES7318-3EL01-0AB0"]},
    "cpe:/o:siemens:simatic_s7-300_cpu_319f-3_pn%2fdp_firmware" :
        {"versionEndExcluding": "3.x.17", "family": "S7300", "orderNumbers": ["6ES7318-3FL01-0AB0"]},
    "cpe:/o:siemens:simatic_s7-400_pn%2fdp_cpu_firmware" :
        {"family" : "S7400"}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_WARNING);
