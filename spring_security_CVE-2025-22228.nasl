#%NASL_MIN_LEVEL 80900
##
# (C) Tenable, Inc.
##

include('compat.inc');

if (description)
{
  script_id(233464);
  script_version("1.1");
  script_set_attribute(attribute:"plugin_modification_date", value:"2025/03/28");

  script_cve_id("CVE-2025-22228");
  script_xref(name:"IAVA", value:"2025-A-0197");

  script_name(english:"Spring Security 5.7 < 5.7.16 / 5.8 < 5.8.18 / 6.0 < 6.0.16 / 6.1 < 6.1.14 / 6.2 < 6.2.10 / 6.3 < 6.3.8 / 6.4 < 6.4.4 Authentication Bypass (CVE-2025-22228)");

  script_set_attribute(attribute:"synopsis", value:
"The remote host contains a web application framework that is affected by an authentication bypass vulnerability.");
  script_set_attribute(attribute:"description", value:
"The remote host contains a Spring Security version that is 5.7 prior to 5.7.16, 5.8 prior to 5.8.18, 6.0 prior to
6.0.16, 6.1 prior to 6.1.14, 6.2 prior to 6.2.10, or 6.3 prior to 6.3.8, 6.4 prior to 6.4.4. It may, therefore, be 
affected by an authentication bypass vulnerability. BCryptPasswordEncoder.matches(CharSequence,String) will incorrectly return true for 
passwords larger than 72 characters as long as the first 72 characters are the same.

Note that Nessus has not tested for this issue but has instead relied only on the application's self-reported version
number.");
  script_set_attribute(attribute:"see_also", value:"https://spring.io/security/cve-2025-22228");
  script_set_attribute(attribute:"solution", value:
"Upgrade to Spring Security version 5.7.16, 5.8.18, 6.0.16, 6.1.12, 6.2.10, or 6.3.8 or later.");
  script_set_attribute(attribute:"agent", value:"all");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:H/Au:N/C:C/I:C/A:N");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:N");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2025-22228");

  script_set_attribute(attribute:"vuln_publication_date", value:"2025/03/19");
  script_set_attribute(attribute:"patch_publication_date", value:"2025/03/19");
  script_set_attribute(attribute:"plugin_publication_date", value:"2025/03/28");

  script_set_attribute(attribute:"plugin_type", value:"local");
  script_set_attribute(attribute:"asset_categories", value:"component");
  script_set_attribute(attribute:"cpe", value:"cpe:/a:pivotal_software:spring_security");
  script_set_attribute(attribute:"thorough_tests", value:"true");
  script_set_attribute(attribute:"stig_severity", value:"I");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Misc.");

  script_copyright(english:"This script is Copyright (C) 2025 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("pivotal_software_spring_security_installed.nbin");
  script_require_keys("installed_sw/Spring Security");

  exit(0);
}


include('vdf.inc');

# @tvdl-content
var vuln_data = {
  'metadata': {'spec_version': '1.0'},
  'checks': [
    {
      'product':{'name': 'Spring Security', 'type': 'app'},
      'check_algorithm': 'default',
      'constraints': [
        { 'min_version':'5.7', 'fixed_version':'5.7.16' },
        { 'min_version':'5.8', 'fixed_version':'5.8.18' },
        { 'min_version':'6.0', 'fixed_version':'6.0.16' },
        { 'min_version':'6.1', 'fixed_version':'6.1.14' },
        { 'min_version':'6.2', 'fixed_version':'6.2.10' },
        { 'min_version':'6.3', 'fixed_version':'6.3.8' },
        { 'min_version':'6.4', 'fixed_version':'6.4.4' }
      ]
    }
  ]
};

var result = vdf::check_and_report(vuln_data:vuln_data, severity:SECURITY_HOLE);
vdf::handle_check_and_report_errors(vdf_result:result);
