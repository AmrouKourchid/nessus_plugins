#%NASL_MIN_LEVEL 70300
##
# (C) Tenable Network Security, Inc.
##

include('deprecated_nasl_level.inc');
include('compat.inc');

if (description)
{
  script_id(500341);
  script_version("1.7");
  script_set_attribute(attribute:"plugin_modification_date", value:"2024/12/04");

  script_cve_id("CVE-2018-7502");
  script_xref(name:"ICSA", value:"18-081-02");

  script_name(english:"Beckhoff TwinCAT Untrusted Pointer Dereference (CVE-2018-7502)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"Kernel drivers in Beckhoff TwinCAT 3.1 Build 4022.4, TwinCAT 2.11 R3 2259, and TwinCAT 3.1 lack proper validation of
user-supplied pointer values. An attacker who is able to execute code on the target may be able to exploit this
vulnerability to obtain SYSTEM privileges. 

This plugin only works with Tenable.ot. Please visit
https://www.tenable.com/products/tenable-ot for more information.");
  # https://download.beckhoff.com/download/Document/product-security/Advisories/advisory-2018-001.pdf
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?229fcc10");
  script_set_attribute(attribute:"see_also", value:"http://www.securityfocus.com/bid/103487");
  script_set_attribute(attribute:"see_also", value:"https://ics-cert.us-cert.gov/advisories/ICSA-18-081-02");
  script_set_attribute(attribute:"see_also", value:"https://srcincite.io/advisories/src-2018-0007/");
  script_set_attribute(attribute:"solution", value:
"The following text was originally created by the Cybersecurity and Infrastructure Security Agency (CISA). The original
can be found at CISA.gov.

Beckhoff recommends users update to the newest version and recompile Matlab modules after updating.

Please see Beckhoff Security Advisory 2018-001 at the following location for more information:

https://download.beckhoff.com/download/Document/product-security/Advisories/advisory-2018-001.pdf");
  script_set_cvss_base_vector("CVSS2#AV:L/AC:L/Au:N/C:C/I:C/A:C");
  script_set_cvss_temporal_vector("CVSS2#E:F/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:F/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2018-7502");

  script_set_attribute(attribute:"exploitability_ease", value:"Exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"true");
  script_set_attribute(attribute:"exploit_framework_core", value:"true");
  script_cwe_id(20);

  script_set_attribute(attribute:"vuln_publication_date", value:"2018/03/23");
  script_set_attribute(attribute:"patch_publication_date", value:"2018/03/23");
  script_set_attribute(attribute:"plugin_publication_date", value:"2022/02/07");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/a:beckhoff:twincat:3.1.4022");
  script_set_attribute(attribute:"cpe", value:"cpe:/a:beckhoff:twincat:2.11");
  script_set_attribute(attribute:"cpe", value:"cpe:/a:beckhoff:twincat_c%2b%2b:3.1");
  script_set_attribute(attribute:"generated_plugin", value:"former");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2022-2024 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/Beckhoff");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/Beckhoff');

var asset = tenable_ot::assets::get(vendor:'Beckhoff');

var vuln_cpes = {
    "cpe:/a:beckhoff:twincat:3.1.4022" :
        {"versionEndIncluding" : "3.1.4022.4", "versionStartIncluding" : "3.1.4022"},
    "cpe:/a:beckhoff:twincat:2.11" :
        {"versionEndIncluding" : "2.11.2300", "versionStartIncluding" : "2.11"},
    "cpe:/a:beckhoff:twincat_c%2b%2b:3.1" :
        {"versionEndIncluding" : "3.1", "versionStartIncluding" : "3.1"}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_HOLE);
