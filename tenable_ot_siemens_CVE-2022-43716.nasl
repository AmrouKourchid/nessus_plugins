#%NASL_MIN_LEVEL 80900
##
# (C) Tenable, Inc.
##

include('compat.inc');

if (description)
{
  script_id(501107);
  script_version("1.6");
  script_set_attribute(attribute:"plugin_modification_date", value:"2025/03/10");

  script_cve_id("CVE-2022-43716");
  script_xref(name:"ICSA", value:"23-103-10");

  script_name(english:"Siemens Industrial Products Use After Free (CVE-2022-43716)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"A vulnerability has been identified in SIMATIC CP 1242-7 V2 (All
versions), SIMATIC CP 1243-1 (All versions), SIMATIC CP 1243-1 DNP3
(incl. SIPLUS variants) (All versions), SIMATIC CP 1243-1 IEC (incl.
SIPLUS variants) (All versions), SIMATIC CP 1243-7 LTE EU (All
versions), SIMATIC CP 1243-7 LTE US (All versions), SIMATIC CP 1243-8
IRC (All versions), SIMATIC CP 1542SP-1 (All versions), SIMATIC CP
1542SP-1 IRC (All versions), SIMATIC CP 1543SP-1 (All versions),
SIMATIC CP 443-1 (All versions < V3.3), SIMATIC CP 443-1 (All versions
< V3.3), SIMATIC CP 443-1 Advanced (All versions < V3.3), SIMATIC IPC
DiagBase (All versions), SIMATIC IPC DiagMonitor (All versions),
SIPLUS ET 200SP CP 1542SP-1 IRC TX RAIL (All versions), SIPLUS ET
200SP CP 1543SP-1 ISEC (All versions), SIPLUS ET 200SP CP 1543SP-1
ISEC TX RAIL (All versions), SIPLUS NET CP 1242-7 V2 (All versions),
SIPLUS NET CP 443-1 (All versions < V3.3), SIPLUS NET CP 443-1
Advanced (All versions < V3.3), SIPLUS S7-1200 CP 1243-1 (All
versions), SIPLUS S7-1200 CP 1243-1 RAIL (All versions), SIPLUS TIM
1531 IRC (All versions < V2.3.6), TIM 1531 IRC (All versions <
V2.3.6). The webserver of the affected products contains a
vulnerability that may lead to a denial of service condition. An
attacker may cause a denial of service situation which leads to a
restart of the webserver of the affected product.

This plugin only works with Tenable.ot.
Please visit https://www.tenable.com/products/tenable-ot for more information.");
  script_set_attribute(attribute:"see_also", value:"https://cert-portal.siemens.com/productcert/pdf/ssa-566905.pdf");
  script_set_attribute(attribute:"see_also", value:"https://www.cisa.gov/news-events/ics-advisories/icsa-23-103-10");
  script_set_attribute(attribute:"solution", value:
"The following text was originally created by the Cybersecurity and Infrastructure Security Agency (CISA). The original
can be found at CISA.gov.

Siemens has released updates for several affected products and recommends updating to the latest versions. Siemens is
preparing further updates and recommends specific countermeasures for products where updates are not, or not yet,
available:

- SIMATIC CP 443-1 (6GK7443-1EX30-0XE0): Update to V3.3 or later version 
- SIMATIC CP 443-1 (6GK7443-1EX30-0XE1): Update to V3.3 or later version 
- SIMATIC CP 443-1 Advanced (6GK7443-1GX30-0XE0): Update to V3.3 or later version 
- SIPLUS TIM 1531 IRC (6AG1543-1MX00-7XE0): Update to V2.3.6 or later version 
- TIM 1531 IRC (6GK7543-1MX00-0XE0): Update to V2.3.6 or later version

Siemens has identified the following specific workarounds and mitigations users can apply to reduce risk: 

- Restrict access to the web interface of the affected products—if deactivation unsupported by the product. 
- Deactivate the webserver if not required and if deactivation is supported by the product.

As a general security measure, Siemens strongly recommends protecting network access to devices with appropriate
mechanisms. To operate the devices in a protected IT environment, Siemens recommends configuring the environment
according to Siemens' Operational Guidelines for Industrial Security and to follow the recommendations in the product
manuals. Additional information on Industrial Security by Siemens can be found on the Siemens webpage for Industrial
Security.

For further inquiries on security vulnerabilities in Siemens’ products and solutions, users should contact the Siemens
ProductCERT.

For more information, see the associated Siemens security advisory SSA-566905 in HTML and CSAF.");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:L/Au:N/C:N/I:N/A:C");
  script_set_cvss_temporal_vector("CVSS2#E:U/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:U/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2022-43716");

  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");
  script_cwe_id(416);

  script_set_attribute(attribute:"vuln_publication_date", value:"2023/04/11");
  script_set_attribute(attribute:"patch_publication_date", value:"2023/04/11");
  script_set_attribute(attribute:"plugin_publication_date", value:"2023/05/02");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_cp_1242-7_v2_firmware:3.4.29");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_cp_1243-1_dnp3_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_cp_1243-1_firmware:3.4.29");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_cp_1243-1_iec_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_cp_1243-7_lte_eu_firmware:3.4.29");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_cp_1243-7_lte_us_firmware:3.4.29");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_cp_1243-8_irc_firmware:3.4.29");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_cp_1542sp-1_firmware:2.3");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_cp_1542sp-1_irc_firmware:2.3");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_cp_1543sp-1_firmware:2.3");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_cp_443-1_advanced_firmware:3.3");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_cp_443-1_firmware:3.3");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siplus_et_200sp_cp_1542sp-1_irc_tx_rail_firmware:2.3");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siplus_et_200sp_cp_1543sp-1_isec_firmware:2.3");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siplus_et_200sp_cp_1543sp-1_isec_tx_rail_firmware:2.3");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siplus_net_cp_1242-7_v2_firmware:3.4.29");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siplus_net_cp_443-1_advanced_firmware:3.3");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siplus_net_cp_443-1_firmware:3.3");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siplus_s7-1200_cp_1243-1_firmware:3.4.29");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siplus_s7-1200_cp_1243-1_rail_firmware:3.4.29");
  script_set_attribute(attribute:"generated_plugin", value:"former");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2023-2025 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/Siemens");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/Siemens');

var asset = tenable_ot::assets::get(vendor:'Siemens');

var vuln_cpes = {
    "cpe:/o:siemens:simatic_cp_1542sp-1_firmware:2.3" :
        {"versionEndExcluding" : "2.3", "family" : "S71500", "orderNumbers" : ['6GK7542-6UX00-0XE0']},
    "cpe:/o:siemens:simatic_cp_1542sp-1_irc_firmware:2.3" :
        {"versionEndExcluding" : "2.3", "family" : "S71500", "orderNumbers" : ['6GK7542-6VX00-0XE0']},
    "cpe:/o:siemens:simatic_cp_1543sp-1_firmware:2.3" :
        {"versionEndExcluding" : "2.3", "family" : "S71500", "orderNumbers" : ['6GK7543-6WX00-0XE0']},
    "cpe:/o:siemens:siplus_et_200sp_cp_1542sp-1_irc_tx_rail_firmware:2.3" :
        {"versionEndExcluding" : "2.3", "family" : "ET200", "orderNumbers" : ['6AG2542-6VX00-4XE0']},
    "cpe:/o:siemens:siplus_et_200sp_cp_1543sp-1_isec_firmware:2.3" :
        {"versionEndExcluding" : "2.3", "family" : "ET200", "orderNumbers" : ['6AG1543-6WX00-7XE0']},
    "cpe:/o:siemens:siplus_et_200sp_cp_1543sp-1_isec_tx_rail_firmware:2.3" :
        {"versionEndExcluding" : "2.3", "family" : "ET200", "orderNumbers" : ['6AG2543-6WX00-4XE0']},
    "cpe:/o:siemens:simatic_cp_443-1_firmware:3.3" :
        {"versionEndExcluding" : "3.3", "family" : "S7400", "orderNumbers" : ['6GK7443-1EX30-0XE0', '6GK7443-1EX30-0XE1']},
    "cpe:/o:siemens:simatic_cp_443-1_advanced_firmware:3.3" :
        {"versionEndExcluding" : "3.3", "family" : "S7400", "orderNumbers" : ['6GK7443-1GX30-0XE0']},
    "cpe:/o:siemens:siplus_net_cp_443-1_firmware:3.3" :
        {"versionEndExcluding" : "3.3", "family" : "S7400", "orderNumbers" : ['6AG1443-1EX30-4XE0']},
    "cpe:/o:siemens:siplus_net_cp_443-1_advanced_firmware:3.3" :
        {"versionEndExcluding" : "3.3", "family" : "S7400", "orderNumbers" : ['6AG1443-1GX30-4XE0']},
    "cpe:/o:siemens:simatic_cp_1242-7_v2_firmware:3.4.29" :
        {"versionEndExcluding" : "3.4.29", "family" : "S71200", "orderNumbers" : ['6GK7242-7KX31-0XE0']},
    "cpe:/o:siemens:simatic_cp_1243-1_firmware:3.4.29" :
        {"versionEndExcluding" : "3.4.29", "family" : "S71200", "orderNumbers" : ['6GK7243-1BX30-0XE0']},
    "cpe:/o:siemens:simatic_cp_1243-1_dnp3_firmware" :
        {"versionEndExcluding" : "3.4.29", "family" : "S71200"},
    "cpe:/o:siemens:simatic_cp_1243-1_iec_firmware" :
        {"versionEndExcluding" : "3.4.29", "family" : "S71200"},
    "cpe:/o:siemens:simatic_cp_1243-7_lte_eu_firmware:3.4.29" :
        {"versionEndExcluding" : "3.4.29", "family" : "S71200", "orderNumbers" : ['6GK7243-7KX30-0XE0']},
    "cpe:/o:siemens:simatic_cp_1243-7_lte_us_firmware:3.4.29" :
        {"versionEndExcluding" : "3.4.29", "family" : "S71200", "orderNumbers" : ['6GK7243-7SX30-0XE0']},
    "cpe:/o:siemens:simatic_cp_1243-8_irc_firmware:3.4.29" :
        {"versionEndExcluding" : "3.4.29", "family" : "S71200", "orderNumbers" : ['6GK7243-8RX30-0XE0']},
    "cpe:/o:siemens:siplus_net_cp_1242-7_v2_firmware:3.4.29" :
        {"versionEndExcluding" : "3.4.29", "family" : "S71200", "orderNumbers" : ['6AG1242-7KX31-7XE0']},
    "cpe:/o:siemens:siplus_s7-1200_cp_1243-1_firmware:3.4.29" :
        {"versionEndExcluding" : "3.4.29", "family" : "S71200", "orderNumbers" : ['6AG1243-1BX30-2AX0']},
    "cpe:/o:siemens:siplus_s7-1200_cp_1243-1_rail_firmware:3.4.29" :
        {"versionEndExcluding" : "3.4.29", "family" : "S71200", "orderNumbers" : ['6AG2243-1BX30-1XE0']}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_HOLE);
