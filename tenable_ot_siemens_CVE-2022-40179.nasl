#%NASL_MIN_LEVEL 80900
##
# (C) Tenable, Inc.
##

include('compat.inc');

if (description)
{
  script_id(500745);
  script_version("1.6");
  script_set_attribute(attribute:"plugin_modification_date", value:"2024/09/04");

  script_cve_id("CVE-2022-40179");
  script_xref(name:"ICSA", value:"22-286-06");

  script_name(english:"Siemens Desigo PXM Devices Cross-Site Request Forgery (CVE-2022-40179)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"A vulnerability has been identified in Desigo PXM30-1 (All versions <
V02.20.126.11-41), Desigo PXM30.E (All versions < V02.20.126.11-41),
Desigo PXM40-1 (All versions < V02.20.126.11-41), Desigo PXM40.E (All
versions < V02.20.126.11-41), Desigo PXM50-1 (All versions <
V02.20.126.11-41), Desigo PXM50.E (All versions < V02.20.126.11-41),
PXG3.W100-1 (All versions < V02.20.126.11-37), PXG3.W100-2 (All
versions < V02.20.126.11-41), PXG3.W200-1 (All versions <
V02.20.126.11-37), PXG3.W200-2 (All versions < V02.20.126.11-41). A
Cross-Site Request Forgery exists in endpoints of the Operation web
application that interpret and execute Axon language queries, due to
the missing validation of anti-CSRF tokens or other origin checks. By
convincing a victim to click on a malicious link or visit a
specifically crafted webpage while logged-in to the device web
application, a remote unauthenticated attacker can execute arbitrary
Axon queries against the device.

This plugin only works with Tenable.ot.
Please visit https://www.tenable.com/products/tenable-ot for more information.");
  script_set_attribute(attribute:"see_also", value:"https://cert-portal.siemens.com/productcert/pdf/ssa-360783.pdf");
  script_set_attribute(attribute:"see_also", value:"https://www.cisa.gov/news-events/ics-advisories/icsa-22-286-06");
  script_set_attribute(attribute:"solution", value:
"The following text was originally created by the Cybersecurity and Infrastructure Security Agency (CISA). The original
can be found at CISA.gov.

Siemens has released updates for the affected products and recommends users update to the latest versions:

- Desigo PXM30-1: Update to V02.20.126.11-41 or later
- Desigo PXM30.E: Update to V02.20.126.11-41 or later
- Desigo PXM40-1: Update to V02.20.126.11-41 or later
- Desigo PXM40.E: Update to V02.20.126.11-41 or later
- Desigo PXM50-1: Update to V02.20.126.11-41 or later
- Desigo PXM50.E: Update to V02.20.126.11-41 or later
- PXG3.W100-1: Update to V02.20.126.11-37 or later
- PXG3.W100-2: Update to V02.20.126.11-41 or later
- PXG3.W200-1: Update to V02.20.126.11-37 or later
- PXG3.W200-2: Update to V02.20.126.11-41 or later

 As a general security measure, Siemens recommends protecting network access to devices with appropriate mechanisms. To
operate the devices in a protected IT environment, Siemens recommends configuring the environment according to Siemensâ€™
operational guidelines for industrial security and following recommendations in the product manuals.

Additional information on industrial security by Siemens can be found on the Siemens industrial security webpage.

For more information, see the associated Siemens Security Advisory in HTML or CSAF formats.");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:L/Au:N/C:C/I:C/A:N");
  script_set_cvss_temporal_vector("CVSS2#E:U/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:N");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:U/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2022-40179");

  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"false");
  script_cwe_id(352);

  script_set_attribute(attribute:"vuln_publication_date", value:"2022/10/11");
  script_set_attribute(attribute:"patch_publication_date", value:"2022/10/11");
  script_set_attribute(attribute:"plugin_publication_date", value:"2023/01/25");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:desigo_pxm30-1_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:desigo_pxm30.e_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:desigo_pxm40-1_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:desigo_pxm40.e_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:desigo_pxm50-1_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:desigo_pxm50.e_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:pxg3.w100-1_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:pxg3.w100-2_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:pxg3.w200-1_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:pxg3.w200-2_firmware");
  script_set_attribute(attribute:"generated_plugin", value:"current");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2023-2024 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/Siemens");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/Siemens');

var asset = tenable_ot::assets::get(vendor:'Siemens');

var vuln_cpes = {
    "cpe:/o:siemens:desigo_pxm30-1_firmware" :
        {"versionEndExcluding" : "02.20.126.11-41", "family" : "Desigo"},
    "cpe:/o:siemens:desigo_pxm30.e_firmware" :
        {"versionEndExcluding" : "02.20.126.11-41", "family" : "Desigo"},
    "cpe:/o:siemens:desigo_pxm40-1_firmware" :
        {"versionEndExcluding" : "02.20.126.11-41", "family" : "Desigo"},
    "cpe:/o:siemens:desigo_pxm40.e_firmware" :
        {"versionEndExcluding" : "02.20.126.11-41", "family" : "Desigo"},
    "cpe:/o:siemens:desigo_pxm50-1_firmware" :
        {"versionEndExcluding" : "02.20.126.11-41", "family" : "Desigo"},
    "cpe:/o:siemens:desigo_pxm50.e_firmware" :
        {"versionEndExcluding" : "02.20.126.11-41", "family" : "Desigo"},
    "cpe:/o:siemens:pxg3.w100-1_firmware" :
        {"versionEndExcluding" : "02.20.126.11-37", "family" : "Desigo"},
    "cpe:/o:siemens:pxg3.w100-2_firmware" :
        {"versionEndExcluding" : "02.20.126.11-41", "family" : "Desigo"},
    "cpe:/o:siemens:pxg3.w200-1_firmware" :
        {"versionEndExcluding" : "02.20.126.11-37", "family" : "Desigo"},
    "cpe:/o:siemens:pxg3.w200-2_firmware" :
        {"versionEndExcluding" : "02.20.126.11-41", "family" : "Desigo"}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_HOLE);
