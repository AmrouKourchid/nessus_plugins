#%NASL_MIN_LEVEL 80900
##
# (C) Tenable, Inc.
##

include('compat.inc');

if (description)
{
  script_id(501478);
  script_version("1.8");
  script_set_attribute(attribute:"plugin_modification_date", value:"2024/11/25");

  script_cve_id("CVE-2021-4161");
  script_xref(name:"ICSA", value:"21-357-01");

  script_name(english:"Moxa MGate Protocol Gateways Cleartext Transmission of Sensitive Information (CVE-2021-4161)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"The affected products contain vulnerable firmware, which could allow
an attacker to sniff the traffic and decrypt login credential details.
This could give an attacker admin rights through the HTTP web server.

This plugin only works with Tenable.ot.
Please visit https://www.tenable.com/products/tenable-ot for more information.");
  script_set_attribute(attribute:"see_also", value:"https://www.cisa.gov/uscert/ics/advisories/icsa-21-357-01");
  script_set_attribute(attribute:"solution", value:
"The following text was originally created by the Cybersecurity and Infrastructure Security Agency (CISA). The original
can be found at CISA.gov.

Moxa has developed the following mitigations to address this vulnerability.

- Enable ‘HTTPS’ and disable the HTTP console function under ‘Console Settings’

Moxa also recommends users refer to Tech Note: Moxa Security Hardening Guide for MGate MB3000 Series");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:L/Au:N/C:P/I:N/A:N");
  script_set_cvss_temporal_vector("CVSS2#E:U/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:U/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2021-4161");

  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"false");
  script_cwe_id(319);

  script_set_attribute(attribute:"vuln_publication_date", value:"2021/12/27");
  script_set_attribute(attribute:"patch_publication_date", value:"2021/12/27");
  script_set_attribute(attribute:"plugin_publication_date", value:"2023/08/02");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:moxa:mgate_mb3180_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:moxa:mgate_mb3280_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:moxa:mgate_mb3480_firmware");
  script_set_attribute(attribute:"generated_plugin", value:"current");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2023-2024 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/Moxa");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/Moxa');

var asset = tenable_ot::assets::get(vendor:'Moxa');

var vuln_cpes = {
    "cpe:/o:moxa:mgate_mb3180_firmware" :
        {"versionEndIncluding" : "2.2", "family" : "MoxaMGate"},
    "cpe:/o:moxa:mgate_mb3280_firmware" :
        {"versionEndIncluding" : "4.1", "family" : "MoxaMGate"},
    "cpe:/o:moxa:mgate_mb3480_firmware" :
        {"versionEndIncluding" : "3.2", "family" : "MoxaMGate"}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_WARNING);
