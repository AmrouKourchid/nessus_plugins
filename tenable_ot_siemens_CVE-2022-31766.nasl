#%NASL_MIN_LEVEL 80900
##
# (C) Tenable, Inc.
##

include('compat.inc');

if (description)
{
  script_id(500884);
  script_version("1.7");
  script_set_attribute(attribute:"plugin_modification_date", value:"2025/03/10");

  script_cve_id("CVE-2022-31766");
  script_xref(name:"ICSA", value:"22-286-08");

  script_name(english:"Siemens TCP Event Service of SCALANCE And RUGGEDCOM Devices Improper Input Validation (CVE-2022-31766)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"A vulnerability has been identified in RUGGEDCOM RM1224 LTE(4G) EU
(All versions < V7.1.2), RUGGEDCOM RM1224 LTE(4G) NAM (All versions <
V7.1.2), SCALANCE M804PB (All versions < V7.1.2), SCALANCE M812-1
ADSL-Router (Annex A) (All versions < V7.1.2), SCALANCE M812-1 ADSL-
Router (Annex B) (All versions < V7.1.2), SCALANCE M816-1 ADSL-Router
(Annex A) (All versions < V7.1.2), SCALANCE M816-1 ADSL-Router (Annex
B) (All versions < V7.1.2), SCALANCE M826-2 SHDSL-Router (All versions
< V7.1.2), SCALANCE M874-2 (All versions < V7.1.2), SCALANCE M874-3
(All versions < V7.1.2), SCALANCE M876-3 (EVDO) (All versions <
V7.1.2), SCALANCE M876-3 (ROK) (All versions < V7.1.2), SCALANCE
M876-4 (All versions < V7.1.2), SCALANCE M876-4 (EU) (All versions <
V7.1.2), SCALANCE M876-4 (NAM) (All versions < V7.1.2), SCALANCE
MUM853-1 (EU) (All versions < V7.1.2), SCALANCE MUM856-1 (EU) (All
versions < V7.1.2), SCALANCE MUM856-1 (RoW) (All versions < V7.1.2),
SCALANCE S615 (All versions < V7.1.2), SCALANCE S615 EEC (All versions
< V7.1.2), SCALANCE WAM763-1 (All versions >= V1.1.0 < V2.0), SCALANCE
WAM766-1 (EU) (All versions >= V1.1.0 < V2.0), SCALANCE WAM766-1 (US)
(All versions >= V1.1.0 < V2.0), SCALANCE WAM766-1 EEC (EU) (All
versions >= V1.1.0 < V2.0), SCALANCE WAM766-1 EEC (US) (All versions
>= V1.1.0 < V2.0), SCALANCE WUM763-1 (All versions >= V1.1.0 < V2.0),
SCALANCE WUM763-1 (All versions >= V1.1.0 < V2.0), SCALANCE WUM766-1
(EU) (All versions >= V1.1.0 < V2.0), SCALANCE WUM766-1 (US) (All
versions >= V1.1.0 < V2.0). Affected devices with TCP Event service
enabled do not properly handle malformed packets. This could allow an
unauthenticated remote attacker to cause a denial of service condition
and reboot the device thus possibly affecting other network resources.

This plugin only works with Tenable.ot.
Please visit https://www.tenable.com/products/tenable-ot for more information.");
  script_set_attribute(attribute:"see_also", value:"https://cert-portal.siemens.com/productcert/pdf/ssa-697140.pdf");
  script_set_attribute(attribute:"see_also", value:"https://www.cisa.gov/news-events/ics-advisories/icsa-22-286-08");
  script_set_attribute(attribute:"solution", value:
"The following text was originally created by the Cybersecurity and Infrastructure Security Agency (CISA). The original
can be found at CISA.gov.

Siemens has released updates for several affected products and recommends updating to the latest versions. Siemens is
preparing further updates and recommends specific countermeasures for products where updates are not, or not yet
available:

- RUGGEDCOM RM1224 LTE(4G) EU (6GK6108-4AM00-2BA2): Update to v7.1.2 or later
- RUGGEDCOM RM1224 LTE(4G) NAM (6GK6108-4AM00-2DA2): Update to v7.1.2 or later
- SCALANCE M804PB (6GK5804-0AP00-2AA2): Update to v7.1.2 or later
- SCALANCE M812-1 ADSL-Router (Annex A) (6GK5812-1AA00-2AA2): Update to v7.1.2 or later
- SCALANCE M812-1 ADSL-Router (Annex B) (6GK5812-1BA00-2AA2): Update to v7.1.2 or later
- SCALANCE M816-1 ADSL-Router (Annex A) (6GK5816-1AA00-2AA2): Update to v7.1.2 or later
- SCALANCE M816-1 ADSL-Router (Annex B) (6GK5816-1BA00-2AA2): Update to v7.1.2 or later
- SCALANCE M826-2 SHDSL-Router (6GK5826-2AB00-2AB2): Update to v7.1.2 or later
- SCALANCE M874-2 (6GK5874-2AA00-2AA2): Update to v7.1.2 or later
- SCALANCE M874-3 (6GK5874-3AA00-2AA2): Update to v7.1.2 or later
- SCALANCE M876-3 (EVDO) (6GK5876-3AA02-2BA2): Update to v7.1.2 or later
- SCALANCE M876-3 (ROK) (6GK5876-3AA02-2EA2): Update to v7.1.2 or later
- SCALANCE M876-4 (EU) (6GK5876-4AA00-2BA2): Update to v7.1.2 or later
- SCALANCE M876-4 (NAM) (6GK5876-4AA00-2DA2): Update to v7.1.2 or later
- SCALANCE MUM853-1 (EU) (6GK5853-2EA00-2DA1): Update to v7.1.2 or later
- SCALANCE MUM856-1 (EU) (6GK5856-2EA00-3DA1): Update to v7.1.2 or later
- SCALANCE MUM856-1 (RoW) (6GK5856-2EA00-3AA1): Update to v7.1.2 or later
- SCALANCE S615 (6GK5615-0AA00-2AA2): Update to v7.1.2 or later

Siemens has identified the following specific workarounds and mitigations that customers can apply to reduce risk:

- Deactivate the TCP Event feature, which is not active by default.
- Restrict access to the TCP Event Service port (default 26864/TCP) to only trusted networks and client IP addresses.

As a general security measure, Siemens recommends protecting network access to devices with appropriate mechanisms. To
operate the devices in a protected IT environment, Siemens recommends configuring the environment according to Siemensâ€™
operational guidelines for industrial security and following recommendations in the product manuals.

Additional information on industrial security by Siemens can be found on the Siemens industrial security webpage.

For more information see Siemens Security Advisory SSA-697140 in HTML or CSAF.");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:L/Au:N/C:N/I:N/A:C");
  script_set_cvss_temporal_vector("CVSS2#E:U/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:C/C:N/I:N/A:H");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:U/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2022-31766");

  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");
  script_cwe_id(20);

  script_set_attribute(attribute:"vuln_publication_date", value:"2022/10/11");
  script_set_attribute(attribute:"patch_publication_date", value:"2022/10/11");
  script_set_attribute(attribute:"plugin_publication_date", value:"2023/03/20");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:ruggedcom_rm1224_lte%284g%29_eu_firmware:7.1.2");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:ruggedcom_rm1224_lte%284g%29_nam_firmware:7.1.2");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_m804pb_firmware:7.1.2");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_m812-1_adsl-router_firmware:7.1.2");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_m816-1_adsl-router_firmware:7.1.2");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_m826-2_shdsl-router_firmware:7.1.2");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_m874-2_firmware:7.1.2");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_m874-3_firmware:7.1.2");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_m876-3_%28rok%29_firmware:7.1.2");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_m876-3_firmware:7.1.2");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_m876-4_%28eu%29_firmware:7.1.2");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_m876-4_%28nam%29_firmware:7.1.2");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_m876-4_firmware:7.1.2");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_mum853-1_%28eu%29_firmware:7.1.2");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_mum856-1_%28eu%29_firmware:7.1.2");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_mum856-1_%28row%29_firmware:7.1.2");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_s615_eec_lan-router_firmware:7.1.2");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_s615_lan-router_firmware:7.1.2");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_wam763-1_firmware:3.0.0");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_wam766-1_%28us%29_firmware:3.0.0");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_wam766-1_eec_%28us%29_firmware:3.0.0");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_wam766-1_eec_firmware:3.0.0");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_wam766-1_firmware:3.0.0");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_wum763-1_firmware:3.0.0");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_wum766-1_%28usa%29_firmware:3.0.0");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_wum766-1_firmware:3.0.0");
  script_set_attribute(attribute:"generated_plugin", value:"former");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2023-2025 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/Siemens");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/Siemens');

var asset = tenable_ot::assets::get(vendor:'Siemens');

var vuln_cpes = {
    "cpe:/o:siemens:scalance_wam763-1_firmware:3.0.0" :
        {"versionEndExcluding" : "3.0.0", "versionStartIncluding" : "1.1.0", "family" : "SCALANCEW", "orderNumbers" : ['6GK5763-1AL00-7DA0']},
    "cpe:/o:siemens:scalance_wam766-1_firmware:3.0.0" :
        {"versionEndExcluding" : "3.0.0", "versionStartIncluding" : "1.1.0", "family" : "SCALANCEW", "orderNumbers" : ['6GK5766-1GE00-7DA0']},
    "cpe:/o:siemens:scalance_wam766-1_%28us%29_firmware:3.0.0" :
        {"versionEndExcluding" : "3.0.0", "versionStartIncluding" : "1.1.0", "family" : "SCALANCEW", "orderNumbers" : ['6GK5766-1GE00-7DB0']},
    "cpe:/o:siemens:scalance_wam766-1_eec_firmware:3.0.0" :
        {"versionEndExcluding" : "3.0.0", "versionStartIncluding" : "1.1.0", "family" : "SCALANCEW", "orderNumbers" : ['6GK5766-1GE00-7TA0']},
    "cpe:/o:siemens:scalance_wam766-1_eec_%28us%29_firmware:3.0.0" :
        {"versionEndExcluding" : "3.0.0", "versionStartIncluding" : "1.1.0", "family" : "SCALANCEW", "orderNumbers" : ['6GK5766-1GE00-7TB0']},
    "cpe:/o:siemens:scalance_wum763-1_firmware:3.0.0" :
        {"versionEndExcluding" : "3.0.0", "versionStartIncluding" : "1.1.0", "family" : "SCALANCEW", "orderNumbers" : ['6GK5763-1AL00-3DA0', '6GK5763-1AL00-3AA0']},
    "cpe:/o:siemens:scalance_wum766-1_firmware:3.0.0" :
        {"versionEndExcluding" : "3.0.0", "versionStartIncluding" : "1.1.0", "family" : "SCALANCEW", "orderNumbers" : ['6GK5766-1GE00-3DA0']},
    "cpe:/o:siemens:scalance_wum766-1_%28usa%29_firmware:3.0.0" :
        {"versionEndExcluding" : "3.0.0", "versionStartIncluding" : "1.1.0", "family" : "SCALANCEW", "orderNumbers" : ['6GK5766-1GE00-3DB0']},
    "cpe:/o:siemens:ruggedcom_rm1224_lte%284g%29_eu_firmware:7.1.2" :
        {"versionEndExcluding" : "7.1.2", "family" : "RuggedCom", "orderNumbers" : ['6GK6108-4AM00-2BA2']},
    "cpe:/o:siemens:ruggedcom_rm1224_lte%284g%29_nam_firmware:7.1.2" :
        {"versionEndExcluding" : "7.1.2", "family" : "RuggedCom", "orderNumbers" : ['6GK6108-4AM00-2DA2']},
    "cpe:/o:siemens:scalance_m804pb_firmware:7.1.2" :
        {"versionEndExcluding" : "7.1.2", "family" : "SCALANCEM", "orderNumbers" : ['6GK5804-0AP00-2AA2']},
    "cpe:/o:siemens:scalance_m812-1_adsl-router_firmware:7.1.2" :
        {"versionEndExcluding" : "7.1.2", "family" : "SCALANCEM", "orderNumbers" : ['6GK5812-1AA00-2AA2', '6GK5812-1BA00-2AA2']},
    "cpe:/o:siemens:scalance_m816-1_adsl-router_firmware:7.1.2" :
        {"versionEndExcluding" : "7.1.2", "family" : "SCALANCEM", "orderNumbers" : ['6GK5816-1BA00-2AA2', '6GK5816-1AA00-2AA2']},
    "cpe:/o:siemens:scalance_m826-2_shdsl-router_firmware:7.1.2" :
        {"versionEndExcluding" : "7.1.2", "family" : "SCALANCEM", "orderNumbers" : ['6GK5826-2AB00-2AB2']},
    "cpe:/o:siemens:scalance_m874-2_firmware:7.1.2" :
        {"versionEndExcluding" : "7.1.2", "family" : "SCALANCEM", "orderNumbers" : ['6GK5874-2AA00-2AA2']},
    "cpe:/o:siemens:scalance_m874-3_firmware:7.1.2" :
        {"versionEndExcluding" : "7.1.2", "family" : "SCALANCEM", "orderNumbers" : ['6GK5874-3AA00-2AA2']},
    "cpe:/o:siemens:scalance_m876-3_firmware:7.1.2" :
        {"versionEndExcluding" : "7.1.2", "family" : "SCALANCEM", "orderNumbers" : ['6GK5876-3AA02-2BA2']},
    "cpe:/o:siemens:scalance_m876-3_%28rok%29_firmware:7.1.2" :
        {"versionEndExcluding" : "7.1.2", "family" : "SCALANCEM", "orderNumbers" : ['6GK5876-3AA02-2EA2']},
    "cpe:/o:siemens:scalance_m876-4_firmware:7.1.2" :
        {"versionEndExcluding" : "7.1.2", "family" : "SCALANCEM", "orderNumbers" : ['6GK5876-4AA10-2BA2']},
    "cpe:/o:siemens:scalance_m876-4_%28eu%29_firmware:7.1.2" :
        {"versionEndExcluding" : "7.1.2", "family" : "SCALANCEM", "orderNumbers" : ['6GK5876-4AA00-2BA2']},
    "cpe:/o:siemens:scalance_m876-4_%28nam%29_firmware:7.1.2" :
        {"versionEndExcluding" : "7.1.2", "family" : "SCALANCEM", "orderNumbers" : ['6GK5876-4AA00-2DA2']},
    "cpe:/o:siemens:scalance_mum853-1_%28eu%29_firmware:7.1.2" :
        {"versionEndExcluding" : "7.1.2", "family" : "SCALANCEM", "orderNumbers" : ['6GK5853-2EA00-2DA1']},
    "cpe:/o:siemens:scalance_mum856-1_%28eu%29_firmware:7.1.2" :
        {"versionEndExcluding" : "7.1.2", "family" : "SCALANCEM", "orderNumbers" : ['6GK5856-2EA00-3DA1']},
    "cpe:/o:siemens:scalance_mum856-1_%28row%29_firmware:7.1.2" :
        {"versionEndExcluding" : "7.1.2", "family" : "SCALANCEM", "orderNumbers" : ['6GK5856-2EA00-3AA1']},
    "cpe:/o:siemens:scalance_s615_eec_lan-router_firmware:7.1.2" :
        {"versionEndExcluding" : "7.1.2", "family" : "SCALANCES", "orderNumbers" : ['6GK5615-0AA01-2AA2']},
    "cpe:/o:siemens:scalance_s615_lan-router_firmware:7.1.2" :
        {"versionEndExcluding" : "7.1.2", "family" : "SCALANCES", "orderNumbers" : ['6GK5615-0AA00-2AA2']}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_HOLE);
