#%NASL_MIN_LEVEL 80900
##
# (C) Tenable, Inc.
##

include('compat.inc');

if (description)
{
  script_id(232199);
  script_version("1.1");
  script_set_attribute(attribute:"plugin_modification_date", value:"2025/03/06");

  script_cve_id("CVE-2024-53705");

  script_name(english:"SonicWall SonicOS SSRF (CVE-2024-53705) (SNWLID-2025-0003)");

  script_set_attribute(attribute:"synopsis", value:
"The remote host is affected by an SSRF vulnerability.");
  script_set_attribute(attribute:"description", value:
"According to its self-reported version, the remote SonicWall firewall is running a version of SonicOS that is affected
by an SSRF vulnerability in the SonicOS SSH management interface. The vulnerability allows a remote attacker to
establish a TCP connection to an IP address on any port when the user is logged in to the firewall.

Note that Nessus has not tested for this issue but has instead relied only on the application's self-reported version
number.");
  script_set_attribute(attribute:"see_also", value:"https://psirt.global.sonicwall.com/vuln-detail/SNWLID-2025-0003");
  script_set_attribute(attribute:"solution", value:
"Upgrade to the relevant fixed version referenced in the vendor security advisory.");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:L/Au:N/C:N/I:P/A:N");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:N");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2024-53705");

  script_set_attribute(attribute:"vuln_publication_date", value:"2025/01/07");
  script_set_attribute(attribute:"patch_publication_date", value:"2025/01/07");
  script_set_attribute(attribute:"plugin_publication_date", value:"2025/03/06");

  script_set_attribute(attribute:"plugin_type", value:"combined");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:sonicwall:sonicos");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Firewalls");

  script_copyright(english:"This script is Copyright (C) 2025 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("sonicwall_sonicos_installed.nbin");
  script_require_keys("installed_sw/SonicWall SonicOS");

  exit(0);
}

include('vcf_extras.inc');

var app_info = vcf::get_app_info(app:'SonicWall SonicOS');

var gen6_vuln_models = [
  'SOHOW',
  'TZ 300',
  'TZ 300W',
  'TZ 400',
  'TZ 400W',
  'TZ 500',
  'TZ 500W',
  'TZ 600',
  'NSA 2650',
  'NSA 3600',
  'NSA 3650',
  'NSA 4600',
  'NSA 4650',
  'NSA 5600',
  'NSA 5650',
  'NSA 6600',
  'NSA 6650',
  'SM 9200',
  'SM 9250',
  'SM 9400',
  'SM 9450',
  'SM 9600',
  'SM 9650',
  'TZ 300P',
  'TZ 600P',
  'SOHO 250',
  'SOHO 250W',
  'TZ 350',
  'TZ 350W'
];

var gen7_vuln_models = [
  'TZ270',
  'TZ270W',
  'TZ370',
  'TZ370W',
  'TZ470',
  'TZ470W',
  'TZ570',
  'TZ570W',
  'TZ570P',
  'TZ670',
  'NSa 2700',
  'NSa 3700',
  'NSa 4700',
  'NSa 5700',
  'NSa 6700',
  'NSsp 10700',
  'NSsp 11700',
  'NSsp 13700',
  'NSsp 15700',
  'NSv 270',
  'NSv 470',
  'NSv 870'
];

var constraints = [
  { 'min_version':'6.0.0', 'max_version':'6.5.4.14', 'fixed_display':'6.5.5.1-6n', 'models':gen6_vuln_models},
  # 6.5.4.15-117n is vulnerable. Set ext to 118 to check
  { 'equal':'6.5.4.15', 'ext':'118',                 'fixed_display':'6.5.5.1-6n', 'models':gen6_vuln_models},
  { 'equal':'7.0.0',                                 'fixed_display':'7.0.1-5165', 'models':gen7_vuln_models},
  { 'equal':'7.0.1', 'ext':'5165',                   'fixed_display':'7.0.1-5165', 'models':gen7_vuln_models}
];

vcf::sonicwall_sonicos::check_version_and_report(app_info:app_info, constraints:constraints, severity:SECURITY_WARNING);
