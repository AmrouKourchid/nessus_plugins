#%NASL_MIN_LEVEL 80900
##
# (C) Tenable, Inc.
##

include('compat.inc');

if (description)
{
  script_id(208940);
  script_version("1.3");
  script_set_attribute(attribute:"plugin_modification_date", value:"2024/12/12");

  script_cve_id("CVE-2024-45739");
  script_xref(name:"IAVA", value:"2024-A-0662-S");

  script_name(english:"Splunk Enterprise 9.1.0 < 9.1.6, 9.2.0 < 9.2.3, 9.3.0 < 9.3.1 (SVD-2024-1009)");

  script_set_attribute(attribute:"synopsis", value:
"An application running on a remote web server host is affected by a vulnerability");
  script_set_attribute(attribute:"description", value:
"The version of Splunk installed on the remote host is prior to tested version. It is, therefore, affected by a
vulnerability as referenced in the SVD-2024-1009 advisory.

  - In Splunk Enterprise versions below 9.3.1, 9.2.3, and 9.1.6, the software potentially exposes plaintext
    passwords for local native authentication Splunk users. This exposure could happen when you configure the
    Splunk Enterprise AdminManager log channel at the DEBUG logging level. (CVE-2024-45739)

Note that Nessus has not tested for this issue but has instead relied only on the application's self-reported version
number.");
  script_set_attribute(attribute:"see_also", value:"https://advisory.splunk.com/advisories/SVD-2024-1009.html");
  script_set_attribute(attribute:"solution", value:
"There are multiple solutions depending on how you have configured the Splunk Enterprise instance AdminManager log
channel.First, determine whether or not debug logging is on for the AdminManager log channel. You must log into the
Splunk Enterprise instance as an admin user or equivalent to perform these actions. To determine the logging level for
this log channel on the instance: 1. In a web browser, visit the Server Logging Settings page in Splunk Web at /en-
US/manager/system/server/logger. 2. Review the Logging Level column on the page that loads. If the AdminManager row in
this column shows DEBUG as the logging level, then the Splunk Enterprise AdminManager log channel is in debug mode.
Otherwise, it is not in debug mode.See Enable debug logging for more information.If the previous steps determine that
debug logging is enabled in that log channel, then remedy the problem by performing the following tasks: 1. Upgrade
Splunk Enterprise to versions 9.3.1, 9.2.3, 9.1.6, or higher. 2. Delete the following log file on the Splunk Enterprise
instance: $SPLUNK_HOME/var/log/splunk/splunkd.log 3. Delete all the Splunk Enterprise log file events for the
AdminManager component from the _internal index by running the following search command: index=_internal
component=AdminManager | delete");
  script_set_attribute(attribute:"agent", value:"all");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:L/Au:M/C:C/I:N/A:N");
  script_set_cvss_temporal_vector("CVSS2#E:U/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:N/A:N");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:U/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2024-45739");

  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"false");
  script_cwe_id(200);

  script_set_attribute(attribute:"vuln_publication_date", value:"2024/10/14");
  script_set_attribute(attribute:"patch_publication_date", value:"2024/10/14");
  script_set_attribute(attribute:"plugin_publication_date", value:"2024/10/14");

  script_set_attribute(attribute:"potential_vulnerability", value:"true");
  script_set_attribute(attribute:"plugin_type", value:"combined");
  script_set_attribute(attribute:"cpe", value:"cpe:/a:splunk:splunk");
  script_set_attribute(attribute:"generated_plugin", value:"current");
  script_set_attribute(attribute:"stig_severity", value:"I");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"CGI abuses");

  script_copyright(english:"This script is Copyright (C) 2024 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("splunkd_detect.nasl", "splunk_web_detect.nasl", "macos_splunk_installed.nbin", "splunk_win_installed.nbin", "splunk_nix_installed.nbin");
  script_require_keys("installed_sw/Splunk", "Settings/ParanoidReport");

  exit(0);
}

include('vcf.inc');
include('vcf_extras_splunk.inc');

if (report_paranoia < 2) audit(AUDIT_PARANOID);

var app_info = vcf::splunk::get_app_info();

var constraints = [
  { 'min_version' : '9.1.0', 'fixed_version' : '9.1.6', 'license' : 'Enterprise' },
  { 'min_version' : '9.2.0', 'fixed_version' : '9.2.3', 'license' : 'Enterprise' },
  { 'min_version' : '9.3.0', 'fixed_version' : '9.3.1', 'license' : 'Enterprise' }
];
vcf::splunk::check_version_and_report(
    app_info:app_info,
    constraints:constraints,
    severity:SECURITY_WARNING
);
