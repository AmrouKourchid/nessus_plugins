#%NASL_MIN_LEVEL 80900
##
# (C) Tenable, Inc.
##

include('compat.inc');

if (description)
{
  script_id(502689);
  script_version("1.3");
  script_set_attribute(attribute:"plugin_modification_date", value:"2024/12/12");

  script_cve_id("CVE-2024-8933");
  script_xref(name:"ICSA", value:"24-326-03");

  script_name(english:"Schneider Electric Modicon M340, MC80, and Momentum Unity M1E Improper Enforcement of Message Integrity During Transmission in a Communication Channel (CVE-2024-8933)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"A vulnerability exists that could cause retrieval of password hash 
that could lead to denial of service and loss of confidentiality 
and integrity of controllers. To be successful, the attacker needs 
to inject themselves inside the logical network while a valid user 
uploads or downloads a project file into the controller.

This plugin only works with Tenable.ot.
Please visit https://www.tenable.com/products/tenable-ot for more information.");
  # https://download.schneider-electric.com/doc/SEVD-2024-317-02/SEVD-2024-317-02.pdf
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?1d3b28ca");
  script_set_attribute(attribute:"see_also", value:"https://www.cisa.gov/news-events/ics-advisories/icsa-24-326-03");
  script_set_attribute(attribute:"solution", value:
'The following text was originally created by the Cybersecurity and Infrastructure Security Agency (CISA). The original
can be found at CISA.gov.

Schneider Electric is establishing a remediation plan for all future versions of Modicon M340 that will include a fix
for CVE-2024-8933 vulnerability and a mitigation for CVE-2024-8935.

Additionally, Schneider Electric will update this document when the remediation is available. Until then, users should
immediately apply the following mitigations to reduce the risk of exploit:

- Setup network segmentation and implement a firewall to block all unauthorized access to port 502/TCP
- Configure the Access Control List following the recommendations of the user manuals: "Modicon M340 for Ethernet
Communications Modules and Processors User Manual" in chapter "Messaging Configuration Parameters"
- Consider use of external firewall devices such as EAGLE40-07 from Belden to establish VPN connections. For more
details refer to "Modicon Controller Systems Cybersecurity, User Guide"
- Ensure the M340 CPU is running with the memory protection activated by configuring the input bit to a physical input,
for more details refer to the following guideline "Modicon Controller Systems Cybersecurity, User Guide" chapter
"Controler Memory Protection"

Schneider Electric is also establishing a remediation plan for all future versions of Modicon MC80 that will include a
fix for CVE-2024-8933. Schneider Electric will update this document when the remediation is available. Until then, users
should immediately apply the following mitigations to reduce the risk of exploit:

- Setup network segmentation and implement a firewall to block all unauthorized access to port 502/TCP
- Configure the Access Control List following the recommendations of the user manuals: "MC80 Programmable Logic
Controller(PLC), User Manual" in the section "Access Control List (ACL)"
- Consider use of external firewall devices such as EAGLE40-07 from Belden to establish VPN connections. For more
details refer to "Modicon Controller Systems Cybersecurity, User Guide"

Schneider Electric is also establishing a remediation plan for all future versions of Modicon Momentum that will include
a fix for CVE-2024-8933. Schneider Electric will update this document when the remediation is available. Until then,
users should immediately apply the following mitigations to reduce the risk of exploit:

- Setup network segmentation and implement a firewall to block all unauthorized access to port 502/TCP
- Configure the Access Control List following the recommendations of the user manuals: "Momentum for EcoStruxureâ„¢
Control Expert -171CBU78090, 171CBU98090, 171CBU98091 Processors, User Guide" in the section "Controlling Access"
- Consider use of external firewall devices such as EAGLE40-07 from Belden to establish VPN connections. For more
details refer to "Modicon Controller Systems Cybersecurity, User Guide"

To ensure you are informed of all updates, including details on affected products and remediation plans, subscribe to
Schneider Electric\'s security notification service here.

General Security RecommendationsSchneider Electric strongly recommend the following industry cybersecurity best
practices.

- Locate control and safety system networks and remote devices behind firewalls and isolate them from the business
network.
- Install physical controls so no unauthorized personnel can access your industrial control and safety systems,
components, peripheral equipment, and networks.
- Place all controllers in locked cabinets and never leave them in the "Program" mode.
- Never connect programming software to any network other than the network intended for that device.
- Scan all methods of mobile data exchange with the isolated network such as CDs, USB drives, etc. before use in the
terminals or any node connected to these networks.
- Never allow mobile devices that have connected to any other network besides the intended network to connect to the
safety or control networks without proper sanitation.
- Minimize network exposure for all control system devices and systems and ensure that they are not accessible from the
Internet.
- When remote access is required, use secure methods, such as Virtual Private Networks (VPNs). Recognize that VPNs may
have vulnerabilities and should be updated to the most current version available. Also, understand that VPNs are only as
secure as the connected devices.

For more information refer to the Schneider Electric Recommended Cybersecurity Best Practices document.

For more information see the associated Schneider Electric Security Notification SEVD-2024-317-02 in PDF and CSAF.');
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:H/PR:N/UI:R/S:U/C:H/I:H/A:H");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:U/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2024-8933");

  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"false");
  script_cwe_id(924);

  script_set_attribute(attribute:"vuln_publication_date", value:"2024/11/12");
  script_set_attribute(attribute:"patch_publication_date", value:"2024/11/12");
  script_set_attribute(attribute:"plugin_publication_date", value:"2024/11/28");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_m340");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_mc80");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_momentum_171cbu78090_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_momentum_171cbu98090_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_momentum_171cbu98091_firmware");
  script_set_attribute(attribute:"generated_plugin", value:"former");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2024 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/Schneider");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/Schneider');

var asset = tenable_ot::assets::get(vendor:'Schneider');

var vuln_cpes = {
    "cpe:/o:schneider-electric:modicon_m340" :
        {"family" : "ModiconM340"},
    "cpe:/o:schneider-electric:modicon_mc80" :
        {"family" : "ModiconMC80"},
    "cpe:/o:schneider-electric:modicon_momentum_171cbu78090_firmware:-" :
        {"family" : "MomentumUnity"},
    "cpe:/o:schneider-electric:modicon_momentum_171cbu98090_firmware:-" :
        {"family" : "MomentumUnity"},
    "cpe:/o:schneider-electric:modicon_momentum_171cbu98091_firmware:-" :
        {"family" : "MomentumUnity"}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_HOLE);
