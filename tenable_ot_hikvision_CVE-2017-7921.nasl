#%NASL_MIN_LEVEL 80900
##
# (C) Tenable, Inc.
##

include('compat.inc');

if (description)
{
  script_id(502300);
  script_version("1.4");
  script_set_attribute(attribute:"plugin_modification_date", value:"2024/09/04");

  script_cve_id("CVE-2017-7921");
  script_xref(name:"ICSA", value:"17-124-01");

  script_name(english:"Hikvision Cameras Improper Authentication (CVE-2017-7921)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"While processing a specified request code, the user privilege-escalating 
vulnerability may occur for select Hikvision IP cameras with particular firmware version.

This plugin only works with Tenable.ot.
Please visit https://www.tenable.com/products/tenable-ot for more information.");
  # https://www.hikvision.com/en/support/cybersecurity/security-advisory/security-notification--privilege-escalating-vulnerability-in-cer/
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?afe30f8b");
  script_set_attribute(attribute:"see_also", value:"http://www.hikvision.com/us/about_10805.html");
  script_set_attribute(attribute:"see_also", value:"http://www.securityfocus.com/bid/98313");
  script_set_attribute(attribute:"see_also", value:"https://ghostbin.com/paste/q2vq2");
  script_set_attribute(attribute:"see_also", value:"https://ics-cert.us-cert.gov/advisories/ICSA-17-124-01");
  script_set_attribute(attribute:"solution", value:
"The following text was originally created by the Cybersecurity and Infrastructure Security Agency (CISA). The original
can be found at CISA.gov.

Hikvision has released updates to mitigate the improper authentication vulnerability in cameras sold through authorized
distributers. Hikvision has not mitigated the password in configuration file vulnerability.

However, Hikvision is aware of so-called “grey market” cameras which are sold via unauthorized channels. These cameras
often use unauthorized firmware created by sources outside of Hikvision. In the case of these “grey market” devices,
updating the firmware may result in converting the camera’s interface back to its original state. Users of “grey market”
cameras who cannot update due to this unauthorized firmware will still be susceptible to these vulnerabilities.

In the Hikvision Unauthorized Distributors Notice, Hikvision encourages users to use devices sold by authorized
distributers rather than so-called “grey market” devices. Hikvision’s Unauthorized Distributors Notice can be found at
the following location:

http://www.hikvision.com/us/about.aspx?stat=1&c_kind=293&c_kind2=10631

North American models of Hikvision cameras which can be fixed and their updated firmware versions are listed below:

- DS-2CD2xx2F-I Series 
    - V5.4.5 build 170123 and later
- DS-2CD2xx0F-I Series 
    - V5.4.5 Build 170123 and later
- DS-2CD2xx2FWD Series 
    - V5.4.5 Build 170124 and later
- DS- 2CD4x2xFWD Series 
    - V5.4.5 Build 170228 and later
- DS-2CD4xx5 Series 
    - V5.4.5 Build 170302 and later
- DS-2DFx Series 
    - V5.4.9 Build 170123 and later
- DS-2CD63xx Series 
    - V5.4.5 Build 170206 and later

These updates are available for download at the following location:

http://www.hikvision.com/us/about_10805.html

More information can be found by visiting Hikvision’s Vulnerability Notice:

http://www.hikvision.com/us/about_10807.html

For Chinese-language domestic cameras, Hikvision also provides on-site tours or remote support in addition to the
updated firmware listed above.

Hikvision also states that device models and firmware upgrade procedures may differ between regions. These policies will
be communicated to users through Hikvision.");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:L/Au:N/C:P/I:P/A:P");
  script_set_cvss_temporal_vector("CVSS2#E:POC/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:P/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2017-7921");

  script_set_attribute(attribute:"exploitability_ease", value:"Exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"true");
  script_cwe_id(287);

  script_set_attribute(attribute:"vuln_publication_date", value:"2017/05/06");
  script_set_attribute(attribute:"patch_publication_date", value:"2017/05/06");
  script_set_attribute(attribute:"plugin_publication_date", value:"2024/07/22");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:hikvision:ds-2cd2x2f-i_series_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:hikvision:ds-2cd2x0_series_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:hikvision:ds-2cd4x2xfwd_series_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:hikvision:ds-2cd4x5_series_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:hikvision:ds-2cd2x2fwd_series_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:hikvision:ds-2dex_series_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:hikvision:ds-2dfx_series_firmware");
  script_set_attribute(attribute:"generated_plugin", value:"former");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2024 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/Hikvision");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/Hikvision');

var asset = tenable_ot::assets::get(vendor:'Hikvision');

var vuln_cpes = {
    "cpe:/o:hikvision:ds-2cd2x2f-i_series_firmware" :
        {"family" : "Hikvision", "versionEndExcluding" : "V5.4.41_build170310"},
    "cpe:/o:hikvision:ds-2cd2x0_series_firmware" :
        {"family" : "Hikvision", "versionEndExcluding" : "V5.4.41_build170309"},
    "cpe:/o:hikvision:ds-2cd4x2xfwd_series_firmware" :
        {"family" : "Hikvision", "versionEndExcluding" : "V5.4.41_build170310"},
    "cpe:/o:hikvision:ds-2cd4x5_series_firmware" :
        {"family" : "Hikvision", "versionEndExcluding" : "V5.4.41_build170309"},
    "cpe:/o:hikvision:ds-2cd2x2fwd_series_firmware" :
        {"family" : "Hikvision", "versionEndExcluding" : "V5.4.41_build170309"},
    "cpe:/o:hikvision:ds-2dex_series_firmware" :
        {"family" : "Hikvision", "versionEndExcluding" : "V5.4.71_build170309"},
    "cpe:/o:hikvision:ds-2dfx_series_firmware" :
        {"family" : "Hikvision", "versionEndExcluding" : "V5.4.71_build170309"}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_HOLE);
