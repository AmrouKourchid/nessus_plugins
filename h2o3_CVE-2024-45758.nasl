#%NASL_MIN_LEVEL 80900
##
# (C) Tenable, Inc.
##

include('compat.inc');

if (description)
{
  script_id(213041);
  script_version("1.2");
  script_set_attribute(attribute:"plugin_modification_date", value:"2024/12/17");

  script_cve_id("CVE-2024-8862", "CVE-2024-45758");

  script_name(english:"H2O-3 Multiple Deserialization Vulnerabilities");

  script_set_attribute(attribute:"synopsis", value:
"A Python library installed on the remote host is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"H2O.ai H2O through 3.46.0.4 allows attackers to arbitrarily set the JDBC URL, leading to deserialization attacks,
file reads, and command execution. Exploitation can occur when an attacker has access to post to the ImportSQLTable 
URI with a JSON document containing a connection_url property with any typical JDBC Connection URL attack 
payload such as one that uses queryInterceptors. (CVE-2024-45758)

A vulnerability, which was classified as critical, has been found in h2oai h2o-3 3.46.0.4. This issue affects the 
function getConnectionSafe of the file /dtale/chart-data/1 of the component JDBC Connection Handler. The manipulation 
of the argument query leads to deserialization. The attack may be initiated remotely. The exploit has been disclosed 
to the public and may be used. The vendor was contacted early about this disclosure but did not respond in any way.
(CVE-2024-8862)

Note that Nessus has not tested for this issue but has instead relied only on the application's self-reported version
number.");
  # https://rumbling-slice-eb0.notion.site/Unauthenticated-Remote-Command-Execution-via-Panda-df-query-9dc40f0477ee4b65806de7921876c222?pvs=4
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?5c6c614c");
  # https://gist.github.com/AfterSnows/c24ca3c26dc89ab797e610e92a6a9acb
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?94450711");
  script_set_attribute(attribute:"solution", value:
"This vulnerability is currently not fixed. Fix the code manually or monitor new releases for a fix.");
  script_set_attribute(attribute:"agent", value:"all");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:L/Au:N/C:C/I:C/A:C");
  script_set_cvss_temporal_vector("CVSS2#E:POC/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:P/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2024-8862");

  script_set_attribute(attribute:"exploitability_ease", value:"Exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"true");
  script_set_attribute(attribute:"vendor_unpatched", value:"true");

  script_set_attribute(attribute:"vuln_publication_date", value:"2024/09/06");
  script_set_attribute(attribute:"plugin_publication_date", value:"2024/12/16");

  script_set_attribute(attribute:"plugin_type", value:"local");
  script_set_attribute(attribute:"asset_categories", value:"component");
  script_set_attribute(attribute:"cpe", value:"cpe:/a:h2o:h2o:3");
  script_set_attribute(attribute:"thorough_tests", value:"true");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Artificial Intelligence");

  script_copyright(english:"This script is Copyright (C) 2024 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("python_h2o3_detect.nasl");
  script_require_ports("installed_sw/H2O");

  exit(0);
}

include('vcf.inc');

var app_name = 'H2O';
var app_info = vcf::get_app_info(app:app_name);

report = 'These vulnerabilities remain unfixed and exist in the following locations:\n';

report += '\t Path: ' + app_info.path;
security_report_v4(port:0, severity:SECURITY_HOLE, extra:report);