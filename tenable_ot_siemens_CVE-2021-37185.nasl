#%NASL_MIN_LEVEL 70300
##
# (C) Tenable, Inc.
##

include('deprecated_nasl_level.inc');
include('compat.inc');

if (description)
{
  script_id(500615);
  script_version("1.11");
  script_set_attribute(attribute:"plugin_modification_date", value:"2025/03/10");

  script_cve_id("CVE-2021-37185");
  script_xref(name:"ICSA", value:"22-041-01");

  script_name(english:"Siemens SIMATIC Industrial Products Operation On a Resource After Expiration or Release (CVE-2021-37185)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"A vulnerability has been identified in SIMATIC Drive Controller family
(All versions >= V2.9.2 < V2.9.4), SIMATIC ET 200SP Open Controller
CPU 1515SP PC2 (incl. SIPLUS variants) (All versions >= V21.9 <
V21.9.4), SIMATIC S7-1200 CPU family (incl. SIPLUS variants) (All
versions >= V4.5.0 < V4.5.2), SIMATIC S7-1500 CPU family (incl.
related ET200 CPUs and SIPLUS variants) (All versions >= V2.9.2 <
V2.9.4), SIMATIC S7-1500 Software Controller (All versions >= V21.9 <
V21.9.4), SIMATIC S7-PLCSIM Advanced (All versions >= V4.0 < V4.0
SP1), SIPLUS TIM 1531 IRC (All versions < V2.3.6), TIM 1531 IRC (All
versions < V2.3.6). An unauthenticated attacker could cause a denial-
of-service condition in a PLC when sending specially prepared packets
over port 102/tcp. A restart of the affected device is needed to
restore normal operations.

This plugin only works with Tenable.ot.
Please visit https://www.tenable.com/products/tenable-ot for more information.");
  script_set_attribute(attribute:"see_also", value:"https://cert-portal.siemens.com/productcert/pdf/ssa-838121.pdf");
  script_set_attribute(attribute:"see_also", value:"https://www.cisa.gov/news-events/ics-advisories/icsa-22-041-01");
  script_set_attribute(attribute:"solution", value:
"The following text was originally created by the Cybersecurity and Infrastructure Security Agency (CISA). The original
can be found at CISA.gov.

Siemens is preparing updates and recommends specific countermeasures for products where updates are not, or not yet
available:

- SIMATIC Drive Controller family: Update to v2.9.4 or later version

- SIMATIC ET 200SP Open Controller CPU 1515SP PC2 (incl. SIPLUS variants): Update to v21.9.4 or later version

- SIMATIC S7-1200 CPU family: Update to v4.5.2 or later version
- SIMATIC S7-1500 CPU family: Update to v2.9.4 or later version

- SIMATIC S7-1500 Software Controller: Update to v21.9.4 or later version

- SIMATIC s7-PLCSIM Advanced: Update to v4.0 SP1 or later version

As a general security measure, Siemens strongly recommends protecting network access to devices with appropriate
mechanisms. To operate the devices in a protected IT environment, Siemens recommends configuring the environment
according to Siemensâ€™ operational guidelines for industrial security, and following the recommendations in the product
manuals.

Additional information on industrial security by Siemens can be found at: https://www.siemens.com/industrialsecurity

For more information see Siemens Security Advisory SSA-838121");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:M/Au:N/C:N/I:N/A:C");
  script_set_cvss_temporal_vector("CVSS2#E:U/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:U/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2021-37185");

  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"false");
  script_cwe_id(672);

  script_set_attribute(attribute:"vuln_publication_date", value:"2022/02/09");
  script_set_attribute(attribute:"patch_publication_date", value:"2022/02/09");
  script_set_attribute(attribute:"plugin_publication_date", value:"2022/03/21");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_et_200sp_open_controller_cpu_1515sp_pc2_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-1200_cpu_series_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-1500_cpu_series_firmware");
  script_set_attribute(attribute:"generated_plugin", value:"former");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2022-2025 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/Siemens");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/Siemens');

var asset = tenable_ot::assets::get(vendor:'Siemens');

var vuln_cpes = {
    "cpe:/o:siemens:simatic_et_200sp_open_controller_cpu_1515sp_pc2_firmware" :
        {"versionEndExcluding" : "21.9.4", "versionStartIncluding" : "21.9", "family" : "ET200SP"},
    "cpe:/o:siemens:simatic_s7-1200_cpu_series_firmware" :
        {"versionEndExcluding" : "4.5.2", "versionStartIncluding" : "4.5.0", "family" : "S71200"},
    "cpe:/o:siemens:simatic_s7-1500_cpu_series_firmware" :
        {"versionEndExcluding" : "2.9.4", "versionStartIncluding" : "2.9.2", "family" : "S71500"}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_HOLE);
