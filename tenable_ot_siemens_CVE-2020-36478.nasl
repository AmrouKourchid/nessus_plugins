#%NASL_MIN_LEVEL 80900
##
# (C) Tenable, Inc.
##

include('compat.inc');

if (description)
{
  script_id(501678);
  script_version("1.4");
  script_set_attribute(attribute:"plugin_modification_date", value:"2025/03/10");

  script_cve_id("CVE-2020-36478");
  script_xref(name:"ICSA", value:"21-257-20");

  script_name(english:"Siemens LOGO! CMR and SIMATIC RTU 3000 Improper Certificate Validation (CVE-2020-36478)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"An issue was discovered in Mbed TLS before 2.25.0 (and before 2.16.9
LTS and before 2.7.18 LTS). A NULL algorithm parameters entry looks
identical to an array of REAL (size zero) and thus the certificate is
considered valid. However, if the parameters do not match in any way,
then the certificate should be considered invalid.

This plugin only works with Tenable.ot.
Please visit https://www.tenable.com/products/tenable-ot for more information.");
  script_set_attribute(attribute:"see_also", value:"https://github.com/ARMmbed/mbedtls/releases/tag/v2.16.9");
  script_set_attribute(attribute:"see_also", value:"https://github.com/ARMmbed/mbedtls/releases/tag/v2.25.0");
  script_set_attribute(attribute:"see_also", value:"https://github.com/ARMmbed/mbedtls/issues/3629");
  script_set_attribute(attribute:"see_also", value:"https://github.com/ARMmbed/mbedtls/releases/tag/v2.7.18");
  script_set_attribute(attribute:"see_also", value:"https://cert-portal.siemens.com/productcert/pdf/ssa-756638.pdf");
  script_set_attribute(attribute:"see_also", value:"https://lists.debian.org/debian-lts-announce/2021/11/msg00021.html");
  script_set_attribute(attribute:"see_also", value:"https://lists.debian.org/debian-lts-announce/2022/12/msg00036.html");
  script_set_attribute(attribute:"see_also", value:"https://www.cisa.gov/news-events/ics-advisories/icsa-21-257-20");
  script_set_attribute(attribute:"solution", value:
"The following text was originally created by the Cybersecurity and Infrastructure Security Agency (CISA). The original
can be found at CISA.gov.

For LOGO! CMR2020, Siemens recommends affected users update to v2.2 or later.

For LOGO! CMR2040, Siemens recommends affected users update to v2.2 or later.

For the SIMATIC RTU 3000 family, Siemens recommends affected users use the certificate projection feature to pin the
valid certificates of external servers providing services to the RTU/CMR devices. Refer to the product manual for
further information.");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:L/Au:N/C:N/I:P/A:N");
  script_set_cvss_temporal_vector("CVSS2#E:POC/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:N");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:P/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2020-36478");

  script_set_attribute(attribute:"exploitability_ease", value:"Exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"true");
  script_cwe_id(295);

  script_set_attribute(attribute:"vuln_publication_date", value:"2021/08/23");
  script_set_attribute(attribute:"patch_publication_date", value:"2021/08/23");
  script_set_attribute(attribute:"plugin_publication_date", value:"2023/09/21");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:logo%21_cmr2020_firmware:2.2");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:logo%21_cmr2040_firmware:2.2");
  script_set_attribute(attribute:"generated_plugin", value:"former");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2023-2025 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/Siemens");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/Siemens');

var asset = tenable_ot::assets::get(vendor:'Siemens');

var vuln_cpes = {
    "cpe:/o:siemens:logo%21_cmr2020_firmware:2.2" :
        {"versionEndExcluding" : "2.2", "family" : "LOGO!CM", "orderNumbers" : ['6GK7142-7BX00-0AX0']},
    "cpe:/o:siemens:logo%21_cmr2040_firmware:2.2" :
        {"versionEndExcluding" : "2.2", "family" : "LOGO!CM", "orderNumbers" : ['6GK7142-7EX00-0AX0']}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_WARNING);
