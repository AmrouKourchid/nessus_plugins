#%NASL_MIN_LEVEL 80900
##
# (C) Tenable, Inc.
##

include('compat.inc');

if (description)
{
  script_id(502651);
  script_version("1.4");
  script_set_attribute(attribute:"plugin_modification_date", value:"2024/12/12");

  script_cve_id("CVE-2024-46886");
  script_xref(name:"ICSA", value:"24-284-01");

  script_name(english:"Siemens SIMATIC S7-1500 and S7-1200 CPUs URL Redirection to Untrusted Site (CVE-2024-46886)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"The web server of affected devices does not properly validate input
that is used for a user redirection. This could allow an attacker to
make the server redirect the legitimate user to an attacker-chosen
URL. For a successful exploit, the legitimate user must actively click
on an attacker-crafted link.

This plugin only works with Tenable.ot.
Please visit https://www.tenable.com/products/tenable-ot for more information.");
  script_set_attribute(attribute:"see_also", value:"https://cert-portal.siemens.com/productcert/html/ssa-876787.html");
  script_set_attribute(attribute:"see_also", value:"https://www.cisa.gov/news-events/ics-advisories/icsa-24-284-01");
  script_set_attribute(attribute:"solution", value:
"The following text was originally created by the Cybersecurity and Infrastructure Security Agency (CISA). The original
can be found at CISA.gov.

Siemens has released new versions for several affected products and recommends users update to the latest versions.
Siemens is preparing further fix versions and recommends specific countermeasures for products where fixes are not, or
not yet available:

- SIMATIC Drive Controller CPU: Update to V3.1.4 or later version

Siemens has identified the following specific workarounds and mitigations users can apply to reduce risk:

- All affected products: Do not click on links from unknown sources.

As a general security measure, Siemens recommends protecting network access to devices with appropriate mechanisms. To
operate the devices in a protected IT environment, Siemens recommends configuring the environment according to Siemens'
operational guidelines for industrial security and following recommendations in the product manuals.

Additional information on industrial security by Siemens can be found on the Siemens industrial security webpage

For more information see the associated Siemens security advisory SSA-876787 in HTML and CSAF.");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:C/C:N/I:L/A:N");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:P/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2024-46886");

  script_set_attribute(attribute:"exploitability_ease", value:"Exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"true");
  script_cwe_id(601);

  script_set_attribute(attribute:"vuln_publication_date", value:"2024/10/08");
  script_set_attribute(attribute:"patch_publication_date", value:"2024/10/08");
  script_set_attribute(attribute:"plugin_publication_date", value:"2024/10/22");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_drive_controller_cpu_firmware:3.1.4");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_et_200sp_open_controller_cpu_1515sp_pc2_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-1200_cpu_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-1500_cpu_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-1500_cpu_firmware:3.1.4");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-1500_et_200pro_cpu_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siplus_et_200sp_cpu_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siplus_s7-1200_cpu_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siplus_s7-1500_cpu_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siplus_s7-1500_cpu_firmware:3.1.4");
  script_set_attribute(attribute:"generated_plugin", value:"former");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2024 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/Siemens");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/Siemens');

var asset = tenable_ot::assets::get(vendor:'Siemens');

var vuln_cpes = {
    "cpe:/o:siemens:simatic_et_200sp_open_controller_cpu_1515sp_pc2_firmware" :
        {"family" : "ET200SP"},
    "cpe:/o:siemens:simatic_s7-1200_cpu_firmware" :
        {"family" : "S71200", "orderNumbers" : ['6ES7211-1AE40-0XB0', '6ES7214-1AG40-0XB0', '6ES7212-1HE40-0XB0', '6ES7215-1HF40-0XB0', '6ES7214-1HF40-0XB0', '6ES7215-1AG40-0XB0', '6ES7214-1BG40-0XB0', '6ES7211-1BE40-0XB0', '6ES7217-1AG40-0XB0', '6ES7212-1AE40-0XB0', '6ES7214-1AF40-0XB0', '6ES7212-1AF40-0XB0', '6ES7212-1HF40-0XB0', '6ES7211-1HE40-0XB0', '6ES7212-1BE40-0XB0', '6ES7215-1HG40-0XB0', '6ES7215-1AF40-0XB0', '6ES7214-1HG40-0XB0', '6ES7215-1BG40-0XB0']},
    "cpe:/o:siemens:simatic_s7-1500_cpu_firmware" :
        {"family" : "S71500", "orderNumbers" : ['6ES7513-1FL01-0AB0', '6ES7515-2FM02-0AB0', '6ES7516-3AN02-0AB0', '6ES7510-1DJ01-0AB0', '6ES7512-1DK01-0AB0', '6ES7515-2UM01-0AB0', '6ES7511-1TK01-0AB0', '6ES7511-1AK02-0AB0', '6ES7516-3FN02-0AB0', '6ES7515-2AM01-0AB0', '6ES7510-1SJ01-0AB0', '6ES7516-3AN01-0AB0', '6ES7515-2TM01-0AB0', '6ES7511-1UK01-0AB0', '6ES7512-1SK01-0AB0', '6ES7516-3FN01-0AB0', '6ES7511-1FK02-0AB0', '6ES7515-2FM01-0AB0', '6ES7518-4AP00-3AB0', '6ES7511-1AK01-0AB0', '6ES7512-1CK01-0AB0', '6ES7515-2AM02-0AB0', '6ES7511-1FK01-0AB0', '6ES7518-4FP00-3AB0', '6ES7513-1AL02-0AB0', '6ES7511-1CK01-0AB0', '6ES7513-1AL01-0AB0', '6ES7512-1CK00-0AB0', '6ES7513-1FL02-0AB0', '6ES7511-1CK00-0AB0']},
    "cpe:/o:siemens:simatic_s7-1500_et_200pro_cpu_firmware" :
        {"family" : "ET200", "orderNumbers" : ['6ES7513-2GL00-0AB0', '6ES7516-2GN00-0AB0', '6ES7516-2PN00-0AB0', '6ES7513-2PL00-0AB0']},
    "cpe:/o:siemens:siplus_et_200sp_cpu_firmware" :
        {"family" : "ET200", "orderNumbers" : ['6AG1510-1SJ01-2AB0', '6AG1512-1DK01-7AB0', '6AG2512-1DK01-4AB0', '6AG1510-1DJ01-7AB0', '6AG2512-1SK01-4AB0', '6AG2510-1DJ01-1AB0', '6AG2512-1SK01-1AB0', '6AG2510-1DJ01-4AB0', '6AG2510-1SJ01-1AB0', '6AG1510-1DJ01-2AB0', '6AG1512-1SK01-2AB0', '6AG2512-1DK01-1AB0', '6AG1512-1DK01-2AB0', '6AG1512-1SK01-7AB0']},
    "cpe:/o:siemens:siplus_s7-1200_cpu_firmware" :
        {"family" : "S71200", "orderNumbers" : ['6AG1214-1HG40-5XB0', '6AG1214-1BG40-5XB0', '6AG1214-1BG40-2XB0', '6AG1212-1BE40-4XB0', '6AG1215-1HG40-4XB0', '6AG2214-1AG40-1XB0', '6AG1212-1BE40-2XB0', '6AG1214-1AF40-5XB0', '6AG1215-1BG40-2XB0', '6AG1215-1AG40-2XB0', '6AG1212-1AE40-2XB0', '6AG1214-1AG40-4XB0', '6AG1214-1AG40-2XB0', '6AG1215-1BG40-4XB0', '6AG1215-1BG40-5XB0', '6AG1215-1AG40-4XB0', '6AG1215-1HG40-2XB0', '6AG1212-1AE40-4XB0', '6AG2212-1AE40-1XB0', '6AG1214-1AG40-5XB0', '6AG1215-1HG40-5XB0', '6AG1214-1HG40-2XB0', '6AG1214-1HF40-5XB0', '6AG1215-1AG40-5XB0', '6AG1214-1BG40-4XB0', '6AG1215-1AF40-5XB0', '6AG1212-1HE40-4XB0', '6AG1212-1HE40-2XB0', '6AG1214-1HG40-4XB0']},
    "cpe:/o:siemens:siplus_s7-1500_cpu_firmware" :
        {"family" : "S71500", "orderNumbers" : ['6AG1515-2FM01-2AB0', '6AG2516-3AN01-4AB0', '6AG1511-1AK02-2AB0', '6AG2516-3FN02-4AB0', '6AG1516-3AN01-2AB0', '6AG1513-1AL02-7AB0', '6AG1516-3AN01-7AB0', '6AG1511-1AK01-2AB0', '6AG1513-1FL01-2AB0', '6AG1516-3FN02-2AB0', '6AG1516-3AN02-2AB0', '6AG2511-1AK01-4AB0', '6AG2511-1AK01-1AB0', '6AG2511-1AK02-1AB0', '6AG1511-1AK02-7AB0', '6AG1511-1FK01-2AB0', '6AG1511-1AK01-7AB0', '6AG1516-3FN01-2AB0', '6AG2511-1AK02-4AB0', '6AG2516-3FN02-2AB0', '6AG1511-1FK02-2AB0', '6AG2515-2FM01-2AB0', '6AG1513-1FL02-2AB0', '6AG2515-2FM02-4AB0', '6AG2516-3AN02-4AB0', '6AG1513-1AL02-2AB0', '6AG1515-2FM02-2AB0', '6AG1513-1AL01-7AB0', '6AG1513-1AL01-2AB0', '6AG2515-2RM00-4AB0', '6AG1516-3AN02-7AB0']},
    "cpe:/o:siemens:simatic_s7-1500_cpu_firmware:3.1.4" :
        {"versionEndExcluding" : "3.1.4", "family" : "S71500", "orderNumbers" : ['6ES7514-2WN03-0AB0', '6ES7515-2AN03-0AB0', '6ES7518-4AP00-0AB0', '6ES7512-1DM03-0AB0', '6ES7518-4AX00-1AC0', '6ES7517-3FP01-0AB0', '6ES7510-1SK03-0AB0', '6ES7513-2GM03-0AB0', '6ES7516-3UN00-0AB0', '6ES7516-3FP03-0AB0', '6ES7518-4UP00-0AB0', '6ES7516-2PP03-0AB0', '6ES7516-3AP03-0AB0', '6ES7518-4FP00-0AB0', '6ES7513-2PM03-0AB0', '6ES7518-4FX00-1AB0', '6ES7516-3TN00-0AB0', '6ES7514-2DN03-0AB0', '6ES7513-1AM03-0AB0', '6ES7511-1AL03-0AB0', '6ES7513-1FM03-0AB0', '6ES7516-2GP03-0AB0', '6ES7512-1SM03-0AB0', '6ES7510-1DK03-0AB0', '6ES7517-3TP00-0AB0', '6ES7512-1CM03-0AB0', '6ES7518-4AX00-1AB0', '6ES7511-1CL03-0AB0', '6ES7515-2FN03-0AB0', '6ES7518-4TP00-0AB0', '6ES7511-1FL03-0AB0', '6ES7517-3FP00-0AB0', '6ES7511-1UL03-0AB0', '6ES7518-4FX00-1AC0', '6ES7514-2VN03-0AB0', '6ES7514-2SN03-0AB0', '6ES7515-2UN03-0AB0', '6ES7511-1TL03-0AB0', '6ES7517-3AP00-0AB0', '6ES7517-3UP00-0AB0', '6ES7515-2TN03-0AB0']},
    "cpe:/o:siemens:siplus_s7-1500_cpu_firmware:3.1.4" :
        {"versionEndExcluding" : "3.1.4", "family" : "S71500", "orderNumbers" : ['6AG1518-4AP00-4AB0', '6AG1518-4AX00-4AC0', '6AG1518-4FP00-4AB0']},
    "cpe:/o:siemens:simatic_drive_controller_cpu_firmware:3.1.4" :
        {"versionEndExcluding" : "3.1.4", "family" : "S71500", "orderNumbers" : ['6ES7615-4DF10-0AB0', '6ES7615-7DF10-0AB0']}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_WARNING);
