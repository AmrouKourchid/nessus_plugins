#%NASL_MIN_LEVEL 80900
##
# (C) Tenable, Inc.
##

include('compat.inc');

if (description)
{
  script_id(501264);
  script_version("1.12");
  script_set_attribute(attribute:"plugin_modification_date", value:"2024/09/04");

  script_cve_id("CVE-2019-1649");
  script_xref(name:"ICSA", value:"20-072-03");

  script_name(english:"Rockwell Automation Allen-Bradley Stratix 5950 Improper Access Control (CVE-2019-1649)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"A vulnerability in the logic that handles access control to one of the
hardware components in Cisco's proprietary Secure Boot implementation
could allow an authenticated, local attacker to write a modified
firmware image to the component. This vulnerability affects multiple
Cisco products that support hardware-based Secure Boot functionality.
The vulnerability is due to an improper check on the area of code that
manages on-premise updates to a Field Programmable Gate Array (FPGA)
part of the Secure Boot hardware implementation. An attacker with
elevated privileges and access to the underlying operating system that
is running on the affected device could exploit this vulnerability by
writing a modified firmware image to the FPGA. A successful exploit
could either cause the device to become unusable (and require a
hardware replacement) or allow tampering with the Secure Boot
verification process, which under some circumstances may allow the
attacker to install and boot a malicious software image. An attacker
will need to fulfill all the following conditions to attempt to
exploit this vulnerability: Have privileged administrative access to
the device. Be able to access the underlying operating system running
on the device; this can be achieved either by using a supported,
documented mechanism or by exploiting another vulnerability that would
provide an attacker with such access. Develop or have access to a
platform-specific exploit. An attacker attempting to exploit this
vulnerability across multiple affected platforms would need to
research each one of those platforms and then develop a platform-
specific exploit. Although the research process could be reused across
different platforms, an exploit developed for a given hardware
platform is unlikely to work on a different hardware platform.

This plugin only works with Tenable.ot.
Please visit https://www.tenable.com/products/tenable-ot for more information.");
  # https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-20190513-secureboot
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?e13bd4a7");
  script_set_attribute(attribute:"see_also", value:"https://www.kb.cert.org/vuls/id/400865");
  script_set_attribute(attribute:"see_also", value:"http://www.securityfocus.com/bid/108350");
  script_set_attribute(attribute:"see_also", value:"https://www.us-cert.gov/ics/advisories/icsa-20-072-03");
  script_set_attribute(attribute:"solution", value:
"The following text was originally created by the Cybersecurity and Infrastructure Security Agency (CISA). The original
can be found at CISA.gov.

Rockwell Automation recommends users update to firmware version FRN v6.4.0, which addresses the reported vulnerability.

Rockwell also provides the following general security guidelines:

- Utilize proper network infrastructure controls, such as firewalls, to help ensure that requests from unauthorized
sources are blocked and the controls are isolated from the business network.
- Consult the product documentation for specific features, such as access control lists and deep packet inspection, that
may be used to block unauthorized changes, etc.
- Block all traffic to EtherNet/IP or other CIP protocol-based devices from outside the manufacturing zone by blocking
or restricting access to TCP and UDP Port 2222 and Port 44818, using proper network infrastructure controls such as
firewalls, UTM devices, or other security appliances. For more information on TCP/UDP ports used by Rockwell Automation
products, see Knowledgebase Article ID 898270.
- Minimize network exposure for all control system devices and/or systems, and ensure that they are not accessible from
the Internet.");
  script_set_cvss_base_vector("CVSS2#AV:L/AC:L/Au:N/C:C/I:C/A:C");
  script_set_cvss_temporal_vector("CVSS2#E:POC/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:L/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:P/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2019-1649");

  script_set_attribute(attribute:"exploitability_ease", value:"Exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"true");
  script_cwe_id(667);

  script_set_attribute(attribute:"vuln_publication_date", value:"2019/05/13");
  script_set_attribute(attribute:"patch_publication_date", value:"2019/05/13");
  script_set_attribute(attribute:"plugin_publication_date", value:"2023/07/25");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:cisco:nx-os:8");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:cisco:nx-os:9");
  script_set_attribute(attribute:"generated_plugin", value:"former");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2023-2024 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/Cisco");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/Cisco');

var asset = tenable_ot::assets::get(vendor:'Cisco');

var vuln_cpes = {
    "cpe:/o:cisco:nx-os:8.4.1" :
        {"versionEndExcluding" : "8.4.1", "family" : "NXOS"},
    "cpe:/o:cisco:nx-os:9.3%282%29" :
        {"versionEndExcluding" : "9.3%282%29", "family" : "NXOS"}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_HOLE);
