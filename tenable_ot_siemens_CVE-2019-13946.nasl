#%NASL_MIN_LEVEL 70300
##
# (C) Tenable, Inc.
##

include('deprecated_nasl_level.inc');
include('compat.inc');

if (description)
{
  script_id(500356);
  script_version("1.13");
  script_set_attribute(attribute:"plugin_modification_date", value:"2024/09/04");

  script_cve_id("CVE-2019-13946");
  script_xref(name:"ICSA", value:"20-042-04");

  script_name(english:"Siemens PROFINET-IO Stack Uncontrolled Resource Consumption (CVE-2019-13946)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"Profinet-IO (PNIO) stack versions prior V06.00 do not properly limit
internal resource allocation when multiple legitimate diagnostic
package requests are sent to the DCE-RPC interface. This could lead to
a denial of service condition due to lack of memory for devices that
include a vulnerable version of the stack. The security vulnerability
could be exploited by an attacker with network access to an affected
device. Successful exploitation requires no system privileges and no
user interaction. An attacker could use the vulnerability to
compromise the availability of the device.

This plugin only works with Tenable.ot.
Please visit https://www.tenable.com/products/tenable-ot for more information.");
  script_set_attribute(attribute:"see_also", value:"https://cert-portal.siemens.com/productcert/pdf/ssa-780073.pdf");
  script_set_attribute(attribute:"see_also", value:"https://www.cisa.gov/news-events/ics-advisories/icsa-20-042-04");
  script_set_attribute(attribute:"solution", value:
"The following text was originally created by the Cybersecurity and Infrastructure Security Agency (CISA). The original
can be found at CISA.gov.

Siemens has released updates for several affected products and recommends users update to the new version. Siemens is
preparing further updates and recommends specific countermeasures until patches are available.

- SCALANCE X-200 switch family (incl. SIPLUS NET variants), All versions prior to v5.2.5: Update to v5.2.5 or later
version
- SCALANCE XB-200, All versions prior to v3.0: Update to v4.1
- SCALANCE XC-200, All versions prior to v3.0: Update to v4.1
- SCALANCE XP-200, All versions prior to v3.0: Update to v4.1
- SCALANCE XF-200BA, All versions prior to v3.0: Update to v4.1
- SCALANCE XR-300WG, All versions prior to v3.0: Update to v4.1
- SCALANCE M-800, All versions prior to v4.3: Update to v6.1.2
- SCALANCE S615, All versions prior to v4.3: Update to v6.1.2
- Development/Evaluation Kits for PROFINET IO: EK-ERTEC 200: Update to v4.5 Patch 01 
- Development/Evaluation Kits for PROFINET IO: EK-ERTEC 200P: Update to v4.6
- PROFINET Driver for Controller: Update to v2.1 Patch 03
- SCALANCE M-800 / S615: Update to v6.1.2
- SCALANCE W700 IEEE 802.11n: Update to v6.4
- SCALANCE X-200IRT switch family: Update to v5.4.2
- SCALANCE XB-200, XC-200, XP-200, XF-200BA and XR-300WG: Update to v4.1
- SCALANCE XM-400 switch family: Update to v6.2.3
- SCALANCE XR-500 switch family: Update to v6.2.3
- SIMATIC CP 1616 and CP 1604: Update to v2.8.1
- SIMATIC ET200MP IM155-5 PN HF: Update to v4.2.0
- SIMATIC ET200MP IM155-5 PN ST: Update to v4.1.0
- SIMATIC ET200SP IM155-6 PN HF: Update to v4.2.2
- SIMATIC ET200SP IM155-6 PN ST: pdate to v4.1.0
- SIMATIC RF600 family: Update to v3.2.1
- SINAMICS DCP: Update to v1.3
- SCALANCE X-300 switch family (incl. X408 and SIPLUS NET variants): Update to v4.1.4 or later

- SIMATIC NET CP 443-1 Advanced (incl. SIPLUS variants): Currently no fix planned
- SIMATIC NET CP 443-1 (incl. SIPLUS variants): Currently no fix planned
- SIMATIC NET CP 443-1 OPC UA: Currently no fix planned

Siemens has identified the following specific workarounds and mitigations users can apply to reduce the risk:

- Block incoming DCE-RPC packets (port 34964/UDP) from untrusted networks 
- SCALANCE M-800 / S615 and RUGGEDCOM RM1224: Create a firewall rule that blocks the PROFINET Context Manager Port
(34964/UDP)
- Disable PROFINET in products, where PROFINET is optional and not used in your environment

As a general security measure, Siemens strongly recommends users protect network access to devices with appropriate
mechanisms. In order to operate the devices in a protected IT environment, Siemens recommends users configure the
environment according to Siemensâ€™ operational guidelines for Industrial Security, and follow the recommendations in the
product manuals.

Additional information on industrial security by Siemens can be found on the Siemens industrial security webpage.

For more information, please see Siemens security advisory: SSA-780073");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:L/Au:N/C:N/I:N/A:C");
  script_set_cvss_temporal_vector("CVSS2#E:U/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:U/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2019-13946");

  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"false");
  script_cwe_id(400);

  script_set_attribute(attribute:"vuln_publication_date", value:"2020/02/11");
  script_set_attribute(attribute:"patch_publication_date", value:"2020/02/11");
  script_set_attribute(attribute:"plugin_publication_date", value:"2022/02/07");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:ruggedcom_rm1224_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_m-800_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_s615_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_w700_ieee_802.11n_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_x-200_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_x-200irt_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_x-300_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_x-400_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_xb-200_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_xc-200_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_xf-200_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_xf-200ba_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_xm-400_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_xp-200_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_xr-300_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_xr-300wg_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_xr524_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_xr526_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_xr528_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_xr552_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_cp_343-1_advanced_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_cp_343-1_erpc_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_cp_343-1_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_cp_343-1_lean_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_cp_443-1_advanced_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_cp_443-1_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_cp_443-1_opc_ua_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_et200al_im_157-1_pn_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_et200ecopn_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_et200m_im153-4_pn_io_hf_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_et200m_im153-4_pn_io_st_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_et200mp_im155-5_pn_hf_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_et200mp_im155-5_pn_st_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_et200pro_im154-3_pn_hf_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_et200pro_im154-4_pn_hf_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_et200s_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_et200sp_im155-6_pn_basic_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_et200sp_im155-6_pn_hf_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_et200sp_im155-6_pn_st_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_cp_1616_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_cp_1604_firmware");
  script_set_attribute(attribute:"generated_plugin", value:"former");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2022-2024 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/Siemens");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/Siemens');

var asset = tenable_ot::assets::get(vendor:'Siemens');

var vuln_cpes = {
    "cpe:/o:siemens:ruggedcom_rm1224_firmware" :
        {"versionEndExcluding" : "4.3", "family" : "RuggedCom"},
    "cpe:/o:siemens:scalance_m-800_firmware" :
        {"versionEndExcluding" : "4.3", "family" : "SCALANCEM", "orderNumbers" : ["6GK5804-0AP00-2AA2", "6GK5812-1AA00-2AA2", "6GK5812-1BA00-2AA2", "6GK5816-1AA00-2AA2", "6GK5816-1BA00-2AA2", "6GK5826-2AB00-2AB2", "6GK5874-2AA00-2AA2", "6GK5874-3AA00-2AA2", "6GK5876-3AA02-2BA2", "6GK5876-3AA02-2EA2", "6GK5876-4AA00-2BA2", "6GK5876-4AA00-2DA2"]},
    "cpe:/o:siemens:scalance_s615_firmware" :
        {"versionEndExcluding" : "4.3", "family" : "SCALANCES", "orderNumbers" : ["6GK5615-0AA00-2AA2"]},
    "cpe:/o:siemens:scalance_w700_ieee_802.11n_firmware" :
        {"versionEndIncluding" : "6.0.1", "family" : "SCALANCEW"},
    "cpe:/o:siemens:scalance_xc-200_firmware" :
        {"versionEndIncluding" : "3.0", "family" : "SCALANCEX200"},
    "cpe:/o:siemens:scalance_xp-200_firmware" :
        {"versionEndIncluding" : "3.0", "family" : "SCALANCEX200"},
    "cpe:/o:siemens:scalance_xb-200_firmware" :
        {"versionEndIncluding" : "3.0", "family" : "SCALANCEX200"},
    "cpe:/o:siemens:scalance_x-200_firmware" :
        {"versionEndIncluding" : "5.2.5", "family" : "SCALANCEX200", "orderNumbers" : ["6GK5204-2BB10-2AA3", "6GK5204-2BB11-2AA3", "6GK5204-2BC10-2AA3", "6GK5204-2BC10-2CA2", "6GK5204-2BB10-2CA2", "6GK5206-1BB10-2AA3", "6GK5206-1BC10-2AA3", "6GK5208-0BA10-2AA3", "6GK5208-0HA10-2AA6", "6GK5212-2BB00-2AA3", "6GK5212-2BC00-2AA3", "6GK5216-0BA00-2AA3", "6GK5224-0BA00-2AA3"]},
    "cpe:/o:siemens:scalance_x-200irt_firmware" :
        {"versionEndExcluding" : "5.3", "family" : "SCALANCEX200IRT", "orderNumbers" : ["6GK5200-4AH00-2BA3","6GK5201-3BH00-2BA3","6GK5201-3JR00-2BA6","6GK5202-2BB00-2BA3","6GK5202-2BH00-2BA3","6GK5202-2JR00-2BA6", "6GK5204-0BA00-2BA3", "6GK5204-0JA00-2BA6"]},
    "cpe:/o:siemens:scalance_xr-300_firmware" :
        {"versionEndExcluding" : "4.1.4", "family" : "SCALANCEX300", "orderNumbers" : ["6GK5324-4GG00-2ER2","6GK5324-4GG10-2ER2","6GK5324-4GG00-2JR2","6GK5324-4GG10-2JR2","6GK5324-4GG00-4ER2","6GK5324-4GG10-4ER2","6GK5324-4GG00-4JR2","6GK5324-4GG10-4JR2","6GK5324-4GG00-1ER2","6GK5324-4GG10-1ER2","6GK5324-4GG00-1JR2","6GK5324-4GG10-1JR2","6GK5324-4GG00-3ER2","6GK5324-4GG10-3ER2","6GK5324-4GG00-3JR2","6GK5324-4GG10-3JR2","6GK5324-4QG00-1AR2","6GK5324-4QG00-1HR2","6GK5324-4QG00-3AR2","6GK5324-4QG00-3HR2","6GK5324-4QG00-1CR2","6GK5324-0GG00-1AR2","6GK5324-0GG10-1AR2","6GK5324-0GG00-1HR2","6GK5324-0GG10-1HR2","6GK5324-0GG00-3AR2","6GK5324-0GG10-3AR2","6GK5324-0GG00-3HR2","6GK5324-0GG10-3HR2","6GK5324-0GG00-1CR2","6GK5324-0GG10-1CR2"]},
    "cpe:/o:siemens:scalance_xr-300wg_firmware" :
        {"versionEndExcluding" : "3.0", "family" : "SCALANCEX300"},
    "cpe:/o:siemens:scalance_x-300_firmware" :
        {"versionEndExcluding" : "4.1.4", "family" : "SCALANCEX300", "orderNumbers" : ["6AG1308-2FL10-4AA3","6GK5302-7GD00-2EA3", "6GK5302-7GD00-2GA3", "6GK5302-7GD00-4EA3", "6GK5302-7GD00-4GA3", "6GK5302-7GD00-1EA3", "6GK5302-7GD00-1GA3", "6GK5302-7GD00-3EA3", "6GK5302-7GD00-3GA3", "6GK5304-2BD00-2AA3", "6GK5306-1BF00-2AA3", "6GK5307-2FD00-2EA3", "6GK5307-2FD00-2GA3", "6GK5307-2FD00-4EA3", "6GK5307-2FD00-4GA3", "6GK5307-2FD00-1EA3", "6GK5307-2FD00-1GA3", "6GK5307-2FD00-3EA3", "6GK5307-2FD00-3GA3", "6GK5307-3BL00-2AA3", "6GK5307-3BL10-2AA3", "6GK5307-3BM00-2AA3", "6GK5307-3BM10-2AA3", "6GK5308-2FL00-2AA3", "6GK5308-2FL10-2AA3", "6GK5308-2FM00-2AA3", "6GK5308-2FM10-2AA3", "6GK5308-2FN00-2AA3", "6GK5308-2FN10-2AA3", "6GK5308-2FP00-2AA3", "6GK5308-2FP10-2AA3", "6GK5308-2GG00-2AA2", "6GK5308-2GG10-2AA2", "6GK5308-2QG00-2AA2", "6GK5308-2QG10-2AA2", "6GK5308-2GG00-2CA2", "6GK5308-2GG10-2CA2", "6GK5310-0FA00-2AA3", "6GK5310-0FA10-2AA3", "6GK5310-0BA00-2AA3", "6GK5310-0BA10-2AA3", "6GK5320-1BD00-2AA3", "6GK5320-3BF00-2AA3"]},
    "cpe:/o:siemens:scalance_xf-200_firmware" :
        {"versionEndExcluding" : "3.0", "family" : "SCALANCEX200", "orderNumbers" : ["6GK5201-3BH00-2BD2","6GK5202-2BH00-2BD2","6GK5204-0BA00-2AF2","6GK5204-2BC00-2AF2","6GK5204-2AA00-2BD2","6GK5204-0BA00-2BF2","6GK5206-1BC00-2AF2","6GK5208-0BA00-2AF2"]},
    "cpe:/o:siemens:scalance_xf-200ba_firmware" :
        {"versionEndExcluding" : "3.0", "family" : "SCALANCEX200"},
    "cpe:/o:siemens:scalance_x-400_firmware" :
        {"versionEndExcluding" : "6.0", "family" : "SCALANCEX400", "orderNumbers" : ["6GK5408-2FD00-2AA2"]},
    "cpe:/o:siemens:scalance_xm-400_firmware" :
        {"versionEndExcluding" : "6.0", "family" : "SCALANCEX400"},
    "cpe:/o:siemens:scalance_xr524_firmware" :
        {"versionEndExcluding" : "6.0", "family" : "SCALANCEX500"},
    "cpe:/o:siemens:scalance_xr526_firmware" :
        {"versionEndExcluding" : "6.0", "family" : "SCALANCEX500"},
    "cpe:/o:siemens:scalance_xr528_firmware" :
        {"versionEndExcluding" : "6.0", "family" : "SCALANCEX500"},
    "cpe:/o:siemens:scalance_xr552_firmware" :
        {"versionEndExcluding" : "6.0", "family" : "SCALANCEX500"},
    "cpe:/o:siemens:simatic_cp_343-1_firmware" :
        {"family" : "S7300", "orderNumbers" : ["6GK7343-1EX30-0XE0", "6AG1343-1EX30-7XE0"]},
    "cpe:/o:siemens:simatic_cp_343-1_advanced_firmware" :
        {"family" : "S7300", "orderNumbers" : ["6GK7343-1GX31-0XE0", "6AG1343-1GX31-4XE0"]},
    "cpe:/o:siemens:simatic_cp_343-1_erpc_firmware" :
        {"family" : "S7300", "orderNumbers" : ["6GK7343-1FX00-0XE0"]},
    "cpe:/o:siemens:simatic_cp_343-1_lean_firmware" :
        {"family" : "S7300", "orderNumbers" : ["6GK7343-1CX10-0XE0", "6AG1343-1CX10-2XE0"]},
    "cpe:/o:siemens:simatic_cp_443-1_firmware" :
        {"versionEndExcluding" : "3.3", "family" : "S7400", "orderNumbers" : ["6GK7443-1EX30-0XE0", "6GK7443-1EX30-0XE1", "6AG1443-1EX30-4XE0"]},
    "cpe:/o:siemens:simatic_cp_443-1_advanced_firmware" :
        {"versionEndExcluding" : "3.3", "family" : "S7400", "orderNumbers" : ["6GK7443-1GX30-0XE0", "6AG1443-1GX30-4XE0"]},
    "cpe:/o:siemens:simatic_cp_443-1_opc_ua_firmware" :
        {"family" : "S7400", "orderNumbers" : ["6GK7443-1UX00-0XE0"]},
    "cpe:/o:siemens:simatic_et200al_im_157-1_pn_firmware" :
        {"family" : "ET200"},
    "cpe:/o:siemens:simatic_et200m_im153-4_pn_io_hf_firmware" :
        {"family" : "ET200M"},
    "cpe:/o:siemens:simatic_et200m_im153-4_pn_io_st_firmware" :
        {"family" : "ET200M"},
    "cpe:/o:siemens:simatic_et200mp_im155-5_pn_hf_firmware" :
        {"versionEndExcluding" : "4.2.0", "family" : "ET200"},
    "cpe:/o:siemens:simatic_et200mp_im155-5_pn_st_firmware" :
        {"versionEndExcluding" : "4.1.0", "family" : "ET200"},
    "cpe:/o:siemens:simatic_et200s_firmware" :
        {"family" : "ET200"},
    "cpe:/o:siemens:simatic_et200sp_im155-6_pn_basic_firmware" :
        {"family" : "ET200SP"},
    "cpe:/o:siemens:simatic_et200sp_im155-6_pn_hf_firmware" :
        {"versionEndExcluding" : "3.3.1", "family" : "ET200SP"},
    "cpe:/o:siemens:simatic_et200sp_im155-6_pn_st_firmware" :
        {"versionEndExcluding" : "4.1.0", "family" : "ET200SP"},
    "cpe:/o:siemens:simatic_et200ecopn_firmware" :
        {"family" : "ET200", "orderNumbers" : ["6ES7145-6HD00-0AB0", "6ES7147-6BG00-0AB0", "6ES7142-6BR00-0AB0", "6ES7144-6KD50-0AB0", "6ES7144-6KD00-0AB0", "6ES7141-6BF00-0AB0", "6ES7141-6BG00-0AB0", "6ES7142-6BF50-0AB0", "6ES7142-6BF00-0AB0", "6ES7142-6BG00-0AB0", "6ES7141-6BH00-0AB0", "6ES7142-6BH00-0AB0", "6ES7148-6JA00-0AB0"]},
    "cpe:/o:siemens:simatic_et200pro_im154-3_pn_hf_firmware" :
        {"family" : "ET200"},
    "cpe:/o:siemens:simatic_et200pro_im154-4_pn_hf_firmware" :
        {"family" : "ET200"},
    "cpe:/o:siemens:simatic_cp_1616_firmware" :
        {"versionEndExcluding" : "2.8", "family" : "NETCP1600"},
    "cpe:/o:siemens:simatic_cp_1604_firmware" :
        {"versionEndExcluding" : "2.8", "family" : "NETCP1600"}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_HOLE);
