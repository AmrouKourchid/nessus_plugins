##
# (C) Tenable, Inc.
##

include('compat.inc');

if (description)
{
  script_id(500782);
  script_version("1.9");
  script_set_attribute(attribute:"plugin_modification_date", value:"2024/09/04");

  script_cve_id("CVE-2021-25667");
  script_xref(name:"ICSA", value:"21-068-03");

  script_name(english:"Siemens SCALANCE and RUGGEDCOM Devices Stack-Based Buffer Overflow (CVE-2021-25667)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"A vulnerability has been identified in RUGGEDCOM RM1224 (All versions
>= V4.3 and < V6.4), SCALANCE M-800 (All versions >= V4.3 and < V6.4),
SCALANCE S615 (All versions >= V4.3 and < V6.4), SCALANCE SC-600
Family (All versions >= V2.0 and < V2.1.3), SCALANCE XB-200 (All
versions < V4.1), SCALANCE XC-200 (All versions < V4.1), SCALANCE
XF-200BA (All versions < V4.1), SCALANCE XM400 (All versions < V6.2),
SCALANCE XP-200 (All versions < V4.1), SCALANCE XR-300WG (All versions
< V4.1), SCALANCE XR500 (All versions < V6.2). Affected devices
contain a stack-based buffer overflow vulnerability in the handling of
STP BPDU frames that could allow a remote attacker to trigger a
denial-of-service condition or potentially remote code execution.
Successful exploitation requires the passive listening feature of the
device to be active.

This plugin only works with Tenable.ot.
Please visit https://www.tenable.com/products/tenable-ot for more information.");
  script_set_attribute(attribute:"see_also", value:"https://cert-portal.siemens.com/productcert/pdf/ssa-979775.pdf");
  script_set_attribute(attribute:"see_also", value:"https://us-cert.cisa.gov/ics/advisories/icsa-21-068-03");
  script_set_attribute(attribute:"solution", value:
"The following text was originally created by the Cybersecurity and Infrastructure Security Agency (CISA). The original
can be found at CISA.gov.

Siemens recommends applying updates where applicable:

- SCALANCE SC-600 Family: Update to v2.1.3 or later
- SCALANCE X300WG: Update to v4.1 or later
- SCALANCE XM400: Update to v6.2 or later
- SCALANCE XR500: Update to v6.2 or later

- SCALANCE XB-200: Update to v4.1 or later
- SCALANCE XC-200: Update to v4.1 or later
- SCALANCE XF-200BA: Update to v4.1 or later
- SCALANCE XP-200: Update to v4.1 or later
- RUGGEDCOM RM1224: Update to v6.4 or later
- SCALANCE M-800: Update to v6.4 or later
- SCALANCE S615: Update to v6.4 or later

Siemens has identified the following specific workarounds and mitigations users can apply to reduce the risk:

- Deactivate the STP passive listening feature of the vulnerable devices.

As a general security measure, Siemens strongly recommends protecting network access to devices with appropriate
mechanisms. In order to operate the devices in a protected IT environment, Siemens recommends configuring the
environment according to Siemens operational guidelines for Industrial Security and following the recommendations in the
product manuals.

For additional information, please refer to Siemens Security Advisory SSA-979775");
  script_set_cvss_base_vector("CVSS2#AV:A/AC:L/Au:N/C:P/I:P/A:P");
  script_set_cvss_temporal_vector("CVSS2#E:U/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:A/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:U/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2021-25667");

  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");
  script_cwe_id(121);

  script_set_attribute(attribute:"vuln_publication_date", value:"2021/03/15");
  script_set_attribute(attribute:"patch_publication_date", value:"2021/03/15");
  script_set_attribute(attribute:"plugin_publication_date", value:"2023/04/05");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:ruggedcom_rm1224_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_m-800_series_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_s615_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_sc-600_series_firmware:2");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_x300wg_series_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_xb-200_series_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_xc-200_series_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_xf-200ba_series_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_xm400_series_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_xp-200_series_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:scalance_xr500_series_firmware");
  script_set_attribute(attribute:"generated_plugin", value:"former");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2023-2024 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/Siemens");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/Siemens');

var asset = tenable_ot::assets::get(vendor:'Siemens');

var vuln_cpes = {
    "cpe:/o:siemens:ruggedcom_rm1224_firmware" :
        {"versionEndExcluding" : "6.4", "versionStartIncluding" : "4.3", "family" : "RuggedCom"},
    "cpe:/o:siemens:scalance_m-800_series_firmware" :
        {"versionEndExcluding" : "6.4", "versionStartIncluding" : "4.3", "family" : "SCALANCEM"},
    "cpe:/o:siemens:scalance_s615_firmware" :
        {"versionEndExcluding" : "6.4", "versionStartIncluding" : "4.3", "family" : "SCALANCES"},
    "cpe:/o:siemens:scalance_x300wg_series_firmware" :
        {"versionEndExcluding" : "4.1", "family" : "SCALANCEX300"},
    "cpe:/o:siemens:scalance_xm400_series_firmware" :
        {"versionEndExcluding" : "6.2", "family" : "SCALANCEX400"},
    "cpe:/o:siemens:scalance_xr500_series_firmware" :
        {"versionEndExcluding" : "6.2", "family" : "SCALANCEX500"},
    "cpe:/o:siemens:scalance_sc-600_series_firmware:2" :
        {"versionEndExcluding" : "2.1.3", "versionStartIncluding" : "2.0", "family" : "SCALANCES"},
    "cpe:/o:siemens:scalance_xb-200_series_firmware" :
        {"versionEndExcluding" : "4.1", "family" : "SCALANCEX200"},
    "cpe:/o:siemens:scalance_xc-200_series_firmware" :
        {"versionEndExcluding" : "4.1", "family" : "SCALANCEX200"},
    "cpe:/o:siemens:scalance_xf-200ba_series_firmware" :
        {"versionEndExcluding" : "4.1", "family" : "SCALANCEX200"},
    "cpe:/o:siemens:scalance_xp-200_series_firmware" :
        {"versionEndExcluding" : "4.1", "family" : "SCALANCEX200"}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_WARNING);
