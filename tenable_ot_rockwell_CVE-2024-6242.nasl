#%NASL_MIN_LEVEL 80900
##
# (C) Tenable, Inc.
##

include('compat.inc');

if (description)
{
  script_id(502361);
  script_version("1.5");
  script_set_attribute(attribute:"plugin_modification_date", value:"2024/12/18");

  script_cve_id("CVE-2024-6242");
  script_xref(name:"ICSA", value:"24-214-09");
  script_xref(name:"IAVB", value:"2024-B-0106");

  script_name(english:"Rockwell Automation Logix Controllers Unprotected Alternate Channel (CVE-2024-6242)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"A vulnerability exists in the affected products that allows a threat 
actor to bypass the Trusted Slot feature in a ControlLogix controller.
If exploited on any affected module in a 1756 chassis, a threat actor
could potentially execute CIP commands that modify user projects
and/or device configuration on a Logix controller in the chassis.

This plugin only works with Tenable.ot.
Please visit https://www.tenable.com/products/tenable-ot for more information.");
  # https://www.rockwellautomation.com/en-us/trust-center/security-advisories/advisory.SD1682.html
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?97871567");
  script_set_attribute(attribute:"see_also", value:"https://www.cisa.gov/news-events/ics-advisories/icsa-24-214-09");
  script_set_attribute(attribute:"solution", value:
"The following text was originally created by the Cybersecurity and Infrastructure Security Agency (CISA). The original
can be found at CISA.gov.

Rockwell Automation recommends users update the Logix controllers to the following:

ControlLogix 5580 (1756-L8z): Update to versions V32.016, V33.015, V34.014, V35.011 and later.
GuardLogix 5580 (1756-L8zS): Update to versions V32.016, V33.015, V34.014, V35.011 and later.
1756-EN4TR: Update to versions V5.001 and later.

1756-EN2T Series D, 1756-EN2F Series C, 1756-EN2TR Series C, 1756-EN3TR Series B, and 1756-EN2TP Series A: Update to
version V12.001 and later

The products 1756-EN2T Series A/B/C, 1756-EN2F Series A/B, 1756-EN2TR Series A/B, and 1756-EN3TR Series B do not have
a fix available. Users can upgrade to Series D to remediate this vulnerability.

Users that are using the affected firmware and who are not able to upgrade to one of the corrected versions are
encouraged to apply the following mitigation and security best practices, where possible:

Limit the allowed CIP commands on controllers by setting the mode switch to the RUN position.");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:H/PR:L/UI:N/S:C/C:L/I:H/A:H");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:U/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2024-6242");

  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"false");
  script_cwe_id(420);

  script_set_attribute(attribute:"vuln_publication_date", value:"2024/08/01");
  script_set_attribute(attribute:"patch_publication_date", value:"2023/08/01");
  script_set_attribute(attribute:"plugin_publication_date", value:"2024/08/08");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:controllogix_5580_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:guardlogix_5580_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:1756-en2f_series_a_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:1756-en2f_series_b_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:1756-en2f_series_c_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:1756-en2fk_series_a_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:1756-en2fk_series_b_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:1756-en2fk_series_c_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:1756-en2t_series_a_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:1756-en2t_series_b_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:1756-en2t_series_c_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:1756-en2t_series_d_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:1756-en2tk_series_a_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:1756-en2tk_series_b_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:1756-en2tk_series_c_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:1756-en2tk_series_d_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:1756-en2tp_series_a_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:1756-en2tr_series_a_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:1756-en2tr_series_b_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:1756-en2tr_series_c_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:1756-en3tr_series_a_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:1756-en3tr_series_b_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:1756-en4tr_firmware");
  script_set_attribute(attribute:"generated_plugin", value:"former");
  script_set_attribute(attribute:"stig_severity", value:"I");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2024 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/Rockwell");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/Rockwell');

var asset = tenable_ot::assets::get(vendor:'Rockwell');

var vuln_cpes = {
    "cpe:/o:rockwellautomation:controllogix_5580_firmware:-" :
        {"versionEndExcluding" : "32.016", "versionStartIncluding" : "28.000", "family" : "ControlLogix5580"},
    "cpe:/o:rockwellautomation:controllogix_5580_firmware:33" :
        {"versionEndExcluding" : "33.015", "versionStartIncluding" : "33.000", "family" : "ControlLogix5580"},
    "cpe:/o:rockwellautomation:controllogix_5580_firmware:34" :
        {"versionEndExcluding" : "34.014", "versionStartIncluding" : "34.000", "family" : "ControlLogix5580"},
    "cpe:/o:rockwellautomation:controllogix_5580_firmware:35" :
        {"versionEndExcluding" : "35.011", "versionStartIncluding" : "35.000", "family" : "ControlLogix5580"},
    "cpe:/o:rockwellautomation:guardlogix_5580_firmware:-" :
        {"versionEndExcluding" : "32.016", "versionStartIncluding" : "28.000", "family" : "ControlLogix5580"},
    "cpe:/o:rockwellautomation:guardlogix_5580_firmware:33" :
        {"versionEndExcluding" : "33.015", "versionStartIncluding" : "33.000", "family" : "ControlLogix5580"},
    "cpe:/o:rockwellautomation:guardlogix_5580_firmware:34" :
        {"versionEndExcluding" : "34.014", "versionStartIncluding" : "34.000", "family" : "ControlLogix5580"},
    "cpe:/o:rockwellautomation:guardlogix_5580_firmware:35" :
        {"versionEndExcluding" : "35.011", "versionStartIncluding" : "35.000", "family" : "ControlLogix5580"},
    "cpe:/o:rockwellautomation:1756-en2t_series_a_firmware" :
        {"versionEndIncluding" : "5.029", "versionStartIncluding" : "5.007", "family" : "ControlLogix"},
    "cpe:/o:rockwellautomation:1756-en2t_series_b_firmware" :
        {"versionEndIncluding" : "5.029", "versionStartIncluding" : "5.007", "family" : "ControlLogix"},
    "cpe:/o:rockwellautomation:1756-en2t_series_c_firmware" :
        {"versionEndIncluding" : "5.029", "versionStartIncluding" : "5.007", "family" : "ControlLogix"},
    "cpe:/o:rockwellautomation:1756-en2t_series_d_firmware" :
        {"versionEndExcluding" : "12.001", "versionStartIncluding" : "10.006", "family" : "ControlLogix"},
    "cpe:/o:rockwellautomation:1756-en2tp_series_a_firmware" :
        {"versionEndExcluding" : "12.001", "versionStartIncluding" : "10.020", "family" : "ControlLogix"},
    "cpe:/o:rockwellautomation:1756-en2tr_series_a_firmware" :
        {"versionEndIncluding" : "5.029", "versionStartIncluding" : "5.007", "family" : "ControlLogix"},
    "cpe:/o:rockwellautomation:1756-en2tr_series_b_firmware" :
        {"versionEndIncluding" : "5.029", "versionStartIncluding" : "5.007", "family" : "ControlLogix"},
    "cpe:/o:rockwellautomation:1756-en2tr_series_c_firmware" :
        {"versionEndExcluding" : "12.001", "versionStartIncluding" : "10.007", "family" : "ControlLogix"},
    "cpe:/o:rockwellautomation:1756-en2f_series_a_firmware" :
        {"versionEndIncluding" : "5.029", "versionStartIncluding" : "5.007", "family" : "ControlLogix"},
    "cpe:/o:rockwellautomation:1756-en2f_series_b_firmware" :
        {"versionEndIncluding" : "5.029", "versionStartIncluding" : "5.007", "family" : "ControlLogix"},
    "cpe:/o:rockwellautomation:1756-en2f_series_c_firmware" :
        {"versionEndExcluding" : "12.001", "versionStartIncluding" : "10.009", "family" : "ControlLogix"},
    "cpe:/o:rockwellautomation:1756-en3tr_series_a_firmware" :
        {"versionEndIncluding" : "5.029", "versionStartIncluding" : "5.007", "family" : "ControlLogix"},
    "cpe:/o:rockwellautomation:1756-en3tr_series_b_firmware" :
        {"versionEndExcluding" : "12.001", "versionStartIncluding" : "10.007", "family" : "ControlLogix"},
    "cpe:/o:rockwellautomation:1756-en4tr_firmware" :
        {"versionEndExcluding" : "5.001", "versionStartIncluding" : "2.000", "family":"ControlLogix"}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_HOLE);
