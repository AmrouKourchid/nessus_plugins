#%NASL_MIN_LEVEL 70300
##
# (C) Tenable Network Security, Inc.
##

include('deprecated_nasl_level.inc');
include('compat.inc');

if (description)
{
  script_id(500087);
  script_version("1.10");
  script_set_attribute(attribute:"plugin_modification_date", value:"2025/02/20");

  script_cve_id("CVE-2018-4839");
  script_xref(name:"ICSA", value:"18-067-01");

  script_name(english:"Siemens SIPROTEC 4, SIPROTEC Compact, DIGSI 4, and EN100 Ethernet Module Inadequate Encryption Strength (CVE-2018-4839)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"A vulnerability has been identified in DIGSI 4 (All versions < V4.92), EN100 Ethernet module DNP3 variant (All versions
< V1.05.00), EN100 Ethernet module IEC 104 variant (All versions), EN100 Ethernet module IEC 61850 variant (All versions
< V4.30), EN100 Ethernet module Modbus TCP variant (All versions), EN100 Ethernet module PROFINET IO variant (All
versions), Other SIPROTEC 4 relays (All versions), Other SIPROTEC Compact relays (All versions), SIPROTEC 4 7SD80 (All
versions < V4.70), SIPROTEC 4 7SJ61 (All versions < V4.96), SIPROTEC 4 7SJ62 (All versions < V4.96), SIPROTEC 4 7SJ64
(All versions < V4.96), SIPROTEC 4 7SJ66 (All versions < V4.30), SIPROTEC Compact 7SJ80 (All versions < V4.77), SIPROTEC
Compact 7SK80 (All versions < V4.77). An attacker with local access to the engineering system or in a privileged network
position and able to obtain certain network traffic could possibly reconstruct access authorization passwords.   This
plugin only works with Tenable.ot. Please visit https://www.tenable.com/products/tenable-ot for more information.");
  script_set_attribute(attribute:"see_also", value:"https://cert-portal.siemens.com/productcert/pdf/ssa-203306.pdf");
  script_set_attribute(attribute:"see_also", value:"https://ics-cert.us-cert.gov/advisories/ICSA-18-067-01");
  script_set_attribute(attribute:"solution", value:
"The following text was originally created by the Cybersecurity and Infrastructure Security Agency (CISA). The original
can be found at CISA.gov.

Siemens has provided the following updates for mitigations:

- DIGSI 4: Update to v4.92.
- EN100 Ethernet module IEC 61850 variant: Update to v4.30.

- EN100 Ethernet module DNP3 variant: Update to v4.30 and configure DIGSI 4 connection password.

- SIPROTEC Compact 7SJ80: Update to v4.77.
- SIPROTEC Compact 7SK80: Update to v4.77.
- SIPROTEC 4 7SJ61, 7SJ62, and 7SJ64: Update to v4.96.
- SIPROTEC 4 7SJ66: Update to v4.30.
- SIPROTEC 4 7SD80: Update to v4.70.

As a general security measure, Siemens strongly recommends protecting network access to devices with appropriate
mechanisms. To operate the devices in a protected IT environment, Siemens recommends configuring the environment
according to Siemens operational guidelines for Industrial Security and following the recommendations in the product
manuals.

Recommended security guidelines to secure substations and defense in depth can be found at:
https://www.siemens.com/gridsecurity.

For more information on these vulnerabilities and associated software updates, please see Siemens security advisory
SSA-203306");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:M/Au:S/C:P/I:N/A:N");
  script_set_cvss_temporal_vector("CVSS2#E:U/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:H/PR:L/UI:N/S:U/C:H/I:N/A:N");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:U/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2018-4839");
  script_set_attribute(attribute:"cvss3_score_rationale", value:"Scoring adjustsed to align with CVSS 3.1 attack complexity guidance.");

  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"false");
  script_cwe_id(326);

  script_set_attribute(attribute:"vuln_publication_date", value:"2018/03/08");
  script_set_attribute(attribute:"patch_publication_date", value:"2018/03/08");
  script_set_attribute(attribute:"plugin_publication_date", value:"2022/02/07");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:other_siprotec_4_relays_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:other_siprotec_compact_relays_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:en100_ethernet_module_modbus_tcp_variant_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:en100_ethernet_module_profinet_io_variant_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:en100_ethernet_module_iec_104_variant_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:digsi_4_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:en100_ethernet_module_dnp3_variant_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:en100_ethernet_module_iec_61850_variant_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siprotec_4_7sd80_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siprotec_4_7sj61_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siprotec_4_7sj62_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siprotec_4_7sj64_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siprotec_4_7sj66_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siprotec_compact_7sj80_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:siprotec_compact_7sk80_firmware");
  script_set_attribute(attribute:"generated_plugin", value:"former");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2022-2025 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/Siemens");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/Siemens');

var asset = tenable_ot::assets::get(vendor:'Siemens');

var vuln_cpes = {
    "cpe:/o:siemens:other_siprotec_4_relays_firmware" :
        {"family" : "Siprotec4"},
    "cpe:/o:siemens:other_siprotec_compact_relays_firmware" :
        {"family" : "Siprotec"},
    "cpe:/o:siemens:en100_ethernet_module_modbus_tcp_variant_firmware" :
        {"family" : "Siprotec4"},
    "cpe:/o:siemens:en100_ethernet_module_profinet_io_variant_firmware" :
        {"family" : "Siprotec4"},
    "cpe:/o:siemens:en100_ethernet_module_iec_104_variant_firmware" :
        {"family" : "Siprotec4"},
    "cpe:/o:siemens:digsi_4_firmware" :
        {"versionEndExcluding" : "4.92", "family" : "Siprotec4"},
    "cpe:/o:siemens:en100_ethernet_module_dnp3_variant_firmware" :
        {"versionEndExcluding" : "1.05.00", "family" : "Siprotec4"},
    "cpe:/o:siemens:en100_ethernet_module_iec_61850_variant_firmware" :
        {"versionEndExcluding" : "4.30", "family" : "Siprotec4"},
    "cpe:/o:siemens:siprotec_4_7sd80_firmware" :
        {"versionEndExcluding" : "4.70", "family" : "Siprotec4"},
    "cpe:/o:siemens:siprotec_4_7sj61_firmware" :
        {"versionEndExcluding" : "4.96", "family" : "Siprotec4"},
    "cpe:/o:siemens:siprotec_4_7sj62_firmware" :
        {"versionEndExcluding" : "4.96", "family" : "Siprotec4"},
    "cpe:/o:siemens:siprotec_4_7sj64_firmware" :
        {"versionEndExcluding" : "4.96", "family" : "Siprotec4"},
    "cpe:/o:siemens:siprotec_4_7sj66_firmware" :
        {"versionEndExcluding" : "4.30", "family" : "Siprotec4"},
    "cpe:/o:siemens:siprotec_compact_7sj80_firmware" :
        {"versionEndExcluding" : "4.77", "family" : "Siprotec4"},
    "cpe:/o:siemens:siprotec_compact_7sk80_firmware" :
        {"versionEndExcluding" : "4.77", "family" : "Siprotec4"}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_NOTE);
