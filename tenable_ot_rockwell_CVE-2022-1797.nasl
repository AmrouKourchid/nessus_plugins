##
# (C) Tenable, Inc.
##

include('compat.inc');

if (description)
{
  script_id(500653);
  script_version("1.10");
  script_set_attribute(attribute:"plugin_modification_date", value:"2024/10/08");

  script_cve_id("CVE-2022-1797");
  script_xref(name:"ICSA", value:"22-144-01");

  script_name(english:"Rockwell Automation Logix Controllers Uncontrolled Resource Consumption (CVE-2022-1797)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"The remote OT product is vulnerable as specified in advisory ICSA-22-144-01.

  - A malformed Class 3 common industrial protocol message with a cached connection can cause a denial-of-
    service condition in Rockwell Automation Logix Controllers, resulting in a major nonrecoverable fault. If
    the target device becomes unavailable, a user would have to clear the fault and redownload the user
    project file to bring the device back online. (CVE-2022-1797)

This plugin only works with Tenable.ot. Please visit https://www.tenable.com/products/tenable-ot for more information.");
  script_set_attribute(attribute:"see_also", value:"https://www.cisa.gov/uscert/ics/advisories/icsa-22-144-01");
  # https://rockwellautomation.custhelp.com/app/answers/answer_view/a_id/1135559
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?7064b0b5");
  # https://www.rockwellautomation.com/en-us/trust-center/security-advisories/advisory.PN1596.html
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?d1f69005");
  script_set_attribute(attribute:"solution", value:
"The following text was originally created by the Cybersecurity and Infrastructure Security Agency (CISA). The original
can be found at CISA.gov.

Rockwell Automation recommends users update to the latest firmware version to mitigate this vulnerability. Users are
directed towards the risk mitigation provided below and are encouraged (where possible) to combine these with the
general security guidelines below to employ multiple strategies simultaneously. Users should go to Rockwell Automation's
Product Compatibility & Download Center to download the latest firmware.

- CompactLogix 5380, Compact GuardLogix 5380, CompactLogix 5480, ControlLogix 5580, GuardLogix 5580: Upgrade to v33.011
firmware
- CompactLogix 5370, Compact GuardLogix 5370, ControlLogix 5570, GuardLogix 5570: Upgrade to v34.011 firmware

If upgrading is not possible, Rockwell Automation recommends the following mitigations:

- Use of Microsoft AppLocker or other similar allow list applications can help mitigate risk. Information on using
AppLocker with products from Rockwell Automation is available in Knowledgebase article QA17329.
- Confirm the least-privilege user principle is followed, and user/service account access to shared resources (such as a
database) is only granted with a minimum number of rights as needed.

Rockwell Automation general security guidelines:

- Use trusted software, software patches, antivirus/antimalware programs and interact only with trusted websites and
attachments.
- Minimize network exposure for all control system devices and/or systems and confirm they are not accessible from the
Internet. For further information about the risks of unprotected Internet accessible control systems, see Knowledgebase
article PN715.
- Locate control system networks and devices behind firewalls and isolate them from the business network.
- When remote access is required, use secure methods, such as virtual private networks (VPNs), recognizing VPNs may have
vulnerabilities and should be updated to the most current version available. Also recognize a VPN is only as secure as
connected devices.
- Please see Rockwell Automationâ€™s security advisory PN1596 for more information.");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:L/Au:N/C:N/I:N/A:C");
  script_set_cvss_temporal_vector("CVSS2#E:U/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:C/C:N/I:N/A:H");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:U/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2022-1797");

  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"false");
  script_cwe_id(400);

  script_set_attribute(attribute:"vuln_publication_date", value:"2022/06/02");
  script_set_attribute(attribute:"patch_publication_date", value:"2022/06/02");
  script_set_attribute(attribute:"plugin_publication_date", value:"2022/06/11");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:compact_guardlogix_5370_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:compact_guardlogix_5380_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:compactlogix_5370_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:compactlogix_5380_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:compactlogix_5480_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:controllogix_5570_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:controllogix_5580_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:guardlogix_5570_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:guardlogix_5580_firmware");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2022-2024 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/Rockwell");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/Rockwell');

var asset = tenable_ot::assets::get(vendor:'Rockwell');

var vuln_cpes = {
    "cpe:/o:rockwellautomation:compactlogix_5380_firmware" :
        {"versionEndExcluding" : "33.011", "family" : "CompactLogix5380"},
    "cpe:/o:rockwellautomation:compact_guardlogix_5380_firmware" :
        {"versionEndExcluding" : "33.011", "family" : "GuardLogix5380"},
    "cpe:/o:rockwellautomation:compactlogix_5480_firmware" :
        {"versionEndExcluding" : "33.011", "family" : "CompactLogix5480"},
    "cpe:/o:rockwellautomation:controllogix_5580_firmware" :
        {"versionEndExcluding" : "33.011", "family" : "ControlLogix5580"},
    "cpe:/o:rockwellautomation:guardlogix_5580_firmware" :
        {"versionEndExcluding" : "33.011", "family" : "GuardLogix5580"},
    "cpe:/o:rockwellautomation:compactlogix_5370_firmware" :
        {"versionEndExcluding" : "34.011", "family" : "CompactLogix5370"},
    "cpe:/o:rockwellautomation:compact_guardlogix_5370_firmware" :
        {"versionEndExcluding" : "34.011", "family" : "GuardLogix5370"},
    "cpe:/o:rockwellautomation:controllogix_5570_firmware" :
        {"versionEndExcluding" : "34.011", "family" : "ControlLogix5570"},
    "cpe:/o:rockwellautomation:guardlogix_5570_firmware" :
        {"versionEndExcluding" : "34.011", "family" : "GuardLogix5570"}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_HOLE);
