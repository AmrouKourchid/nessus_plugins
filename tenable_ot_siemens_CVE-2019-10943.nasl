#%NASL_MIN_LEVEL 70300
##
# (C) Tenable Network Security, Inc.
##

include('deprecated_nasl_level.inc');
include('compat.inc');

if (description)
{
  script_id(500055);
  script_version("1.10");
  script_set_attribute(attribute:"plugin_modification_date", value:"2024/09/04");

  script_cve_id("CVE-2019-10943");
  script_xref(name:"ICSA", value:"19-344-06");

  script_name(english:"Siemens SIMATIC S7-1200 and S7-1500 CPU Families Missing Support For Integrity Check (CVE-2019-10943)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"An attacker with network access to port 102/tcp could potentially modify the user program on the PLC 
in a way that the running code is different from the source code which is stored on the device. 
An attacker must have network access to affected devices and must be able to perform changes to 
the user program. The vulnerability could impact the perceived integrity of the user program stored on 
the CPU. An engineer that tries to obtain the code of the user program running on the device, can 
receive different source code that is not actually running on the device. 

This plugin only works with Tenable.ot. Please visit https://www.tenable.com/products/tenable-ot for more information.");
  script_set_attribute(attribute:"see_also", value:"https://cert-portal.siemens.com/productcert/pdf/ssa-232418.pdf");
  script_set_attribute(attribute:"see_also", value:"https://www.cisa.gov/news-events/ics-advisories/icsa-19-344-06");
  script_set_attribute(attribute:"solution", value:
"The following text was originally created by the Cybersecurity and Infrastructure Security Agency (CISA). The original
can be found at CISA.gov.

Siemens has released updates for the following products and recommends users update to the new version. 

- SIMATIC S7 PLCSIM Advanced: Update to v3.0

- SIMATIC S7-1200 CPU family: Update to v4.4.0

- SIMATIC S7-1500 CPU family: Update to v2.8.1
- SIMATIC S7-1500 Software Controller: Update to v20.8
- SIMATIC ET 200SP Open Controller CPU 1515SP PC2: Update to v20.8

Siemens is preparing further updates and recommends specific countermeasures until patches are available:

As a general security measure, Siemens strongly recommends users protect network access to devices with appropriate
mechanisms. In order to operate the devices in a protected IT environment, Siemens recommends users configure the
environment according to Siemensâ€™ operational guidelines for industrial security, and follow the recommendations in the
product manuals. Additional information on industrial security by Siemens can be found at:
https://www.siemens.com/industrialsecurity.");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:L/Au:N/C:N/I:P/A:N");
  script_set_cvss_temporal_vector("CVSS2#E:U/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:N");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:U/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2019-10943");

  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"false");
  script_cwe_id(345);

  script_set_attribute(attribute:"vuln_publication_date", value:"2019/08/13");
  script_set_attribute(attribute:"patch_publication_date", value:"2019/08/13");
  script_set_attribute(attribute:"plugin_publication_date", value:"2022/02/07");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_et_200sp_open_controller_cpu_1515sp_pc_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_et_200sp_open_controller_cpu_1515sp_pc2_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-1200_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-1500_firmware");
  script_set_attribute(attribute:"generated_plugin", value:"former");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2022-2024 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/Siemens");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/Siemens');

var asset = tenable_ot::assets::get(vendor:'Siemens');

var vuln_cpes = {
    "cpe:/o:siemens:simatic_et_200sp_open_controller_cpu_1515sp_pc_firmware" :
        {"family" : "ET200SP"},
    "cpe:/o:siemens:simatic_et_200sp_open_controller_cpu_1515sp_pc2_firmware" :
        {"versionStartIncluding" : "20.8", "family" : "ET200SP"},
    "cpe:/o:siemens:simatic_s7-1200_firmware" :
        {"versionStartIncluding" : "4.4.0", "family" : "S71200"},
    "cpe:/o:siemens:simatic_s7-1500_firmware" :
        {"versionStartIncluding" : "2.8.1", "family" : "S71500"}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_WARNING);
