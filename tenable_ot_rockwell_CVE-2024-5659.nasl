#%NASL_MIN_LEVEL 80900
##
# (C) Tenable, Inc.
##

include('compat.inc');

if (description)
{
  script_id(502317);
  script_version("1.3");
  script_set_attribute(attribute:"plugin_modification_date", value:"2024/09/04");

  script_cve_id("CVE-2024-5659");
  script_xref(name:"ICSA", value:"24-163-01");

  script_name(english:"Rockwell Automation ControlLogix, GuardLogix, and CompactLogix Always-Incorrect Control Flow Implementation (CVE-2024-5659)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"Rockwell Automation was made aware of a vulnerability that causes all affected 
controllers on the same network to result in a major nonrecoverable fault (MNRF/Assert). 
This vulnerability could be exploited by sending abnormal packets to the mDNS port. 
If exploited, the availability of the device would be compromised.

This plugin only works with Tenable.ot.
Please visit https://www.tenable.com/products/tenable-ot for more information.");
  # https://www.rockwellautomation.com/en-us/trust-center/security-advisories/advisory.SD1673.html
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?4c70d536");
  script_set_attribute(attribute:"see_also", value:"https://www.cisa.gov/news-events/ics-advisories/icsa-24-163-01");
  script_set_attribute(attribute:"solution", value:
"Users using the affected software and who are not able to upgrade to one of the corrected versions are encouraged to apply the risk mitigations, where possible.
 - Users who do not use Automatic Policy Deployment (APD) should block mDNS port, 5353 to help prevent communication.
 - Enable CIP Security (https://literature.rockwellautomation.com/idc/groups/literature/documents/at/secure-at001_-en-p.pdf).
 - Security Best Practices (https://rockwellautomation.custhelp.com/app/answers/answer_view/a_id/1085012/loc/en_US#__highlight).");
  script_set_cvss3_base_vector("CVSS:3.1/AV:A/AC:L/PR:N/UI:N/S:C/C:N/I:N/A:H");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2024-5659");

  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"false");
  script_cwe_id(670);

  script_set_attribute(attribute:"vuln_publication_date", value:"2024/06/11");
  script_set_attribute(attribute:"patch_publication_date", value:"2024/06/11");
  script_set_attribute(attribute:"plugin_publication_date", value:"2024/07/22");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:controllogix_5580_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:guardlogix_5580_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:1756-en4tr_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:1756-en4trk_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:1756-en4trxt_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:compactlogix_5380_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:compact_guardlogix_5380_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:compactlogix_5480_firmware");
  script_set_attribute(attribute:"generated_plugin", value:"former");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2024 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/Rockwell");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/Rockwell');

var asset = tenable_ot::assets::get(vendor:'Rockwell');

var vuln_cpes = {
    "cpe:/o:rockwellautomation:controllogix_5580_firmware:34" :
        {"versionEndExcluding" : "34.014", "versionStartIncluding" : "34.011", "family" : "ControlLogix5580"},
    "cpe:/o:rockwellautomation:controllogix_5580_firmware:35" :
        {"versionEndExcluding" : "35.013", "versionStartIncluding" : "35", "family" : "ControlLogix5580"},
    "cpe:/o:rockwellautomation:controllogix_5580_firmware:36" :
        {"versionEndExcluding" : "36.011", "versionStartIncluding" : "36", "family" : "ControlLogix5580"},
    "cpe:/o:rockwellautomation:guardlogix_5580_firmware:34" :
        {"versionEndExcluding" : "34.014", "versionStartIncluding" : "34.011", "family" : "GuardLogix5580"},
    "cpe:/o:rockwellautomation:guardlogix_5580_firmware:35" :
        {"versionEndExcluding" : "35.013", "versionStartIncluding" : "35", "family" : "GuardLogix5580"},
    "cpe:/o:rockwellautomation:guardlogix_5580_firmware:36" :
        {"versionEndExcluding" : "36.011", "versionStartIncluding" : "36", "family" : "GuardLogix5580"},
    "cpe:/o:rockwellautomation:1756-en4tr_firmware" :
        {"versionEndExcluding" : "6.001", "versionStartIncluding" : "4.001", "family" : "ControlLogix"},
    "cpe:/o:rockwellautomation:1756-en4trk_firmware" :
        {"versionEndExcluding" : "6.001", "versionStartIncluding" : "4.001", "family" : "ControlLogix"},
    "cpe:/o:rockwellautomation:1756-en4trxt_firmware" :
        {"versionEndExcluding" : "6.001", "versionStartIncluding" : "4.001", "family" : "ControlLogix"},
    "cpe:/o:rockwellautomation:compactlogix_5380_firmware:34" :
        {"versionEndExcluding" : "34.014", "versionStartIncluding" : "34.011", "family" : "CompactLogix5380"},
    "cpe:/o:rockwellautomation:compactlogix_5380_firmware:35" :
        {"versionEndExcluding" : "35.013", "versionStartIncluding" : "35", "family" : "CompactLogix5380"},
    "cpe:/o:rockwellautomation:compactlogix_5380_firmware:36" :
        {"versionEndExcluding" : "36.011", "versionStartIncluding" : "36", "family" : "CompactLogix5380"},
    "cpe:/o:rockwellautomation:compact_guardlogix_5380_firmware:34" :
        {"versionEndExcluding" : "34.014", "versionStartIncluding" : "34.011", "family" : "GuardLogix5380"},
    "cpe:/o:rockwellautomation:compact_guardlogix_5380_firmware:35" :
        {"versionEndExcluding" : "35.013", "versionStartIncluding" : "35", "family" : "GuardLogix5380"},
    "cpe:/o:rockwellautomation:compact_guardlogix_5380_firmware:36" :
        {"versionEndExcluding" : "36.011", "versionStartIncluding" : "36", "family" : "GuardLogix5380"},
    "cpe:/o:rockwellautomation:compactlogix_5480_firmware:34" :
        {"versionEndExcluding" : "34.014", "versionStartIncluding" : "34.011", "family" : "CompactLogix5480"},
    "cpe:/o:rockwellautomation:compactlogix_5480_firmware:35" :
        {"versionEndExcluding" : "35.013", "versionStartIncluding" : "35", "family" : "CompactLogix5480"},
    "cpe:/o:rockwellautomation:compactlogix_5480_firmware:36" :
        {"versionEndExcluding" : "36.011", "versionStartIncluding" : "36", "family" : "CompactLogix5480"}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_NOTE);
